<!-- templates/dashboard/buy_signals.html -->
{% extends "base.html" %}
{% block title %}Buy Signals - Exitus{% endblock %}
{% block content %}
<div class="container mx-auto p-6 space-y-6">
    <!-- Card Filtros -->
    <div class="card bg-white shadow-lg">
        <div class="card-header">
            <h2 class="text-xl font-bold text-gray-800">Filtros <i class="fas fa-filter ml-2"></i></h2>
        </div>
        <div class="p-6">
            <form hx-get="/dashboard/buy-signals/table" hx-target="#signals-table" hx-swap="innerHTML" hx-indicator="#loading">
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                    <select name="mercado" class="input">
                        <option value="all">Todos Mercados</option>
                        <option value="BR">Brasil (B3)</option>
                        <option value="US">EUA (NYSE/NASDAQ)</option>
                        <option value="EU">Europa</option>
                        <option value="JP">Japão</option>
                    </select>
                    <select name="score_min" class="input">
                        <option value="0">Score ≥0</option>
                        <option value="70">Score ≥70 (COMPRA)</option>
                        <option value="40">Score ≥40</option>
                    </select>
                    <select name="sort_by" class="input">
                        <option value="score">Score</option>
                        <option value="margem">Margem Segurança</option>
                        <option value="ticker">Ticker</option>
                    </select>
                    <button type="submit" class="btn btn-primary w-full md:w-auto">
                        <i class="fas fa-search mr-2"></i>Filtrar
                    </button>
                </div>
            </form>
            <div id="loading" class="spinner hidden mt-4"></div>
        </div>
    </div>

    <!-- Card Tabela -->
    <div class="card bg-white shadow-lg">
        <div class="card-header flex justify-between items-center">
            <h2 class="text-xl font-bold">Buy Signals ({{ signals|length }}/20)</h2>
            <div class="text-sm text-gray-500">
                Página {{ current_page }} de {{ total_pages }}
            </div>
        </div>
        <div id="signals-table">
            {% include 'components/buy_signals_table.html' %}
        </div>
    </div>

    <!-- Card Gráficos -->
    <div class="card bg-white shadow-lg">
        <div class="card-header">
            <h2 class="text-xl font-bold">Performance dos Sinais</h2>
        </div>
        <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
            anvas id="scores-chart" height="200"></canvas>
            anvas id="markets-chart" height="200"></canvas>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gráfico Distribuição Scores
    const scoresCtx = document.getElementById('scores-chart');
    if (scoresCtx && {{ summary.scores_distrib.labels|length > 0 }}) {
        new Chart(scoresCtx, {
            type: 'bar',
            data: {{ summary.scores_distrib | tojson }},
            options: { responsive: true, scales: { y: { beginAtZero: true } } }
        });
    }

    // Gráfico por Mercado
    const marketsCtx = document.getElementById('markets-chart');
    if (marketsCtx && {{ summary.mercados.labels|length > 0 }}) {
        new Chart(marketsCtx, {
            type: 'doughnut',
            data: {{ summary.mercados | tojson }},
            options: { responsive: true }
        });
    }
</script>
{% endblock %}
