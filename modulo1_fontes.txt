====================================================
--- ARQUIVO: /home/p016525/elielson/exitus/.gitignore ---
# Python
__pycache__/
*.py[cod]
*.pyo
*.pyd
*.env
.env
.env.*
!.env.example*
!frontend/.env.*example*
!backend/.env.*example*
instance/
db.sqlite3
# logs
logs/
*.log
# Docker
*.pid
*.db
backups/

# IDEs/editors
.vscode/
.idea/
*.swp

# Test files
*.coverage
htmlcov/
.tox/
*.cache
pytest_cache/
.mypy_cache/
coverage.xml

# Container artifacts
exitus-backend/
exitus-frontend/
exitus-db/

# OS files
.DS_Store
Thumbs.db

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/README.md ---
-----

## üèóÔ∏è Arquitetura T√©cnica

Para m√°xima portabilidade e desempenho, o **Exitus** adota uma arquitetura em cont√™ineres:

| Componente | Tecnologia Principal | Descri√ß√£o/Detalhes |
| :--- | :--- | :--- |
| **Banco de Dados** | **PostgreSQL 15** | Armazenamento robusto e transacional (em container Podman). |
| **Backend** | **Flask + SQLAlchemy** | APIs RESTful de alto desempenho para l√≥gica de neg√≥cios (em container Podman). |
| **Frontend** | **Flask + HTMX + Alpine.js** | Interface de usu√°rio moderna, leve e reativa (em container Podman). |
| **Infraestrutura** | **Ubuntu + Podman** | Sistema operacional base e runtime de cont√™ineres. |
-----

## üõ†Ô∏è Tecnologias Chave

  * üêç **Python 3.11+** (Linguagem de Backend)
  * üåê **Flask 3.x** (Framework Web)
  * üíæ **PostgreSQL 15** (Base de Dados)
  * ‚öôÔ∏è **SQLAlchemy 2.x** (ORM)
  * üê≥ **Podman** (Containeriza√ß√£o)
  * ‚ú® **HTMX, Alpine.js** (Interatividade de Frontend)

-----

## üìö Documenta√ß√£o Detalhada dos M√≥dulos

Nossa documenta√ß√£o est√° organizada para guiar voc√™ desde a configura√ß√£o inicial at√© o deploy:

## Documenta√ß√£o dos M√≥dulos

- [M√≥dulo 0: Prepara√ß√£o do Ambiente](docs/modulo0_ambiente.md)
- [M√≥dulo 1: Estrutura do Banco de Dados](docs/modulo1_database.md)
- [M√≥dulo 2: Backend - Autentica√ß√£o e Usu√°rios](docs/modulo2_backend_auth.md)
- [M√≥dulo 3: Backend - Gest√£o de Ativos](docs/modulo3_backend_financeiro.md)
- [M√≥dulo 4: Backend - Transa√ß√µes e Portf√≥lio](docs/modulo4_backend_integracoes.md)
- [M√≥dulo 5: Backend - APIs de Integra√ß√£o](docs/modulo5_frontend_base.md)
- [M√≥dulo 6: Frontend - Interface do Usu√°rio](docs/modulo6_frontend_dashboards.md)
- [M√≥dulo 7: Testes e Valida√ß√£o](docs/modulo7_relatorios.md)
- [M√≥dulo 8: Deploy e Monitoramento](docs/modulo8_deploy.md)

-----

## ‚ñ∂Ô∏è Guia de In√≠cio R√°pido (Quick Start)

1.  **Configura√ß√£o do Ambiente** (Veja o [M√≥dulo 0](docs/modulo0_ambiente.md)):
    ```bash
    ./scripts/setup_containers.sh
    ```
2.  **Iniciar Servi√ßos:**
    ```bash
    ./scripts/start_services.sh
    ```
3.  **Acessar a Aplica√ß√£o:**
      * **Frontend (Interface Web):** `http://localhost:8080`
      * **Backend (API RESTful):** `http://localhost:5000`

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/.env.development.example ---
# Backend Database Configuration
POSTGRES_HOST=exitus-db
POSTGRES_USER=exitus
POSTGRES_PASSWORD=exitus123
POSTGRES_DB=exitusdb
POSTGRES_PORT=5432

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/.env.example ---
# Backend Database Configuration
POSTGRES_HOST=exitus-db
POSTGRES_USER=exitus
POSTGRES_PASSWORD=exitus123
POSTGRES_DB=exitusdb
POSTGRES_PORT=5432

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/.env.production.example ---
# Backend Database Configuration
POSTGRES_HOST=exitus-db
POSTGRES_USER=exitus
POSTGRES_PASSWORD=exitus123
POSTGRES_DB=exitusdb
POSTGRES_PORT=5432

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/.env.staging.example ---
# Backend Database Configuration
POSTGRES_HOST=exitus-db
POSTGRES_USER=exitus
POSTGRES_PASSWORD=exitus123
POSTGRES_DB=exitusdb
POSTGRES_PORT=5432

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/Dockerfile ---
FROM python:3.11-slim

WORKDIR /app

# Instala depend√™ncias do sistema (incluindo ping e curl para diagn√≥stico)
RUN apt-get update && apt-get install -y     gcc     postgresql-client     iputils-ping     curl     && rm -rf /var/lib/apt/lists/*

# Copia e instala depend√™ncias Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copia c√≥digo da aplica√ß√£o
COPY . .

# Se n√£o existir .env dentro da imagem, cria a partir do exemplo (√∫til para dev)
RUN if [ ! -f .env ]; then cp .env.example .env; fi

# Exp√µe porta
EXPOSE 5000

# Comando anterior
# CMD ["python", "run.py"]

# Novo comando
CMD ["gunicorn", "-b", "0.0.0.0:5000", "run:app", "--reload"]


====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/alembic.ini ---
# A generic, single database configuration.

[alembic]
# path to migration scripts
script_location = alembic

# template used to generate migration file names; The default value is %%(rev)s_%%(slug)s
# Uncomment the line below if you want the files to be prepended with date and time
# see https://alembic.sqlalchemy.org/en/latest/tutorial.html#editing-the-ini-file
# for all available tokens
# file_template = %%(year)d_%%(month).2d_%%(day).2d_%%(hour).2d%%(minute).2d-%%(rev)s_%%(slug)s

# sys.path path, will be prepended to sys.path if present.
# defaults to the current working directory.
prepend_sys_path = .

# timezone to use when rendering the date within the migration file
# as well as the filename.
# If specified, requires the python>=3.9 or backports.zoneinfo library.
# Any required deps can installed by adding `alembic[tz]` to the pip requirements
# string value is passed to ZoneInfo()
# leave blank for localtime
# timezone =

# max length of characters to apply to the
# "slug" field
# truncate_slug_length = 40

# set to 'true' to run the environment during
# the 'revision' command, regardless of autogenerate
# revision_environment = false

# set to 'true' to allow .pyc and .pyo files without
# a source .py file to be detected as revisions in the
# versions/ directory
# sourceless = false

# version location specification; This defaults
# to alembic/versions.  When using multiple version
# directories, initial revisions must be specified with --version-path.
# The path separator used here should be the separator specified by "version_path_separator" below.
# version_locations = %(here)s/bar:%(here)s/bat:alembic/versions

# version path separator; As mentioned above, this is the character used to split
# version_locations. The default within new alembic.ini files is "os", which uses os.pathsep.
# If this key is omitted entirely, it falls back to the legacy behavior of splitting on spaces and/or commas.
# Valid values for version_path_separator are:
#
# version_path_separator = :
# version_path_separator = ;
# version_path_separator = space
version_path_separator = os  # Use os.pathsep. Default configuration used for new projects.

# set to 'true' to search source files recursively
# in each "version_locations" directory
# new in Alembic version 1.10
# recursive_version_locations = false

# the output encoding used when revision files
# are written from script.py.mako
# output_encoding = utf-8

sqlalchemy.url = driver://user:pass@localhost/dbname


[post_write_hooks]
# post_write_hooks defines scripts or Python functions that are run
# on newly generated revision scripts.  See the documentation for further
# detail and examples

# format using "black" - use the console_scripts runner, against the "black" entrypoint
# hooks = black
# black.type = console_scripts
# black.entrypoint = black
# black.options = -l 79 REVISION_SCRIPT_FILENAME

# lint with attempts to fix using "ruff" - use the exec runner, execute a binary
# hooks = ruff
# ruff.type = exec
# ruff.executable = %(here)s/.venv/bin/ruff
# ruff.options = --fix REVISION_SCRIPT_FILENAME

# Logging configuration
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/alembic/README ---
Generic single-database configuration.
====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/alembic/env.py ---
from logging.config import fileConfig
from sqlalchemy import engine_from_config
from sqlalchemy import pool
from alembic import context

# Adicionar path do app
import sys
import os
sys.path.insert(0, os.path.realpath(os.path.join(os.path.dirname(__file__), '..')))

# Importar a aplica√ß√£o Flask e o db
from app import create_app
from app.database import db

# this is the Alembic Config object
config = context.config

# Interpret the config file for Python logging
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# Criar aplica√ß√£o Flask e obter metadata
app = create_app()
with app.app_context():
    # Garantir que todos os models sejam importados
    from app.models import (
        Usuario, Corretora, Ativo, Posicao, Transacao,
        Provento, MovimentacaoCaixa, EventoCorporativo,
        FonteDados, RegraFiscal, FeriadoMercado, LogAuditoria
    )
    target_metadata = db.metadata
    
# Configurar URL do banco
config.set_main_option('sqlalchemy.url', app.config['SQLALCHEMY_DATABASE_URI'])


def run_migrations_offline() -> None:
    """Run migrations in 'offline' mode."""
    url = config.get_main_option("sqlalchemy.url")
    context.configure(
        url=url,
        target_metadata=target_metadata,
        literal_binds=True,
        dialect_opts={"paramstyle": "named"},
    )

    with context.begin_transaction():
        context.run_migrations()


def run_migrations_online() -> None:
    """Run migrations in 'online' mode."""
    connectable = engine_from_config(
        config.get_section(config.config_ini_section, {}),
        prefix="sqlalchemy.",
        poolclass=pool.NullPool,
    )

    with connectable.connect() as connection:
        context.configure(
            connection=connection,
            target_metadata=target_metadata
        )

        with context.begin_transaction():
            context.run_migrations()


if context.is_offline_mode():
    run_migrations_offline()
else:
    run_migrations_online()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/alembic/env.py.back ---
# backend/alembic/env.py
from logging.config import fileConfig
from sqlalchemy import engine_from_config
from sqlalchemy import pool
from alembic import context

# ADICIONAR ESTAS LINHAS:
import sys
import os
sys.path.insert(0, os.path.realpath(os.path.join(os.path.dirname(__file__), '..')))

from app import create_app
from app.database import db

# this is the Alembic Config object
config = context.config

# Interpret the config file for Python logging.
if config.config_file_name is not None:
    fileConfig(config.config_file_name)

# ADICIONAR ESTA LINHA:
# Configurar a URL do banco a partir da aplica√ß√£o Flask
app = create_app()
config.set_main_option('sqlalchemy.url', app.config['SQLALCHEMY_DATABASE_URI'])

# add your model's MetaData object here
# SUBSTITUIR por:
target_metadata = db.metadata

# ... resto do arquivo permanece igual

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/alembic/script.py.mako ---
"""${message}

Revision ID: ${up_revision}
Revises: ${down_revision | comma,n}
Create Date: ${create_date}

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
${imports if imports else ""}

# revision identifiers, used by Alembic.
revision: str = ${repr(up_revision)}
down_revision: Union[str, None] = ${repr(down_revision)}
branch_labels: Union[str, Sequence[str], None] = ${repr(branch_labels)}
depends_on: Union[str, Sequence[str], None] = ${repr(depends_on)}


def upgrade() -> None:
    ${upgrades if upgrades else "pass"}


def downgrade() -> None:
    ${downgrades if downgrades else "pass"}

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/alembic/versions/b2542b2f7857_initial_schema_12_models.py ---
"""Initial schema - 12 models

Revision ID: b2542b2f7857
Revises: 
Create Date: 2025-11-26 19:40:34.891548

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = 'b2542b2f7857'
down_revision: Union[str, None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('ativo',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico do ativo'),
    sa.Column('ticker', sa.String(length=20), nullable=False, comment='C√≥digo/s√≠mbolo do ativo (ex: PETR4, AAPL, BTC)'),
    sa.Column('nome', sa.String(length=200), nullable=False, comment='Nome completo do ativo'),
    sa.Column('tipo', sa.Enum('ACAO', 'FII', 'REIT', 'BOND', 'ETF', 'CRIPTO', 'OUTRO', name='tipoativo'), nullable=False, comment='Tipo do ativo (a√ß√£o, FII, REIT, bond, cripto)'),
    sa.Column('classe', sa.Enum('RENDA_VARIAVEL', 'RENDA_FIXA', 'CRIPTO', 'HIBRIDO', name='classeativo'), nullable=False, comment='Classe do ativo (renda vari√°vel, fixa, cripto)'),
    sa.Column('mercado', sa.String(length=10), nullable=False, comment='Mercado/pa√≠s de negocia√ß√£o (BR, US, EUR)'),
    sa.Column('moeda', sa.String(length=3), nullable=False, comment='Moeda de negocia√ß√£o (BRL, USD, EUR)'),
    sa.Column('preco_atual', sa.Numeric(precision=18, scale=6), nullable=True, comment='Pre√ßo/cota√ß√£o atual do ativo'),
    sa.Column('data_ultima_cotacao', sa.DateTime(timezone=True), nullable=True, comment='Data e hora da √∫ltima cota√ß√£o'),
    sa.Column('dividend_yield', sa.Numeric(precision=8, scale=4), nullable=True, comment='Dividend Yield em % (ex: 6.5000 = 6.5%)'),
    sa.Column('p_l', sa.Numeric(precision=10, scale=2), nullable=True, comment='√çndice Pre√ßo/Lucro'),
    sa.Column('p_vp', sa.Numeric(precision=10, scale=2), nullable=True, comment='√çndice Pre√ßo/Valor Patrimonial'),
    sa.Column('roe', sa.Numeric(precision=8, scale=4), nullable=True, comment='Return on Equity em %'),
    sa.Column('ativo', sa.Boolean(), nullable=False, comment='Indica se ativo est√° dispon√≠vel para negocia√ß√£o'),
    sa.Column('deslistado', sa.Boolean(), nullable=False, comment='Indica se ativo foi deslistado da bolsa'),
    sa.Column('data_deslistagem', sa.Date(), nullable=True, comment='Data de deslistagem (se aplic√°vel)'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes e notas sobre o ativo'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint('length(nome) >= 2', name='ativo_nome_min_length'),
    sa.CheckConstraint('length(ticker) >= 1', name='ativo_ticker_min_length'),
    sa.CheckConstraint('preco_atual IS NULL OR preco_atual >= 0', name='ativo_preco_positivo'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('ticker', 'mercado', name='unique_ativo_ticker_mercado'),
    comment='Tabela de ativos financeiros (a√ß√µes, FIIs, REITs, bonds, criptomoedas)'
    )
    op.create_index(op.f('ix_ativo_ativo'), 'ativo', ['ativo'], unique=False)
    op.create_index(op.f('ix_ativo_classe'), 'ativo', ['classe'], unique=False)
    op.create_index(op.f('ix_ativo_data_ultima_cotacao'), 'ativo', ['data_ultima_cotacao'], unique=False)
    op.create_index(op.f('ix_ativo_deslistado'), 'ativo', ['deslistado'], unique=False)
    op.create_index(op.f('ix_ativo_mercado'), 'ativo', ['mercado'], unique=False)
    op.create_index(op.f('ix_ativo_moeda'), 'ativo', ['moeda'], unique=False)
    op.create_index(op.f('ix_ativo_nome'), 'ativo', ['nome'], unique=False)
    op.create_index(op.f('ix_ativo_ticker'), 'ativo', ['ticker'], unique=False)
    op.create_index(op.f('ix_ativo_tipo'), 'ativo', ['tipo'], unique=False)
    op.create_table('feriado_mercado',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico do feriado'),
    sa.Column('pais', sa.String(length=2), nullable=False, comment='C√≥digo ISO do pa√≠s (BR, US, etc.)'),
    sa.Column('mercado', sa.String(length=20), nullable=True, comment='Mercado/bolsa espec√≠fica (B3, NYSE, NASDAQ, etc.) - NULL = todos'),
    sa.Column('data_feriado', sa.Date(), nullable=False, comment='Data do feriado'),
    sa.Column('tipo_feriado', sa.Enum('NACIONAL', 'BOLSA', 'PONTE', 'FECHAMENTO_ANTECIPADO', 'MANUTENCAO', 'OUTRO', name='tipoferiado'), nullable=False, comment='Tipo do feriado'),
    sa.Column('nome', sa.String(length=200), nullable=False, comment='Nome do feriado'),
    sa.Column('horario_fechamento', sa.Time(), nullable=True, comment='Hor√°rio de fechamento antecipado (se aplic√°vel)'),
    sa.Column('recorrente', sa.Boolean(), nullable=False, comment='Indica se √© feriado anual fixo (sempre no mesmo dia/m√™s)'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes sobre o feriado'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint("pais ~* '^[A-Z]{2}$'", name='feriado_pais_iso_format'),
    sa.CheckConstraint('length(nome) >= 3', name='feriado_nome_min_length'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('pais', 'mercado', 'data_feriado', name='unique_feriado_pais_mercado_data'),
    comment='Tabela de feriados e dias sem preg√£o nos mercados'
    )
    op.create_index(op.f('ix_feriado_mercado_data_feriado'), 'feriado_mercado', ['data_feriado'], unique=False)
    op.create_index(op.f('ix_feriado_mercado_mercado'), 'feriado_mercado', ['mercado'], unique=False)
    op.create_index(op.f('ix_feriado_mercado_pais'), 'feriado_mercado', ['pais'], unique=False)
    op.create_index(op.f('ix_feriado_mercado_recorrente'), 'feriado_mercado', ['recorrente'], unique=False)
    op.create_index(op.f('ix_feriado_mercado_tipo_feriado'), 'feriado_mercado', ['tipo_feriado'], unique=False)
    op.create_table('fonte_dados',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico da fonte'),
    sa.Column('nome', sa.String(length=100), nullable=False, comment='Nome da fonte de dados (ex: yfinance, Alpha Vantage)'),
    sa.Column('tipo_fonte', sa.Enum('API', 'SCRAPER', 'MANUAL', 'ARQUIVO', 'OUTRO', name='tipofontedados'), nullable=False, comment='Tipo da fonte de dados'),
    sa.Column('url_base', sa.String(length=500), nullable=True, comment='URL base da API ou site'),
    sa.Column('requer_autenticacao', sa.Boolean(), nullable=False, comment='Indica se requer chave API ou autentica√ß√£o'),
    sa.Column('rate_limit', sa.String(length=50), nullable=True, comment="Limite de requisi√ß√µes (ex: '5/minute', '500/day')"),
    sa.Column('ativa', sa.Boolean(), nullable=False, comment='Indica se fonte est√° ativa'),
    sa.Column('prioridade', sa.Integer(), nullable=False, comment='Ordem de prioridade (1 = maior prioridade)'),
    sa.Column('ultima_consulta', sa.DateTime(timezone=True), nullable=True, comment='Timestamp da √∫ltima consulta bem-sucedida'),
    sa.Column('total_consultas', sa.Integer(), nullable=False, comment='Total de consultas realizadas'),
    sa.Column('total_erros', sa.Integer(), nullable=False, comment='Total de erros encontrados'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes sobre a fonte de dados'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint('length(nome) >= 2', name='fonte_nome_min_length'),
    sa.CheckConstraint('prioridade > 0', name='fonte_prioridade_positiva'),
    sa.CheckConstraint('total_consultas >= 0', name='fonte_consultas_positivas'),
    sa.CheckConstraint('total_erros >= 0', name='fonte_erros_positivos'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de fontes de dados externas (APIs, scrapers)'
    )
    op.create_index(op.f('ix_fonte_dados_ativa'), 'fonte_dados', ['ativa'], unique=False)
    op.create_index(op.f('ix_fonte_dados_nome'), 'fonte_dados', ['nome'], unique=True)
    op.create_index(op.f('ix_fonte_dados_prioridade'), 'fonte_dados', ['prioridade'], unique=False)
    op.create_index(op.f('ix_fonte_dados_tipo_fonte'), 'fonte_dados', ['tipo_fonte'], unique=False)
    op.create_index(op.f('ix_fonte_dados_ultima_consulta'), 'fonte_dados', ['ultima_consulta'], unique=False)
    op.create_table('regra_fiscal',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico da regra'),
    sa.Column('pais', sa.String(length=2), nullable=False, comment='C√≥digo ISO do pa√≠s (BR, US, etc.)'),
    sa.Column('tipo_ativo', sa.String(length=20), nullable=True, comment='Tipo de ativo (ACAO, FII, REIT, BOND, etc.) - NULL = todos'),
    sa.Column('tipo_operacao', sa.String(length=20), nullable=True, comment='Tipo de opera√ß√£o (COMPRA, VENDA, DAY_TRADE, SWING_TRADE) - NULL = todas'),
    sa.Column('aliquota_ir', sa.Numeric(precision=6, scale=4), nullable=False, comment='Al√≠quota de IR em % (ex: 15.0000 = 15%)'),
    sa.Column('valor_isencao', sa.Numeric(precision=18, scale=2), nullable=True, comment='Valor de isen√ß√£o mensal (ex: R$ 20.000,00 no Brasil)'),
    sa.Column('incide_sobre', sa.Enum('LUCRO', 'RECEITA', 'PROVENTO', 'OPERACAO', name='incidenciaimposto'), nullable=False, comment='Sobre o que incide o imposto'),
    sa.Column('descricao', sa.Text(), nullable=False, comment='Descri√ß√£o detalhada da regra fiscal'),
    sa.Column('vigencia_inicio', sa.Date(), nullable=False, comment='Data de in√≠cio da vig√™ncia da regra'),
    sa.Column('vigencia_fim', sa.Date(), nullable=True, comment='Data de fim da vig√™ncia (NULL = vigente indefinidamente)'),
    sa.Column('ativa', sa.Boolean(), nullable=False, comment='Indica se regra est√° ativa'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint("pais ~* '^[A-Z]{2}$'", name='regra_pais_iso_format'),
    sa.CheckConstraint('aliquota_ir >= 0 AND aliquota_ir <= 100', name='regra_aliquota_valida'),
    sa.CheckConstraint('valor_isencao IS NULL OR valor_isencao >= 0', name='regra_isencao_positiva'),
    sa.CheckConstraint('vigencia_fim IS NULL OR vigencia_fim >= vigencia_inicio', name='regra_vigencia_valida'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de regras tribut√°rias por pa√≠s e tipo de ativo'
    )
    op.create_index(op.f('ix_regra_fiscal_ativa'), 'regra_fiscal', ['ativa'], unique=False)
    op.create_index(op.f('ix_regra_fiscal_incide_sobre'), 'regra_fiscal', ['incide_sobre'], unique=False)
    op.create_index(op.f('ix_regra_fiscal_pais'), 'regra_fiscal', ['pais'], unique=False)
    op.create_index(op.f('ix_regra_fiscal_tipo_ativo'), 'regra_fiscal', ['tipo_ativo'], unique=False)
    op.create_index(op.f('ix_regra_fiscal_tipo_operacao'), 'regra_fiscal', ['tipo_operacao'], unique=False)
    op.create_index(op.f('ix_regra_fiscal_vigencia_fim'), 'regra_fiscal', ['vigencia_fim'], unique=False)
    op.create_index(op.f('ix_regra_fiscal_vigencia_inicio'), 'regra_fiscal', ['vigencia_inicio'], unique=False)
    op.create_table('usuario',
    sa.Column('id', sa.UUID(), nullable=False),
    sa.Column('username', sa.String(length=50), nullable=False),
    sa.Column('email', sa.String(length=120), nullable=False),
    sa.Column('password_hash', sa.String(length=255), nullable=False),
    sa.Column('nome_completo', sa.String(length=200), nullable=True),
    sa.Column('ativo', sa.Boolean(), nullable=False),
    sa.Column('role', sa.Enum('ADMIN', 'USER', 'READONLY', name='userrole'), nullable=False),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index(op.f('ix_usuario_email'), 'usuario', ['email'], unique=True)
    op.create_index(op.f('ix_usuario_username'), 'usuario', ['username'], unique=True)
    op.create_table('corretora',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico da corretora'),
    sa.Column('usuario_id', sa.UUID(), nullable=False, comment='ID do usu√°rio propriet√°rio'),
    sa.Column('nome', sa.String(length=100), nullable=False, comment='Nome da corretora/exchange (ex: XP, Clear, Binance)'),
    sa.Column('tipo', sa.Enum('CORRETORA', 'EXCHANGE', name='tipocorretora'), nullable=False, comment='Tipo: corretora tradicional ou exchange cripto'),
    sa.Column('pais', sa.String(length=2), nullable=False, comment='C√≥digo ISO 3166-1 alpha-2 do pa√≠s (BR, US, etc.)'),
    sa.Column('moeda_padrao', sa.String(length=3), nullable=False, comment='C√≥digo ISO 4217 da moeda (BRL, USD, EUR)'),
    sa.Column('saldo_atual', sa.Numeric(precision=18, scale=2), nullable=False, comment='Saldo dispon√≠vel em caixa (na moeda padr√£o)'),
    sa.Column('ativa', sa.Boolean(), nullable=False, comment='Indica se conta est√° ativa'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes e notas do usu√°rio sobre a conta'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint("moeda_padrao ~* '^[A-Z]{3}$'", name='corretora_moeda_iso_format'),
    sa.CheckConstraint("pais ~* '^[A-Z]{2}$'", name='corretora_pais_iso_format'),
    sa.CheckConstraint('length(nome) >= 2', name='corretora_nome_min_length'),
    sa.CheckConstraint('saldo_atual >= 0', name='corretora_saldo_positivo'),
    sa.ForeignKeyConstraint(['usuario_id'], ['usuario.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('usuario_id', 'nome', 'pais', name='unique_corretora_usuario_nome_pais'),
    comment='Tabela de corretoras e contas de investimento'
    )
    op.create_index(op.f('ix_corretora_ativa'), 'corretora', ['ativa'], unique=False)
    op.create_index(op.f('ix_corretora_moeda_padrao'), 'corretora', ['moeda_padrao'], unique=False)
    op.create_index(op.f('ix_corretora_nome'), 'corretora', ['nome'], unique=False)
    op.create_index(op.f('ix_corretora_pais'), 'corretora', ['pais'], unique=False)
    op.create_index(op.f('ix_corretora_tipo'), 'corretora', ['tipo'], unique=False)
    op.create_index(op.f('ix_corretora_usuario_id'), 'corretora', ['usuario_id'], unique=False)
    op.create_table('evento_corporativo',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico do evento'),
    sa.Column('ativo_id', sa.UUID(), nullable=False, comment='ID do ativo afetado pelo evento'),
    sa.Column('ativo_novo_id', sa.UUID(), nullable=True, comment='ID do novo ativo (fus√µes, mudan√ßas de ticker)'),
    sa.Column('tipo_evento', sa.Enum('SPLIT', 'GRUPAMENTO', 'BONIFICACAO', 'DIREITO_SUBSCRICAO', 'FUSAO', 'CISAO', 'INCORPORACAO', 'MUDANCA_TICKER', 'DESLISTAGEM', 'RELISTING', 'CANCELAMENTO', 'OUTRO', name='tipoeventocorporativo'), nullable=False, comment='Tipo do evento corporativo'),
    sa.Column('data_evento', sa.Date(), nullable=False, comment='Data do evento'),
    sa.Column('data_com', sa.Date(), nullable=True, comment='Data COM (√∫ltimo dia para ter direito ao evento)'),
    sa.Column('proporcao', sa.String(length=20), nullable=True, comment="Propor√ß√£o do evento (ex: '2:1', '1:10', '1:1.5')"),
    sa.Column('descricao', sa.Text(), nullable=False, comment='Descri√ß√£o detalhada do evento'),
    sa.Column('impacto_posicoes', sa.Boolean(), nullable=False, comment='Indica se as posi√ß√µes j√° foram ajustadas'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes adicionais sobre o evento'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    #sa.CheckConstraint("\n            (tipo_evento IN ('split', 'grupamento', 'bonificacao') AND proporcao IS NOT NULL)\n            OR \n            (tipo_evento NOT IN ('split', 'grupamento', 'bonificacao'))\n            ", name='evento_proporcao_obrigatoria'),
    sa.CheckConstraint('data_com IS NULL OR data_com <= data_evento', name='evento_data_com_valida'),
    sa.ForeignKeyConstraint(['ativo_id'], ['ativo.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['ativo_novo_id'], ['ativo.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de eventos corporativos que afetam ativos'
    )
    op.create_index(op.f('ix_evento_corporativo_ativo_id'), 'evento_corporativo', ['ativo_id'], unique=False)
    op.create_index(op.f('ix_evento_corporativo_ativo_novo_id'), 'evento_corporativo', ['ativo_novo_id'], unique=False)
    op.create_index(op.f('ix_evento_corporativo_data_com'), 'evento_corporativo', ['data_com'], unique=False)
    op.create_index(op.f('ix_evento_corporativo_data_evento'), 'evento_corporativo', ['data_evento'], unique=False)
    op.create_index(op.f('ix_evento_corporativo_impacto_posicoes'), 'evento_corporativo', ['impacto_posicoes'], unique=False)
    op.create_index(op.f('ix_evento_corporativo_tipo_evento'), 'evento_corporativo', ['tipo_evento'], unique=False)
    op.create_table('log_auditoria',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico do log'),
    sa.Column('usuario_id', sa.UUID(), nullable=True, comment='ID do usu√°rio (NULL para a√ß√µes an√¥nimas)'),
    sa.Column('acao', sa.String(length=50), nullable=False, comment='Tipo de a√ß√£o (LOGIN, LOGOUT, CREATE, UPDATE, DELETE, VIEW, EXPORT, etc.)'),
    sa.Column('entidade', sa.String(length=100), nullable=True, comment='Nome da entidade afetada (Usuario, Transacao, Posicao, etc.)'),
    sa.Column('entidade_id', sa.UUID(), nullable=True, comment='ID do registro afetado'),
    sa.Column('dados_antes', sa.JSON(), nullable=True, comment='Estado anterior do registro (JSON)'),
    sa.Column('dados_depois', sa.JSON(), nullable=True, comment='Estado posterior do registro (JSON)'),
    sa.Column('ip_address', sa.String(length=45), nullable=True, comment='Endere√ßo IP de origem'),
    sa.Column('user_agent', sa.String(length=500), nullable=True, comment='User-Agent (navegador/cliente)'),
    sa.Column('timestamp', sa.DateTime(timezone=True), nullable=False, comment='Data/hora da a√ß√£o'),
    sa.Column('sucesso', sa.Boolean(), nullable=False, comment='Indica se a√ß√£o foi bem-sucedida'),
    sa.Column('mensagem', sa.Text(), nullable=True, comment='Mensagem de erro ou detalhes adicionais'),
    sa.CheckConstraint('length(acao) >= 3', name='log_acao_min_length'),
    sa.ForeignKeyConstraint(['usuario_id'], ['usuario.id'], ondelete='SET NULL'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de logs de auditoria para compliance'
    )
    op.create_index(op.f('ix_log_auditoria_acao'), 'log_auditoria', ['acao'], unique=False)
    op.create_index(op.f('ix_log_auditoria_entidade'), 'log_auditoria', ['entidade'], unique=False)
    op.create_index(op.f('ix_log_auditoria_entidade_id'), 'log_auditoria', ['entidade_id'], unique=False)
    op.create_index(op.f('ix_log_auditoria_ip_address'), 'log_auditoria', ['ip_address'], unique=False)
    op.create_index(op.f('ix_log_auditoria_sucesso'), 'log_auditoria', ['sucesso'], unique=False)
    op.create_index(op.f('ix_log_auditoria_timestamp'), 'log_auditoria', ['timestamp'], unique=False)
    op.create_index(op.f('ix_log_auditoria_usuario_id'), 'log_auditoria', ['usuario_id'], unique=False)
    op.create_table('provento',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico do provento'),
    sa.Column('ativo_id', sa.UUID(), nullable=False, comment='ID do ativo que pagou o provento'),
    sa.Column('tipo_provento', sa.Enum('DIVIDENDO', 'JCP', 'RENDIMENTO', 'CUPOM', 'BONIFICACAO', 'DIREITO_SUBSCRICAO', 'OUTRO', name='tipoprovento'), nullable=False, comment='Tipo do provento (dividendo, JCP, rendimento, etc.)'),
    sa.Column('valor_por_acao', sa.Numeric(precision=18, scale=6), nullable=False, comment='Valor unit√°rio por ativo'),
    sa.Column('quantidade_ativos', sa.Numeric(precision=18, scale=8), nullable=False, comment='Quantidade de ativos que geraram o provento'),
    sa.Column('valor_bruto', sa.Numeric(precision=18, scale=2), nullable=False, comment='Valor bruto recebido'),
    sa.Column('imposto_retido', sa.Numeric(precision=18, scale=2), nullable=False, comment='IR retido na fonte'),
    sa.Column('valor_liquido', sa.Numeric(precision=18, scale=2), nullable=False, comment='Valor l√≠quido creditado'),
    sa.Column('data_com', sa.Date(), nullable=False, comment='Data COM (√∫ltimo dia para ter direito ao provento)'),
    sa.Column('data_pagamento', sa.Date(), nullable=False, comment='Data efetiva do pagamento'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes sobre o provento'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint('data_pagamento >= data_com', name='provento_data_pagamento_valida'),
    sa.CheckConstraint('imposto_retido >= 0', name='provento_imposto_positivo'),
    sa.CheckConstraint('quantidade_ativos > 0', name='provento_quantidade_positiva'),
    sa.CheckConstraint('valor_bruto > 0', name='provento_valor_bruto_positivo'),
    sa.CheckConstraint('valor_liquido <= valor_bruto', name='provento_liquido_menor_bruto'),
    sa.CheckConstraint('valor_liquido > 0', name='provento_valor_liquido_positivo'),
    sa.CheckConstraint('valor_por_acao > 0', name='provento_valor_por_acao_positivo'),
    sa.ForeignKeyConstraint(['ativo_id'], ['ativo.id'], ondelete='RESTRICT'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de proventos recebidos (dividendos, JCP, rendimentos)'
    )
    op.create_index(op.f('ix_provento_ativo_id'), 'provento', ['ativo_id'], unique=False)
    op.create_index(op.f('ix_provento_data_com'), 'provento', ['data_com'], unique=False)
    op.create_index(op.f('ix_provento_data_pagamento'), 'provento', ['data_pagamento'], unique=False)
    op.create_index(op.f('ix_provento_tipo_provento'), 'provento', ['tipo_provento'], unique=False)
    op.create_table('movimentacao_caixa',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico da movimenta√ß√£o'),
    sa.Column('usuario_id', sa.UUID(), nullable=False, comment='ID do usu√°rio'),
    sa.Column('corretora_id', sa.UUID(), nullable=False, comment='ID da corretora (origem)'),
    sa.Column('corretora_destino_id', sa.UUID(), nullable=True, comment='ID da corretora destino (apenas para transfer√™ncias)'),
    sa.Column('provento_id', sa.UUID(), nullable=True, comment='ID do provento (apenas para cr√©dito de provento)'),
    sa.Column('tipo_movimentacao', sa.Enum('DEPOSITO', 'SAQUE', 'TRANSFERENCIA_ENVIADA', 'TRANSFERENCIA_RECEBIDA', 'CREDITO_PROVENTO', 'PAGAMENTO_TAXA', 'PAGAMENTO_IMPOSTO', 'AJUSTE', 'OUTRO', name='tipomovimentacao'), nullable=False, comment='Tipo da movimenta√ß√£o'),
    sa.Column('valor', sa.Numeric(precision=18, scale=2), nullable=False, comment='Valor da movimenta√ß√£o'),
    sa.Column('moeda', sa.String(length=3), nullable=False, comment='C√≥digo ISO 4217 da moeda (BRL, USD, EUR)'),
    sa.Column('data_movimentacao', sa.Date(), nullable=False, comment='Data da movimenta√ß√£o'),
    sa.Column('descricao', sa.Text(), nullable=True, comment='Descri√ß√£o da movimenta√ß√£o'),
    sa.Column('comprovante', sa.String(length=200), nullable=True, comment='Refer√™ncia ao comprovante (n√∫mero, hash, arquivo)'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    #sa.CheckConstraint("\n            (tipo_movimentacao = 'credito_provento' AND provento_id IS NOT NULL)\n            OR \n            (tipo_movimentacao != 'credito_provento')\n            ", name='movimentacao_credito_tem_provento'),
    #sa.CheckConstraint("\n            (tipo_movimentacao IN ('transferencia_enviada', 'transferencia_recebida') \n             AND corretora_destino_id IS NOT NULL)\n            OR \n            (tipo_movimentacao NOT IN ('transferencia_enviada', 'transferencia_recebida'))\n            ", name='movimentacao_transferencia_tem_destino'),
    sa.CheckConstraint("moeda ~* '^[A-Z]{3}$'", name='movimentacao_moeda_iso_format'),
    sa.CheckConstraint('valor > 0', name='movimentacao_valor_positivo'),
    sa.ForeignKeyConstraint(['corretora_destino_id'], ['corretora.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['corretora_id'], ['corretora.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['provento_id'], ['provento.id'], ondelete='SET NULL'),
    sa.ForeignKeyConstraint(['usuario_id'], ['usuario.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de movimenta√ß√µes de caixa em corretoras'
    )
    op.create_index(op.f('ix_movimentacao_caixa_corretora_destino_id'), 'movimentacao_caixa', ['corretora_destino_id'], unique=False)
    op.create_index(op.f('ix_movimentacao_caixa_corretora_id'), 'movimentacao_caixa', ['corretora_id'], unique=False)
    op.create_index(op.f('ix_movimentacao_caixa_data_movimentacao'), 'movimentacao_caixa', ['data_movimentacao'], unique=False)
    op.create_index(op.f('ix_movimentacao_caixa_moeda'), 'movimentacao_caixa', ['moeda'], unique=False)
    op.create_index(op.f('ix_movimentacao_caixa_provento_id'), 'movimentacao_caixa', ['provento_id'], unique=False)
    op.create_index(op.f('ix_movimentacao_caixa_tipo_movimentacao'), 'movimentacao_caixa', ['tipo_movimentacao'], unique=False)
    op.create_index(op.f('ix_movimentacao_caixa_usuario_id'), 'movimentacao_caixa', ['usuario_id'], unique=False)
    op.create_table('posicao',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico da posi√ß√£o'),
    sa.Column('usuario_id', sa.UUID(), nullable=False, comment='ID do usu√°rio propriet√°rio'),
    sa.Column('corretora_id', sa.UUID(), nullable=False, comment='ID da corretora onde est√° a posi√ß√£o'),
    sa.Column('ativo_id', sa.UUID(), nullable=False, comment='ID do ativo'),
    sa.Column('quantidade', sa.Numeric(precision=18, scale=8), nullable=False, comment='Quantidade de ativos (suporta fracion√°rios)'),
    sa.Column('preco_medio', sa.Numeric(precision=18, scale=6), nullable=False, comment='Pre√ßo m√©dio de aquisi√ß√£o'),
    sa.Column('custo_total', sa.Numeric(precision=18, scale=2), nullable=False, comment='Custo total investido (quantidade * pre√ßo m√©dio)'),
    sa.Column('taxas_acumuladas', sa.Numeric(precision=18, scale=2), nullable=False, comment='Taxas de corretagem e cust√≥dia acumuladas'),
    sa.Column('impostos_acumulados', sa.Numeric(precision=18, scale=2), nullable=False, comment='Impostos pagos acumulados (IR, IOF, etc.)'),
    sa.Column('valor_atual', sa.Numeric(precision=18, scale=2), nullable=True, comment='Valor de mercado atual da posi√ß√£o'),
    sa.Column('lucro_prejuizo_realizado', sa.Numeric(precision=18, scale=2), nullable=False, comment='Lucro/preju√≠zo realizado em vendas'),
    sa.Column('lucro_prejuizo_nao_realizado', sa.Numeric(precision=18, scale=2), nullable=True, comment='Lucro/preju√≠zo n√£o realizado (marca√ß√£o a mercado)'),
    sa.Column('data_primeira_compra', sa.Date(), nullable=True, comment='Data da primeira aquisi√ß√£o deste ativo'),
    sa.Column('data_ultima_atualizacao', sa.DateTime(timezone=True), nullable=True, comment='Data da √∫ltima atualiza√ß√£o de valores'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint('custo_total >= 0', name='posicao_custo_total_positivo'),
    sa.CheckConstraint('impostos_acumulados >= 0', name='posicao_impostos_positivos'),
    sa.CheckConstraint('preco_medio >= 0', name='posicao_preco_medio_positivo'),
    sa.CheckConstraint('quantidade >= 0', name='posicao_quantidade_positiva'),
    sa.CheckConstraint('taxas_acumuladas >= 0', name='posicao_taxas_positivas'),
    sa.ForeignKeyConstraint(['ativo_id'], ['ativo.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['corretora_id'], ['corretora.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['usuario_id'], ['usuario.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    sa.UniqueConstraint('usuario_id', 'corretora_id', 'ativo_id', name='unique_posicao_usuario_corretora_ativo'),
    comment='Tabela de posi√ß√µes em carteira (holdings)'
    )
    op.create_index(op.f('ix_posicao_ativo_id'), 'posicao', ['ativo_id'], unique=False)
    op.create_index(op.f('ix_posicao_corretora_id'), 'posicao', ['corretora_id'], unique=False)
    op.create_index(op.f('ix_posicao_data_primeira_compra'), 'posicao', ['data_primeira_compra'], unique=False)
    op.create_index(op.f('ix_posicao_data_ultima_atualizacao'), 'posicao', ['data_ultima_atualizacao'], unique=False)
    op.create_index(op.f('ix_posicao_usuario_id'), 'posicao', ['usuario_id'], unique=False)
    op.create_table('transacao',
    sa.Column('id', sa.UUID(), nullable=False, comment='Identificador √∫nico da transa√ß√£o'),
    sa.Column('usuario_id', sa.UUID(), nullable=False, comment='ID do usu√°rio'),
    sa.Column('corretora_id', sa.UUID(), nullable=False, comment='ID da corretora'),
    sa.Column('ativo_id', sa.UUID(), nullable=False, comment='ID do ativo transacionado'),
    sa.Column('tipo_operacao', sa.Enum('COMPRA', 'VENDA', name='tipooperacao'), nullable=False, comment='Tipo de opera√ß√£o: COMPRA ou VENDA'),
    sa.Column('quantidade', sa.Numeric(precision=18, scale=8), nullable=False, comment='Quantidade transacionada (suporta fracion√°rios)'),
    sa.Column('preco_unitario', sa.Numeric(precision=18, scale=6), nullable=False, comment='Pre√ßo por unidade'),
    sa.Column('valor_total', sa.Numeric(precision=18, scale=2), nullable=False, comment='Valor total da opera√ß√£o (quantidade * pre√ßo)'),
    sa.Column('taxas', sa.Numeric(precision=18, scale=2), nullable=False, comment='Taxas de corretagem, cust√≥dia, emolumentos'),
    sa.Column('impostos', sa.Numeric(precision=18, scale=2), nullable=False, comment='IR retido na fonte, IOF, etc.'),
    sa.Column('data_operacao', sa.Date(), nullable=False, comment='Data da opera√ß√£o'),
    sa.Column('data_liquidacao', sa.Date(), nullable=True, comment='Data de liquida√ß√£o (D+2, D+3, etc.)'),
    sa.Column('observacoes', sa.Text(), nullable=True, comment='Observa√ß√µes sobre a transa√ß√£o'),
    sa.Column('created_at', sa.DateTime(timezone=True), nullable=False, comment='Data de cria√ß√£o do registro'),
    sa.Column('updated_at', sa.DateTime(timezone=True), nullable=False, comment='Data da √∫ltima atualiza√ß√£o'),
    sa.CheckConstraint('data_liquidacao IS NULL OR data_liquidacao >= data_operacao', name='transacao_data_liquidacao_valida'),
    sa.CheckConstraint('impostos >= 0', name='transacao_impostos_positivos'),
    sa.CheckConstraint('preco_unitario > 0', name='transacao_preco_positivo'),
    sa.CheckConstraint('quantidade > 0', name='transacao_quantidade_positiva'),
    sa.CheckConstraint('taxas >= 0', name='transacao_taxas_positivas'),
    sa.CheckConstraint('valor_total > 0', name='transacao_valor_total_positivo'),
    sa.ForeignKeyConstraint(['ativo_id'], ['ativo.id'], ondelete='RESTRICT'),
    sa.ForeignKeyConstraint(['corretora_id'], ['corretora.id'], ondelete='CASCADE'),
    sa.ForeignKeyConstraint(['usuario_id'], ['usuario.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id'),
    comment='Tabela de transa√ß√µes de compra e venda de ativos'
    )
    op.create_index(op.f('ix_transacao_ativo_id'), 'transacao', ['ativo_id'], unique=False)
    op.create_index(op.f('ix_transacao_corretora_id'), 'transacao', ['corretora_id'], unique=False)
    op.create_index(op.f('ix_transacao_data_liquidacao'), 'transacao', ['data_liquidacao'], unique=False)
    op.create_index(op.f('ix_transacao_data_operacao'), 'transacao', ['data_operacao'], unique=False)
    op.create_index(op.f('ix_transacao_tipo_operacao'), 'transacao', ['tipo_operacao'], unique=False)
    op.create_index(op.f('ix_transacao_usuario_id'), 'transacao', ['usuario_id'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_transacao_usuario_id'), table_name='transacao')
    op.drop_index(op.f('ix_transacao_tipo_operacao'), table_name='transacao')
    op.drop_index(op.f('ix_transacao_data_operacao'), table_name='transacao')
    op.drop_index(op.f('ix_transacao_data_liquidacao'), table_name='transacao')
    op.drop_index(op.f('ix_transacao_corretora_id'), table_name='transacao')
    op.drop_index(op.f('ix_transacao_ativo_id'), table_name='transacao')
    op.drop_table('transacao')
    op.drop_index(op.f('ix_posicao_usuario_id'), table_name='posicao')
    op.drop_index(op.f('ix_posicao_data_ultima_atualizacao'), table_name='posicao')
    op.drop_index(op.f('ix_posicao_data_primeira_compra'), table_name='posicao')
    op.drop_index(op.f('ix_posicao_corretora_id'), table_name='posicao')
    op.drop_index(op.f('ix_posicao_ativo_id'), table_name='posicao')
    op.drop_table('posicao')
    op.drop_index(op.f('ix_movimentacao_caixa_usuario_id'), table_name='movimentacao_caixa')
    op.drop_index(op.f('ix_movimentacao_caixa_tipo_movimentacao'), table_name='movimentacao_caixa')
    op.drop_index(op.f('ix_movimentacao_caixa_provento_id'), table_name='movimentacao_caixa')
    op.drop_index(op.f('ix_movimentacao_caixa_moeda'), table_name='movimentacao_caixa')
    op.drop_index(op.f('ix_movimentacao_caixa_data_movimentacao'), table_name='movimentacao_caixa')
    op.drop_index(op.f('ix_movimentacao_caixa_corretora_id'), table_name='movimentacao_caixa')
    op.drop_index(op.f('ix_movimentacao_caixa_corretora_destino_id'), table_name='movimentacao_caixa')
    op.drop_table('movimentacao_caixa')
    op.drop_index(op.f('ix_provento_tipo_provento'), table_name='provento')
    op.drop_index(op.f('ix_provento_data_pagamento'), table_name='provento')
    op.drop_index(op.f('ix_provento_data_com'), table_name='provento')
    op.drop_index(op.f('ix_provento_ativo_id'), table_name='provento')
    op.drop_table('provento')
    op.drop_index(op.f('ix_log_auditoria_usuario_id'), table_name='log_auditoria')
    op.drop_index(op.f('ix_log_auditoria_timestamp'), table_name='log_auditoria')
    op.drop_index(op.f('ix_log_auditoria_sucesso'), table_name='log_auditoria')
    op.drop_index(op.f('ix_log_auditoria_ip_address'), table_name='log_auditoria')
    op.drop_index(op.f('ix_log_auditoria_entidade_id'), table_name='log_auditoria')
    op.drop_index(op.f('ix_log_auditoria_entidade'), table_name='log_auditoria')
    op.drop_index(op.f('ix_log_auditoria_acao'), table_name='log_auditoria')
    op.drop_table('log_auditoria')
    op.drop_index(op.f('ix_evento_corporativo_tipo_evento'), table_name='evento_corporativo')
    op.drop_index(op.f('ix_evento_corporativo_impacto_posicoes'), table_name='evento_corporativo')
    op.drop_index(op.f('ix_evento_corporativo_data_evento'), table_name='evento_corporativo')
    op.drop_index(op.f('ix_evento_corporativo_data_com'), table_name='evento_corporativo')
    op.drop_index(op.f('ix_evento_corporativo_ativo_novo_id'), table_name='evento_corporativo')
    op.drop_index(op.f('ix_evento_corporativo_ativo_id'), table_name='evento_corporativo')
    op.drop_table('evento_corporativo')
    op.drop_index(op.f('ix_corretora_usuario_id'), table_name='corretora')
    op.drop_index(op.f('ix_corretora_tipo'), table_name='corretora')
    op.drop_index(op.f('ix_corretora_pais'), table_name='corretora')
    op.drop_index(op.f('ix_corretora_nome'), table_name='corretora')
    op.drop_index(op.f('ix_corretora_moeda_padrao'), table_name='corretora')
    op.drop_index(op.f('ix_corretora_ativa'), table_name='corretora')
    op.drop_table('corretora')
    op.drop_index(op.f('ix_usuario_username'), table_name='usuario')
    op.drop_index(op.f('ix_usuario_email'), table_name='usuario')
    op.drop_table('usuario')
    op.drop_index(op.f('ix_regra_fiscal_vigencia_inicio'), table_name='regra_fiscal')
    op.drop_index(op.f('ix_regra_fiscal_vigencia_fim'), table_name='regra_fiscal')
    op.drop_index(op.f('ix_regra_fiscal_tipo_operacao'), table_name='regra_fiscal')
    op.drop_index(op.f('ix_regra_fiscal_tipo_ativo'), table_name='regra_fiscal')
    op.drop_index(op.f('ix_regra_fiscal_pais'), table_name='regra_fiscal')
    op.drop_index(op.f('ix_regra_fiscal_incide_sobre'), table_name='regra_fiscal')
    op.drop_index(op.f('ix_regra_fiscal_ativa'), table_name='regra_fiscal')
    op.drop_table('regra_fiscal')
    op.drop_index(op.f('ix_fonte_dados_ultima_consulta'), table_name='fonte_dados')
    op.drop_index(op.f('ix_fonte_dados_tipo_fonte'), table_name='fonte_dados')
    op.drop_index(op.f('ix_fonte_dados_prioridade'), table_name='fonte_dados')
    op.drop_index(op.f('ix_fonte_dados_nome'), table_name='fonte_dados')
    op.drop_index(op.f('ix_fonte_dados_ativa'), table_name='fonte_dados')
    op.drop_table('fonte_dados')
    op.drop_index(op.f('ix_feriado_mercado_tipo_feriado'), table_name='feriado_mercado')
    op.drop_index(op.f('ix_feriado_mercado_recorrente'), table_name='feriado_mercado')
    op.drop_index(op.f('ix_feriado_mercado_pais'), table_name='feriado_mercado')
    op.drop_index(op.f('ix_feriado_mercado_mercado'), table_name='feriado_mercado')
    op.drop_index(op.f('ix_feriado_mercado_data_feriado'), table_name='feriado_mercado')
    op.drop_table('feriado_mercado')
    op.drop_index(op.f('ix_ativo_tipo'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_ticker'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_nome'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_moeda'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_mercado'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_deslistado'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_data_ultima_cotacao'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_classe'), table_name='ativo')
    op.drop_index(op.f('ix_ativo_ativo'), table_name='ativo')
    op.drop_table('ativo')
    # ### end Alembic commands ###

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/__init__.py ---
# -*- coding: utf-8 -*-
"""Exitus Backend - Application Factory"""

from flask import Flask
from flask_cors import CORS
from .config import Config
from .database import init_db


def create_app():
    """Cria e configura a aplica√ß√£o Flask"""
    app = Flask(__name__)

    # Carrega configura√ß√µes
    app.config.from_object(Config)

    # Habilita CORS
    CORS(app)
    
    # Inicializa banco de dados
    init_db(app)

    # Health check route
    @app.route('/health')
    def health():
        return {
            'status': 'ok',
            'service': 'exitus-backend',
            'env': app.config.get('FLASK_ENV', 'unknown')
        }, 200

    return app

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/config.py ---
# -*- coding: utf-8 -*-
"""Exitus Backend - Configuration"""

import os
from dotenv import load_dotenv

# Carrega .env se existir
load_dotenv()

class Config:
    """Configura√ß√µes da aplica√ß√£o"""

    # Database
    POSTGRES_HOST = os.getenv('POSTGRES_HOST', 'localhost')
    POSTGRES_USER = os.getenv('POSTGRES_USER', 'exitus')
    POSTGRES_PASSWORD = os.getenv('POSTGRES_PASSWORD', 'exitus123')
    POSTGRES_DB = os.getenv('POSTGRES_DB', 'exitusdb')
    POSTGRES_PORT = os.getenv('POSTGRES_PORT', '5432')

    # Flask
    SECRET_KEY = os.getenv('SECRET_KEY', 'dev-secret-key-change-in-production')
    FLASK_ENV = os.getenv('FLASK_ENV', 'development')

    # SQLAlchemy
    SQLALCHEMY_DATABASE_URI = (
        f"postgresql://{POSTGRES_USER}:{POSTGRES_PASSWORD}@"
        f"{POSTGRES_HOST}:{POSTGRES_PORT}/{POSTGRES_DB}"
    )
    SQLALCHEMY_TRACK_MODIFICATIONS = False

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/database.py ---
# -*- coding: utf-8 -*-
"""Exitus Backend - Database Configuration"""

from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

# Inst√¢ncias globais
db = SQLAlchemy()
migrate = Migrate()


def init_db(app):
    """Inicializa o banco de dados com a aplica√ß√£o Flask"""
    db.init_app(app)
    migrate.init_app(app, db)
    
    with app.app_context():
        # Importa todos os models para que Alembic os detecte
        from app.models import (
            Usuario, UserRole,
            Corretora, TipoCorretora,
            Ativo, TipoAtivo, ClasseAtivo,
            Posicao,
            Transacao, TipoOperacao,
            Provento, TipoProvento,
            MovimentacaoCaixa, TipoMovimentacao,
            EventoCorporativo, TipoEventoCorporativo,
            FonteDados, TipoFonteDados,
            RegraFiscal, IncidenciaImposto,
            FeriadoMercado, TipoFeriado,
            LogAuditoria
        )
    
    return db

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/database.py.bak ---
# -*- coding: utf-8 -*-
"""Exitus Backend - Database Configuration"""

from flask_sqlalchemy import SQLAlchemy
from flask_migrate import Migrate

# Inst√¢ncias globais
db = SQLAlchemy()
migrate = Migrate()


def init_db(app):
    """Inicializa o banco de dados com a aplica√ß√£o Flask"""
    db.init_app(app)
    migrate.init_app(app, db)
    
    with app.app_context():
        # Importa todos os models (apenas quando existirem)
        # COMENTADO at√© criarmos os models na Fase 2
        # from app.models import (
        #     usuario, corretora, ativo, posicao, transacao,
        #     provento, movimentacao_caixa, evento_corporativo,
        #     fonte_dados, regra_fiscal, feriado_mercado, log_auditoria
        # )
        pass
    
    return db

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/__init__.py ---
# -*- coding: utf-8 -*-
"""Exitus - Models Package"""

from app.database import db

# Importar models criados
from .usuario import Usuario, UserRole
from .corretora import Corretora, TipoCorretora
from .ativo import Ativo, TipoAtivo, ClasseAtivo
from .posicao import Posicao
from .transacao import Transacao, TipoOperacao
from .provento import Provento, TipoProvento
from .movimentacao_caixa import MovimentacaoCaixa, TipoMovimentacao
from .evento_corporativo import EventoCorporativo, TipoEventoCorporativo
from .fonte_dados import FonteDados, TipoFonteDados
from .regra_fiscal import RegraFiscal, IncidenciaImposto
from .feriado_mercado import FeriadoMercado, TipoFeriado
from .log_auditoria import LogAuditoria

# Exportar para facilitar imports
__all__ = [
    'db',
    'Usuario',
    'UserRole',
    'Corretora',
    'TipoCorretora',
    'Ativo',
    'TipoAtivo',
    'ClasseAtivo',
    'Posicao',
    'Transacao',
    'TipoOperacao',
    'Provento',
    'TipoProvento',
    'MovimentacaoCaixa',
    'TipoMovimentacao',
    'EventoCorporativo',
    'TipoEventoCorporativo',
    'FonteDados',
    'TipoFonteDados',
    'RegraFiscal',
    'IncidenciaImposto',
    'FeriadoMercado',
    'TipoFeriado',
    'LogAuditoria'
]

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/ativo.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model Ativo
Entidade para instrumentos financeiros (a√ß√µes, FIIs, REITs, bonds, criptomoedas)
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Enum, Numeric, Text, Date
from sqlalchemy.dialects.postgresql import UUID
import uuid
import enum


class TipoAtivo(enum.Enum):
    """Enum para tipos de ativo"""
    ACAO = "acao"              # A√ß√£o
    FII = "fii"                # Fundo Imobili√°rio
    REIT = "reit"              # Real Estate Investment Trust
    BOND = "bond"              # T√≠tulo de renda fixa
    ETF = "etf"                # Exchange Traded Fund
    CRIPTO = "cripto"          # Criptomoeda
    OUTRO = "outro"            # Outros tipos


class ClasseAtivo(enum.Enum):
    """Enum para classes de ativo"""
    RENDA_VARIAVEL = "renda_variavel"
    RENDA_FIXA = "renda_fixa"
    CRIPTO = "cripto"
    HIBRIDO = "hibrido"


class Ativo(db.Model):
    """
    Model para ativos financeiros (a√ß√µes, FIIs, REITs, bonds, criptomoedas)
    
    Attributes:
        id (UUID): Identificador √∫nico
        ticker (str): C√≥digo/s√≠mbolo do ativo (ex: PETR4, AAPL)
        nome (str): Nome completo do ativo
        tipo (TipoAtivo): Tipo do ativo
        classe (ClasseAtivo): Classe do ativo
        mercado (str): Mercado/pa√≠s (BR, US, EUR)
        moeda (str): Moeda de negocia√ß√£o (BRL, USD, EUR)
        preco_atual (Decimal): Pre√ßo/cota√ß√£o atual
        data_ultima_cotacao (datetime): Data da √∫ltima cota√ß√£o
        dividend_yield (Decimal): Dividend Yield (%)
        p_l (Decimal): √çndice Pre√ßo/Lucro
        p_vp (Decimal): √çndice Pre√ßo/Valor Patrimonial
        roe (Decimal): Return on Equity (%)
        ativo (bool): Indica se ativo est√° ativo para negocia√ß√£o
        deslistado (bool): Indica se foi deslistado da bolsa
        data_deslistagem (date): Data de deslistagem (se aplic√°vel)
        observacoes (str): Observa√ß√µes gerais
        created_at (datetime): Data de cria√ß√£o
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        posicoes: Posi√ß√µes deste ativo nos portfolios
        transacoes: Transa√ß√µes realizadas com este ativo
        proventos: Proventos distribu√≠dos por este ativo
        eventos_corporativos: Eventos corporativos deste ativo
    """
    
    __tablename__ = 'ativo'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico do ativo"
    )
    
    # Identifica√ß√£o do ativo
    ticker = db.Column(
        String(20),
        nullable=False,
        index=True,
        comment="C√≥digo/s√≠mbolo do ativo (ex: PETR4, AAPL, BTC)"
    )
    
    nome = db.Column(
        String(200),
        nullable=False,
        index=True,
        comment="Nome completo do ativo"
    )
    
    tipo = db.Column(
        Enum(TipoAtivo),
        nullable=False,
        index=True,
        comment="Tipo do ativo (a√ß√£o, FII, REIT, bond, cripto)"
    )
    
    classe = db.Column(
        Enum(ClasseAtivo),
        nullable=False,
        index=True,
        comment="Classe do ativo (renda vari√°vel, fixa, cripto)"
    )
    
    # Mercado e moeda
    mercado = db.Column(
        String(10),
        nullable=False,
        default='BR',
        index=True,
        comment="Mercado/pa√≠s de negocia√ß√£o (BR, US, EUR)"
    )
    
    moeda = db.Column(
        String(3),
        nullable=False,
        default='BRL',
        index=True,
        comment="Moeda de negocia√ß√£o (BRL, USD, EUR)"
    )
    
    # Cota√ß√£o
    preco_atual = db.Column(
        Numeric(precision=18, scale=6),
        nullable=True,
        comment="Pre√ßo/cota√ß√£o atual do ativo"
    )
    
    data_ultima_cotacao = db.Column(
        DateTime(timezone=True),
        nullable=True,
        index=True,
        comment="Data e hora da √∫ltima cota√ß√£o"
    )
    
    # Indicadores financeiros
    dividend_yield = db.Column(
        Numeric(precision=8, scale=4),
        nullable=True,
        comment="Dividend Yield em % (ex: 6.5000 = 6.5%)"
    )
    
    p_l = db.Column(
        Numeric(precision=10, scale=2),
        nullable=True,
        comment="√çndice Pre√ßo/Lucro"
    )
    
    p_vp = db.Column(
        Numeric(precision=10, scale=2),
        nullable=True,
        comment="√çndice Pre√ßo/Valor Patrimonial"
    )
    
    roe = db.Column(
        Numeric(precision=8, scale=4),
        nullable=True,
        comment="Return on Equity em %"
    )
    
    # Status
    ativo = db.Column(
        Boolean,
        default=True,
        nullable=False,
        index=True,
        comment="Indica se ativo est√° dispon√≠vel para negocia√ß√£o"
    )
    
    deslistado = db.Column(
        Boolean,
        default=False,
        nullable=False,
        index=True,
        comment="Indica se ativo foi deslistado da bolsa"
    )
    
    data_deslistagem = db.Column(
        Date,
        nullable=True,
        comment="Data de deslistagem (se aplic√°vel)"
    )
    
    # Metadados
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes e notas sobre o ativo"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos futuros (descomentar quando criar os models)
    # posicoes = relationship('Posicao', back_populates='ativo', lazy='dynamic')
    # transacoes = relationship('Transacao', back_populates='ativo', lazy='dynamic')
    # proventos = relationship('Provento', back_populates='ativo', lazy='dynamic')
    # eventos_corporativos = relationship('EventoCorporativo', back_populates='ativo', lazy='dynamic')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "preco_atual IS NULL OR preco_atual >= 0",
            name="ativo_preco_positivo"
        ),
        db.CheckConstraint(
            "length(ticker) >= 1",
            name="ativo_ticker_min_length"
        ),
        db.CheckConstraint(
            "length(nome) >= 2",
            name="ativo_nome_min_length"
        ),
        db.UniqueConstraint(
            'ticker', 'mercado',
            name='unique_ativo_ticker_mercado'
        ),
        {'comment': 'Tabela de ativos financeiros (a√ß√µes, FIIs, REITs, bonds, criptomoedas)'}
    )
    
    def is_active(self):
        """Verifica se ativo est√° ativo"""
        return self.ativo and not self.deslistado
    
    def is_renda_fixa(self):
        """Verifica se √© ativo de renda fixa"""
        return self.classe == ClasseAtivo.RENDA_FIXA
    
    def is_renda_variavel(self):
        """Verifica se √© ativo de renda vari√°vel"""
        return self.classe == ClasseAtivo.RENDA_VARIAVEL
    
    def is_cripto(self):
        """Verifica se √© criptomoeda"""
        return self.tipo == TipoAtivo.CRIPTO or self.classe == ClasseAtivo.CRIPTO
    
    def atualizar_cotacao(self, preco, data_cotacao=None):
        """
        Atualiza a cota√ß√£o do ativo
        
        Args:
            preco (Decimal): Novo pre√ßo
            data_cotacao (datetime): Data da cota√ß√£o (default: agora)
        
        Raises:
            ValueError: Se pre√ßo for negativo
        """
        if preco < 0:
            raise ValueError(f"Pre√ßo n√£o pode ser negativo: {preco}")
        
        self.preco_atual = preco
        self.data_ultima_cotacao = data_cotacao or datetime.utcnow()
    
    def atualizar_indicadores(self, dy=None, pl=None, pvp=None, roe_value=None):
        """
        Atualiza indicadores financeiros do ativo
        
        Args:
            dy (Decimal): Dividend Yield
            pl (Decimal): √çndice P/L
            pvp (Decimal): √çndice P/VP
            roe_value (Decimal): ROE
        """
        if dy is not None:
            self.dividend_yield = dy
        if pl is not None:
            self.p_l = pl
        if pvp is not None:
            self.p_vp = pvp
        if roe_value is not None:
            self.roe = roe_value
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados do ativo
        """
        return {
            'id': str(self.id),
            'ticker': self.ticker,
            'nome': self.nome,
            'tipo': self.tipo.value if self.tipo else None,
            'classe': self.classe.value if self.classe else None,
            'mercado': self.mercado,
            'moeda': self.moeda,
            'preco_atual': float(self.preco_atual) if self.preco_atual else None,
            'data_ultima_cotacao': self.data_ultima_cotacao.isoformat() if self.data_ultima_cotacao else None,
            'dividend_yield': float(self.dividend_yield) if self.dividend_yield else None,
            'p_l': float(self.p_l) if self.p_l else None,
            'p_vp': float(self.p_vp) if self.p_vp else None,
            'roe': float(self.roe) if self.roe else None,
            'ativo': self.ativo,
            'deslistado': self.deslistado,
            'data_deslistagem': self.data_deslistagem.isoformat() if self.data_deslistagem else None,
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        return f"<Ativo {self.ticker} - {self.nome} ({self.mercado})>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/corretora.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model Corretora
Entidade para gest√£o de contas de investimento (corretoras e exchanges)
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Enum, Numeric, Text, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid
import enum


class TipoCorretora(enum.Enum):
    """Enum para tipos de corretora"""
    CORRETORA = "corretora"  # Corretora tradicional
    EXCHANGE = "exchange"     # Exchange de criptomoedas


class Corretora(db.Model):
    """
    Model para corretoras/exchanges de investimento
    
    Attributes:
        id (UUID): Identificador √∫nico
        usuario_id (UUID): ID do usu√°rio propriet√°rio
        nome (str): Nome da corretora
        tipo (TipoCorretora): Tipo (corretora ou exchange)
        pais (str): C√≥digo ISO do pa√≠s (BR, US, etc.)
        moeda_padrao (str): Moeda padr√£o (BRL, USD, EUR)
        saldo_atual (Decimal): Saldo dispon√≠vel em caixa
        ativa (bool): Indica se conta est√° ativa
        observacoes (str): Observa√ß√µes do usu√°rio
        created_at (datetime): Data de cria√ß√£o
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        usuario: Usu√°rio propriet√°rio da conta
        posicoes: Posi√ß√µes de ativos nesta corretora
        transacoes: Transa√ß√µes realizadas nesta corretora
        movimentacoes_caixa: Movimenta√ß√µes de caixa desta corretora
    """
    
    __tablename__ = 'corretora'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico da corretora"
    )
    
    # Foreign key para Usuario
    usuario_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('usuario.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID do usu√°rio propriet√°rio"
    )
    
    # Dados da corretora
    nome = db.Column(
        String(100),
        nullable=False,
        index=True,
        comment="Nome da corretora/exchange (ex: XP, Clear, Binance)"
    )
    
    tipo = db.Column(
        Enum(TipoCorretora),
        default=TipoCorretora.CORRETORA,
        nullable=False,
        index=True,
        comment="Tipo: corretora tradicional ou exchange cripto"
    )
    
    pais = db.Column(
        String(2),
        nullable=False,
        default='BR',
        index=True,
        comment="C√≥digo ISO 3166-1 alpha-2 do pa√≠s (BR, US, etc.)"
    )
    
    moeda_padrao = db.Column(
        String(3),
        nullable=False,
        default='BRL',
        index=True,
        comment="C√≥digo ISO 4217 da moeda (BRL, USD, EUR)"
    )
    
    saldo_atual = db.Column(
        Numeric(precision=18, scale=2),
        default=0.00,
        nullable=False,
        comment="Saldo dispon√≠vel em caixa (na moeda padr√£o)"
    )
    
    # Status e metadados
    ativa = db.Column(
        Boolean,
        default=True,
        nullable=False,
        index=True,
        comment="Indica se conta est√° ativa"
    )
    
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes e notas do usu√°rio sobre a conta"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos
    usuario = relationship(
        'Usuario',
        backref='corretoras',
        lazy='joined'
    )
    
    # Relacionamentos futuros (descomentar quando criar os models)
    # posicoes = relationship('Posicao', back_populates='corretora', lazy='dynamic')
    # transacoes = relationship('Transacao', back_populates='corretora', lazy='dynamic')
    # movimentacoes_caixa = relationship('MovimentacaoCaixa', back_populates='corretora', lazy='dynamic')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "saldo_atual >= 0",
            name="corretora_saldo_positivo"
        ),
        db.CheckConstraint(
            "length(nome) >= 2",
            name="corretora_nome_min_length"
        ),
        db.CheckConstraint(
            "pais ~* '^[A-Z]{2}$'",
            name="corretora_pais_iso_format"
        ),
        db.CheckConstraint(
            "moeda_padrao ~* '^[A-Z]{3}$'",
            name="corretora_moeda_iso_format"
        ),
        db.UniqueConstraint(
            'usuario_id', 'nome', 'pais',
            name='unique_corretora_usuario_nome_pais'
        ),
        {'comment': 'Tabela de corretoras e contas de investimento'}
    )
    
    def is_active(self):
        """Verifica se corretora est√° ativa"""
        return self.ativa
    
    def is_exchange(self):
        """Verifica se √© exchange de criptomoedas"""
        return self.tipo == TipoCorretora.EXCHANGE
    
    def atualizar_saldo(self, valor, operacao='credito'):
        """
        Atualiza o saldo da corretora
        
        Args:
            valor (Decimal): Valor a ser creditado/debitado
            operacao (str): 'credito' ou 'debito'
        
        Raises:
            ValueError: Se saldo ficar negativo ou opera√ß√£o inv√°lida
        """
        if operacao == 'credito':
            self.saldo_atual += valor
        elif operacao == 'debito':
            if self.saldo_atual < valor:
                raise ValueError(f"Saldo insuficiente. Dispon√≠vel: {self.saldo_atual}, Solicitado: {valor}")
            self.saldo_atual -= valor
        else:
            raise ValueError(f"Opera√ß√£o inv√°lida: {operacao}. Use 'credito' ou 'debito'")
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados da corretora
        """
        return {
            'id': str(self.id),
            'usuario_id': str(self.usuario_id),
            'nome': self.nome,
            'tipo': self.tipo.value if self.tipo else TipoCorretora.CORRETORA.value,
            'pais': self.pais,
            'moeda_padrao': self.moeda_padrao,
            'saldo_atual': float(self.saldo_atual) if self.saldo_atual else 0.0,
            'ativa': self.ativa,
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        return f"<Corretora {self.nome} ({self.pais}/{self.moeda_padrao})>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/evento_corporativo.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model EventoCorporativo
Entidade para eventos corporativos que afetam ativos
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, DateTime, Enum, Boolean, Text, Date, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid
import enum


class TipoEventoCorporativo(enum.Enum):
    """Enum para tipos de evento corporativo"""
    SPLIT = "split"                          # Desdobramento (ex: 1 a√ß√£o vira 2)
    GRUPAMENTO = "grupamento"                # Grupamento/Inplit (ex: 10 a√ß√µes viram 1)
    BONIFICACAO = "bonificacao"              # Bonifica√ß√£o em a√ß√µes
    DIREITO_SUBSCRICAO = "direito_sub"       # Direito de subscri√ß√£o
    FUSAO = "fusao"                          # Fus√£o com outra empresa
    CISAO = "cisao"                          # Cis√£o (spin-off)
    INCORPORACAO = "incorporacao"            # Incorpora√ß√£o por outra empresa
    MUDANCA_TICKER = "mudanca_ticker"        # Mudan√ßa de c√≥digo
    DESLISTAGEM = "deslistagem"              # Deslistagem da bolsa
    RELISTING = "relisting"                  # Relistagem
    CANCELAMENTO = "cancelamento"            # Cancelamento de a√ß√µes
    OUTRO = "outro"                          # Outros eventos


class EventoCorporativo(db.Model):
    """
    Model para eventos corporativos que afetam ativos
    
    Attributes:
        id (UUID): Identificador √∫nico
        ativo_id (UUID): ID do ativo afetado
        tipo_evento (TipoEventoCorporativo): Tipo do evento
        data_evento (date): Data do evento
        data_com (date): Data COM (√∫ltimo dia para ter direito)
        proporcao (str): Propor√ß√£o do evento (ex: "2:1", "1:10")
        ativo_novo_id (UUID): ID do novo ativo (fus√µes, mudan√ßas)
        descricao (str): Descri√ß√£o detalhada do evento
        impacto_posicoes (bool): Indica se posi√ß√µes j√° foram ajustadas
        observacoes (str): Observa√ß√µes adicionais
        created_at (datetime): Data de cria√ß√£o do registro
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        ativo: Ativo original afetado
        ativo_novo: Novo ativo (para fus√µes, mudan√ßas de ticker)
    """
    
    __tablename__ = 'evento_corporativo'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico do evento"
    )
    
    # Foreign keys
    ativo_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('ativo.id', ondelete='RESTRICT'),
        nullable=False,
        index=True,
        comment="ID do ativo afetado pelo evento"
    )
    
    ativo_novo_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('ativo.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        comment="ID do novo ativo (fus√µes, mudan√ßas de ticker)"
    )
    
    # Dados do evento
    tipo_evento = db.Column(
        Enum(TipoEventoCorporativo),
        nullable=False,
        index=True,
        comment="Tipo do evento corporativo"
    )
    
    data_evento = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data do evento"
    )
    
    data_com = db.Column(
        Date,
        nullable=True,
        index=True,
        comment="Data COM (√∫ltimo dia para ter direito ao evento)"
    )
    
    proporcao = db.Column(
        String(20),
        nullable=True,
        comment="Propor√ß√£o do evento (ex: '2:1', '1:10', '1:1.5')"
    )
    
    descricao = db.Column(
        Text,
        nullable=False,
        comment="Descri√ß√£o detalhada do evento"
    )
    
    # Controle de processamento
    impacto_posicoes = db.Column(
        Boolean,
        default=False,
        nullable=False,
        index=True,
        comment="Indica se as posi√ß√µes j√° foram ajustadas"
    )
    
    # Metadados
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes adicionais sobre o evento"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos
    ativo = relationship(
        'Ativo',
        foreign_keys=[ativo_id],
        backref='eventos_corporativos',
        lazy='joined'
    )
    ativo_novo = relationship(
        'Ativo',
        foreign_keys=[ativo_novo_id],
        lazy='joined'
    )
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "data_com IS NULL OR data_com <= data_evento",
            name="evento_data_com_valida"
        ),
        db.CheckConstraint(
            """
            (tipo_evento IN ('split', 'grupamento', 'bonificacao') AND proporcao IS NOT NULL)
            OR 
            (tipo_evento NOT IN ('split', 'grupamento', 'bonificacao'))
            """,
            name="evento_proporcao_obrigatoria"
        ),
        {'comment': 'Tabela de eventos corporativos que afetam ativos'}
    )
    
    def is_split(self):
        """Verifica se √© split (desdobramento)"""
        return self.tipo_evento == TipoEventoCorporativo.SPLIT
    
    def is_grupamento(self):
        """Verifica se √© grupamento (inplit)"""
        return self.tipo_evento == TipoEventoCorporativo.GRUPAMENTO
    
    def is_bonificacao(self):
        """Verifica se √© bonifica√ß√£o"""
        return self.tipo_evento == TipoEventoCorporativo.BONIFICACAO
    
    def is_mudanca_ticker(self):
        """Verifica se √© mudan√ßa de ticker"""
        return self.tipo_evento == TipoEventoCorporativo.MUDANCA_TICKER
    
    def parse_proporcao(self):
        """
        Faz parse da propor√ß√£o do evento
        
        Returns:
            tuple: (numerador, denominador) ou None se inv√°lido
            
        Examples:
            "2:1" -> (2.0, 1.0) # Split 2 para 1
            "1:10" -> (1.0, 10.0) # Grupamento 1 para 10
            "1:1.5" -> (1.0, 1.5) # Bonifica√ß√£o 50%
        """
        if not self.proporcao:
            return None
        
        try:
            parts = self.proporcao.split(':')
            if len(parts) == 2:
                return (float(parts[0]), float(parts[1]))
        except (ValueError, IndexError):
            pass
        
        return None
    
    def calcular_fator_ajuste(self):
        """
        Calcula o fator de ajuste para quantidade de ativos
        
        Returns:
            float: Fator multiplicador (ex: 2.0 para split 2:1, 0.1 para grupamento 1:10)
        """
        proporcao = self.parse_proporcao()
        if not proporcao:
            return 1.0
        
        numerador, denominador = proporcao
        
        if self.is_split() or self.is_bonificacao():
            # Split 2:1 ou Bonifica√ß√£o 1:1.5 -> multiplica quantidade
            return numerador / denominador
        elif self.is_grupamento():
            # Grupamento 1:10 -> divide quantidade (inverte propor√ß√£o)
            return numerador / denominador
        
        return 1.0
    
    def calcular_fator_ajuste_preco(self):
        """
        Calcula o fator de ajuste para pre√ßo m√©dio
        (inverso do ajuste de quantidade)
        
        Returns:
            float: Fator divisor para pre√ßo
        """
        fator_quantidade = self.calcular_fator_ajuste()
        if fator_quantidade > 0:
            return 1.0 / fator_quantidade
        return 1.0
    
    def marcar_como_processado(self):
        """Marca o evento como processado (posi√ß√µes ajustadas)"""
        self.impacto_posicoes = True
    
    def dias_ate_evento(self):
        """
        Calcula quantos dias faltam para o evento
        
        Returns:
            int: Dias at√© evento (negativo se j√° ocorreu)
        """
        hoje = datetime.utcnow().date()
        delta = self.data_evento - hoje
        return delta.days
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados do evento
        """
        return {
            'id': str(self.id),
            'ativo_id': str(self.ativo_id),
            'ativo_novo_id': str(self.ativo_novo_id) if self.ativo_novo_id else None,
            'tipo_evento': self.tipo_evento.value if self.tipo_evento else None,
            'data_evento': self.data_evento.isoformat() if self.data_evento else None,
            'data_com': self.data_com.isoformat() if self.data_com else None,
            'proporcao': self.proporcao,
            'fator_ajuste_quantidade': self.calcular_fator_ajuste(),
            'fator_ajuste_preco': self.calcular_fator_ajuste_preco(),
            'descricao': self.descricao,
            'impacto_posicoes': self.impacto_posicoes,
            'dias_ate_evento': self.dias_ate_evento(),
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        ticker = self.ativo.ticker if self.ativo else "N/A"
        tipo = self.tipo_evento.value if self.tipo_evento else "N/A"
        return f"<EventoCorporativo {tipo.upper()} {ticker} {self.proporcao or ''}>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/feriado_mercado.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model FeriadoMercado
Entidade para feriados e dias sem preg√£o
"""

from datetime import datetime, time
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Enum, Text, Date, Time
from sqlalchemy.dialects.postgresql import UUID
import uuid
import enum


class TipoFeriado(enum.Enum):
    """Enum para tipos de feriado"""
    NACIONAL = "nacional"            # Feriado nacional
    BOLSA = "bolsa"                  # Feriado espec√≠fico da bolsa
    PONTE = "ponte"                  # Ponto facultativo
    FECHAMENTO_ANTECIPADO = "antecip"  # Fechamento antecipado
    MANUTENCAO = "manutencao"        # Manuten√ß√£o de sistemas
    OUTRO = "outro"                  # Outros tipos


class FeriadoMercado(db.Model):
    """
    Model para feriados e dias sem preg√£o
    
    Attributes:
        id (UUID): Identificador √∫nico
        pais (str): Pa√≠s do feriado (c√≥digo ISO)
        mercado (str): Mercado/bolsa espec√≠fica
        data_feriado (date): Data do feriado
        tipo_feriado (TipoFeriado): Tipo do feriado
        nome (str): Nome do feriado
        horario_fechamento (time): Hor√°rio de fechamento antecipado
        recorrente (bool): Se √© feriado anual fixo
        observacoes (str): Observa√ß√µes sobre o feriado
        created_at (datetime): Data de cria√ß√£o
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    """
    
    __tablename__ = 'feriado_mercado'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico do feriado"
    )
    
    # Localiza√ß√£o
    pais = db.Column(
        String(2),
        nullable=False,
        index=True,
        comment="C√≥digo ISO do pa√≠s (BR, US, etc.)"
    )
    
    mercado = db.Column(
        String(20),
        nullable=True,
        index=True,
        comment="Mercado/bolsa espec√≠fica (B3, NYSE, NASDAQ, etc.) - NULL = todos"
    )
    
    # Dados do feriado
    data_feriado = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data do feriado"
    )
    
    tipo_feriado = db.Column(
        Enum(TipoFeriado),
        nullable=False,
        index=True,
        comment="Tipo do feriado"
    )
    
    nome = db.Column(
        String(200),
        nullable=False,
        comment="Nome do feriado"
    )
    
    horario_fechamento = db.Column(
        Time,
        nullable=True,
        comment="Hor√°rio de fechamento antecipado (se aplic√°vel)"
    )
    
    recorrente = db.Column(
        Boolean,
        default=False,
        nullable=False,
        index=True,
        comment="Indica se √© feriado anual fixo (sempre no mesmo dia/m√™s)"
    )
    
    # Metadados
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes sobre o feriado"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "pais ~* '^[A-Z]{2}$'",
            name="feriado_pais_iso_format"
        ),
        db.CheckConstraint(
            "length(nome) >= 3",
            name="feriado_nome_min_length"
        ),
        db.UniqueConstraint(
            'pais', 'mercado', 'data_feriado',
            name='unique_feriado_pais_mercado_data'
        ),
        {'comment': 'Tabela de feriados e dias sem preg√£o nos mercados'}
    )
    
    def is_fechamento_total(self):
        """Verifica se √© fechamento total (n√£o h√° preg√£o)"""
        return self.tipo_feriado in [
            TipoFeriado.NACIONAL,
            TipoFeriado.BOLSA,
            TipoFeriado.PONTE
        ]
    
    def is_fechamento_antecipado(self):
        """Verifica se √© fechamento antecipado"""
        return self.tipo_feriado == TipoFeriado.FECHAMENTO_ANTECIPADO
    
    def is_recorrente(self):
        """Verifica se √© feriado recorrente (anual)"""
        return self.recorrente
    
    def dias_ate_feriado(self):
        """
        Calcula quantos dias faltam para o feriado
        
        Returns:
            int: Dias at√© feriado (negativo se j√° passou)
        """
        hoje = datetime.utcnow().date()
        delta = self.data_feriado - hoje
        return delta.days
    
    def is_hoje(self):
        """Verifica se o feriado √© hoje"""
        return self.data_feriado == datetime.utcnow().date()
    
    def is_futuro(self):
        """Verifica se o feriado √© no futuro"""
        return self.data_feriado > datetime.utcnow().date()
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados do feriado
        """
        return {
            'id': str(self.id),
            'pais': self.pais,
            'mercado': self.mercado,
            'data_feriado': self.data_feriado.isoformat() if self.data_feriado else None,
            'tipo_feriado': self.tipo_feriado.value if self.tipo_feriado else None,
            'nome': self.nome,
            'horario_fechamento': self.horario_fechamento.isoformat() if self.horario_fechamento else None,
            'recorrente': self.recorrente,
            'is_fechamento_total': self.is_fechamento_total(),
            'is_fechamento_antecipado': self.is_fechamento_antecipado(),
            'dias_ate_feriado': self.dias_ate_feriado(),
            'is_hoje': self.is_hoje(),
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        return f"<FeriadoMercado {self.pais} {self.data_feriado} - {self.nome}>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/fonte_dados.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model FonteDados
Entidade para gerenciamento de fontes de dados externas (APIs)
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Enum, Integer, Text
from sqlalchemy.dialects.postgresql import UUID
import uuid
import enum


class TipoFonteDados(enum.Enum):
    """Enum para tipos de fonte de dados"""
    API = "api"              # API RESTful
    SCRAPER = "scraper"      # Web scraping
    MANUAL = "manual"        # Entrada manual
    ARQUIVO = "arquivo"      # Import de arquivo
    OUTRO = "outro"          # Outros tipos


class FonteDados(db.Model):
    """
    Model para fontes de dados externas
    
    Attributes:
        id (UUID): Identificador √∫nico
        nome (str): Nome da fonte
        tipo_fonte (TipoFonteDados): Tipo da fonte
        url_base (str): URL base da API/fonte
        requer_autenticacao (bool): Se requer chave API
        rate_limit (str): Limite de requisi√ß√µes
        ativa (bool): Se fonte est√° ativa
        prioridade (int): Ordem de prioridade (1 = maior)
        ultima_consulta (datetime): Timestamp da √∫ltima consulta
        total_consultas (int): Total de consultas realizadas
        total_erros (int): Total de erros encontrados
        observacoes (str): Observa√ß√µes sobre a fonte
        created_at (datetime): Data de cria√ß√£o
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    """
    
    __tablename__ = 'fonte_dados'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico da fonte"
    )
    
    # Identifica√ß√£o
    nome = db.Column(
        String(100),
        unique=True,
        nullable=False,
        index=True,
        comment="Nome da fonte de dados (ex: yfinance, Alpha Vantage)"
    )
    
    tipo_fonte = db.Column(
        Enum(TipoFonteDados),
        nullable=False,
        index=True,
        comment="Tipo da fonte de dados"
    )
    
    url_base = db.Column(
        String(500),
        nullable=True,
        comment="URL base da API ou site"
    )
    
    # Configura√ß√µes
    requer_autenticacao = db.Column(
        Boolean,
        default=False,
        nullable=False,
        comment="Indica se requer chave API ou autentica√ß√£o"
    )
    
    rate_limit = db.Column(
        String(50),
        nullable=True,
        comment="Limite de requisi√ß√µes (ex: '5/minute', '500/day')"
    )
    
    ativa = db.Column(
        Boolean,
        default=True,
        nullable=False,
        index=True,
        comment="Indica se fonte est√° ativa"
    )
    
    prioridade = db.Column(
        Integer,
        default=100,
        nullable=False,
        index=True,
        comment="Ordem de prioridade (1 = maior prioridade)"
    )
    
    # Estat√≠sticas
    ultima_consulta = db.Column(
        DateTime(timezone=True),
        nullable=True,
        index=True,
        comment="Timestamp da √∫ltima consulta bem-sucedida"
    )
    
    total_consultas = db.Column(
        Integer,
        default=0,
        nullable=False,
        comment="Total de consultas realizadas"
    )
    
    total_erros = db.Column(
        Integer,
        default=0,
        nullable=False,
        comment="Total de erros encontrados"
    )
    
    # Metadados
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes sobre a fonte de dados"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "prioridade > 0",
            name="fonte_prioridade_positiva"
        ),
        db.CheckConstraint(
            "total_consultas >= 0",
            name="fonte_consultas_positivas"
        ),
        db.CheckConstraint(
            "total_erros >= 0",
            name="fonte_erros_positivos"
        ),
        db.CheckConstraint(
            "length(nome) >= 2",
            name="fonte_nome_min_length"
        ),
        {'comment': 'Tabela de fontes de dados externas (APIs, scrapers)'}
    )
    
    def is_active(self):
        """Verifica se fonte est√° ativa"""
        return self.ativa
    
    def is_api(self):
        """Verifica se √© API"""
        return self.tipo_fonte == TipoFonteDados.API
    
    def registrar_consulta_sucesso(self):
        """Registra uma consulta bem-sucedida"""
        # Garantir valores n√£o-None
        if self.total_consultas is None:
            self.total_consultas = 0
        if self.total_erros is None:
            self.total_erros = 0
        
        self.ultima_consulta = datetime.utcnow()
        self.total_consultas += 1

    def registrar_erro(self):
        """Registra um erro na consulta"""
        # Garantir valores n√£o-None
        if self.total_consultas is None:
            self.total_consultas = 0
        if self.total_erros is None:
            self.total_erros = 0
        
        self.total_erros += 1
        self.total_consultas += 1

    def taxa_sucesso(self):
        """
        Calcula a taxa de sucesso das consultas
        
        Returns:
            float: Percentual de sucesso (0-100)
        """
        total = self.total_consultas if self.total_consultas else 0
        erros = self.total_erros if self.total_erros else 0
        
        if total > 0:
            sucessos = total - erros
            return (sucessos / total) * 100
        return 100.0  # Sem consultas = 100% por padr√£o

    def taxa_erro(self):
        """
        Calcula a taxa de erro das consultas
        
        Returns:
            float: Percentual de erro (0-100)
        """
        total = self.total_consultas if self.total_consultas else 0
        erros = self.total_erros if self.total_erros else 0
        
        if total > 0:
            return (erros / total) * 100
        return 0.0

    def health_status(self):
        """
        Determina o status de sa√∫de da fonte
        
        Returns:
            str: 'healthy', 'degraded', 'down', 'unknown'
        """
        total = self.total_consultas if self.total_consultas else 0
        
        if total == 0:
            return 'unknown'
        
        taxa_sucesso = self.taxa_sucesso()
        
        if taxa_sucesso >= 95:
            return 'healthy'
        elif taxa_sucesso >= 80:
            return 'degraded'
        else:
            return 'down'

    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados da fonte
        """
        return {
            'id': str(self.id),
            'nome': self.nome,
            'tipo_fonte': self.tipo_fonte.value if self.tipo_fonte else None,
            'url_base': self.url_base,
            'requer_autenticacao': self.requer_autenticacao,
            'rate_limit': self.rate_limit,
            'ativa': self.ativa,
            'prioridade': self.prioridade,
            'ultima_consulta': self.ultima_consulta.isoformat() if self.ultima_consulta else None,
            'total_consultas': self.total_consultas,
            'total_erros': self.total_erros,
            'taxa_sucesso': round(self.taxa_sucesso(), 2),
            'taxa_erro': round(self.taxa_erro(), 2),
            'health_status': self.health_status(),
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        status = "‚úì" if self.ativa else "‚úó"
        return f"<FonteDados {status} {self.nome} (prioridade {self.prioridade})>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/log_auditoria.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model LogAuditoria
Entidade para logs de auditoria e compliance
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Text, ForeignKey, JSON
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid


class LogAuditoria(db.Model):
    """
    Model para logs de auditoria
    
    Attributes:
        id (UUID): Identificador √∫nico
        usuario_id (UUID): ID do usu√°rio que realizou a a√ß√£o
        acao (str): Tipo de a√ß√£o (LOGIN, CREATE, UPDATE, DELETE, etc.)
        entidade (str): Nome da entidade afetada
        entidade_id (UUID): ID do registro afetado
        dados_antes (dict): Estado anterior do registro (JSON)
        dados_depois (dict): Estado posterior do registro (JSON)
        ip_address (str): Endere√ßo IP de origem
        user_agent (str): Navegador/cliente usado
        timestamp (datetime): Data/hora da a√ß√£o
        sucesso (bool): Se a√ß√£o foi bem-sucedida
        mensagem (str): Mensagem de erro ou detalhes adicionais
    
    Relationships:
        usuario: Usu√°rio que realizou a a√ß√£o
    """
    
    __tablename__ = 'log_auditoria'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico do log"
    )
    
    # Foreign key
    usuario_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('usuario.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        comment="ID do usu√°rio (NULL para a√ß√µes an√¥nimas)"
    )
    
    # Dados da a√ß√£o
    acao = db.Column(
        String(50),
        nullable=False,
        index=True,
        comment="Tipo de a√ß√£o (LOGIN, LOGOUT, CREATE, UPDATE, DELETE, VIEW, EXPORT, etc.)"
    )
    
    entidade = db.Column(
        String(100),
        nullable=True,
        index=True,
        comment="Nome da entidade afetada (Usuario, Transacao, Posicao, etc.)"
    )
    
    entidade_id = db.Column(
        UUID(as_uuid=True),
        nullable=True,
        index=True,
        comment="ID do registro afetado"
    )
    
    # Estados anterior e posterior (para UPDATE)
    dados_antes = db.Column(
        JSON,
        nullable=True,
        comment="Estado anterior do registro (JSON)"
    )
    
    dados_depois = db.Column(
        JSON,
        nullable=True,
        comment="Estado posterior do registro (JSON)"
    )
    
    # Dados de contexto
    ip_address = db.Column(
        String(45),  # IPv6 pode ter at√© 45 caracteres
        nullable=True,
        index=True,
        comment="Endere√ßo IP de origem"
    )
    
    user_agent = db.Column(
        String(500),
        nullable=True,
        comment="User-Agent (navegador/cliente)"
    )
    
    timestamp = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        index=True,
        comment="Data/hora da a√ß√£o"
    )
    
    # Resultado
    sucesso = db.Column(
        Boolean,
        default=True,
        nullable=False,
        index=True,
        comment="Indica se a√ß√£o foi bem-sucedida"
    )
    
    mensagem = db.Column(
        Text,
        nullable=True,
        comment="Mensagem de erro ou detalhes adicionais"
    )
    
    # Relacionamentos
    usuario = relationship('Usuario', backref='logs_auditoria', lazy='joined')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "length(acao) >= 3",
            name="log_acao_min_length"
        ),
        {'comment': 'Tabela de logs de auditoria para compliance'}
    )
    
    def is_sucesso(self):
        """Verifica se a√ß√£o foi bem-sucedida"""
        return self.sucesso
    
    def is_falha(self):
        """Verifica se a√ß√£o falhou"""
        return not self.sucesso
    
    def is_login(self):
        """Verifica se √© log de login"""
        return self.acao == 'LOGIN'
    
    def is_logout(self):
        """Verifica se √© log de logout"""
        return self.acao == 'LOGOUT'
    
    def is_create(self):
        """Verifica se √© cria√ß√£o de registro"""
        return self.acao == 'CREATE'
    
    def is_update(self):
        """Verifica se √© atualiza√ß√£o de registro"""
        return self.acao == 'UPDATE'
    
    def is_delete(self):
        """Verifica se √© exclus√£o de registro"""
        return self.acao == 'DELETE'
    
    def is_export(self):
        """Verifica se √© exporta√ß√£o de dados"""
        return self.acao == 'EXPORT'
    
    def get_alteracoes(self):
        """
        Extrai as altera√ß√µes realizadas (campos modificados)
        
        Returns:
            dict: Dicion√°rio com campos alterados e seus valores antes/depois
        """
        if not self.is_update() or not self.dados_antes or not self.dados_depois:
            return {}
        
        alteracoes = {}
        for campo, valor_depois in self.dados_depois.items():
            valor_antes = self.dados_antes.get(campo)
            if valor_antes != valor_depois:
                alteracoes[campo] = {
                    'antes': valor_antes,
                    'depois': valor_depois
                }
        
        return alteracoes
    
    def to_dict(self, include_dados=False):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Args:
            include_dados (bool): Se deve incluir dados_antes e dados_depois
        
        Returns:
            dict: Dicion√°rio com dados do log
        """
        data = {
            'id': str(self.id),
            'usuario_id': str(self.usuario_id) if self.usuario_id else None,
            'acao': self.acao,
            'entidade': self.entidade,
            'entidade_id': str(self.entidade_id) if self.entidade_id else None,
            'ip_address': self.ip_address,
            'user_agent': self.user_agent,
            'timestamp': self.timestamp.isoformat() if self.timestamp else None,
            'sucesso': self.sucesso,
            'mensagem': self.mensagem
        }
        
        if include_dados:
            data['dados_antes'] = self.dados_antes
            data['dados_depois'] = self.dados_depois
            data['alteracoes'] = self.get_alteracoes()
        
        return data
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        status = "‚úì" if self.sucesso else "‚úó"
        usuario = self.usuario.username if self.usuario else "ANON"
        return f"<LogAuditoria {status} {usuario} {self.acao} {self.entidade or ''}>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/movimentacao_caixa.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model MovimentacaoCaixa
Entidade para movimenta√ß√µes de caixa em corretoras
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, DateTime, Enum, Numeric, Text, Date, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid
import enum


class TipoMovimentacao(enum.Enum):
    """Enum para tipos de movimenta√ß√£o"""
    DEPOSITO = "deposito"                    # Dep√≥sito na corretora
    SAQUE = "saque"                          # Saque da corretora
    TRANSFERENCIA_ENVIADA = "transf_env"    # Transfer√™ncia para outra corretora
    TRANSFERENCIA_RECEBIDA = "transf_rec"   # Transfer√™ncia de outra corretora
    CREDITO_PROVENTO = "credito_prov"       # Cr√©dito de provento
    PAGAMENTO_TAXA = "pagto_taxa"           # Pagamento de taxa/cust√≥dia
    PAGAMENTO_IMPOSTO = "pagto_imposto"     # Pagamento de imposto
    AJUSTE = "ajuste"                        # Ajuste manual
    OUTRO = "outro"                          # Outros tipos


class MovimentacaoCaixa(db.Model):
    """
    Model para movimenta√ß√µes de caixa em corretoras
    
    Attributes:
        id (UUID): Identificador √∫nico
        usuario_id (UUID): ID do usu√°rio
        corretora_id (UUID): ID da corretora (origem)
        tipo_movimentacao (TipoMovimentacao): Tipo da movimenta√ß√£o
        valor (Decimal): Valor da movimenta√ß√£o
        moeda (str): Moeda (BRL, USD, EUR)
        data_movimentacao (date): Data da movimenta√ß√£o
        corretora_destino_id (UUID): ID da corretora destino (transfer√™ncias)
        provento_id (UUID): ID do provento (se for cr√©dito de provento)
        descricao (str): Descri√ß√£o da movimenta√ß√£o
        comprovante (str): Refer√™ncia ao comprovante
        created_at (datetime): Data de cria√ß√£o do registro
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        usuario: Usu√°rio propriet√°rio
        corretora: Corretora origem
        corretora_destino: Corretora destino (para transfer√™ncias)
        provento: Provento relacionado (para cr√©ditos)
    """
    
    __tablename__ = 'movimentacao_caixa'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico da movimenta√ß√£o"
    )
    
    # Foreign keys obrigat√≥rias
    usuario_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('usuario.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID do usu√°rio"
    )
    
    corretora_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('corretora.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID da corretora (origem)"
    )
    
    # Foreign keys opcionais
    corretora_destino_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('corretora.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        comment="ID da corretora destino (apenas para transfer√™ncias)"
    )
    
    provento_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('provento.id', ondelete='SET NULL'),
        nullable=True,
        index=True,
        comment="ID do provento (apenas para cr√©dito de provento)"
    )
    
    # Dados da movimenta√ß√£o
    tipo_movimentacao = db.Column(
        Enum(TipoMovimentacao),
        nullable=False,
        index=True,
        comment="Tipo da movimenta√ß√£o"
    )
    
    valor = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        comment="Valor da movimenta√ß√£o"
    )
    
    moeda = db.Column(
        String(3),
        nullable=False,
        default='BRL',
        index=True,
        comment="C√≥digo ISO 4217 da moeda (BRL, USD, EUR)"
    )
    
    data_movimentacao = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data da movimenta√ß√£o"
    )
    
    # Metadados
    descricao = db.Column(
        Text,
        nullable=True,
        comment="Descri√ß√£o da movimenta√ß√£o"
    )
    
    comprovante = db.Column(
        String(200),
        nullable=True,
        comment="Refer√™ncia ao comprovante (n√∫mero, hash, arquivo)"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos
    usuario = relationship('Usuario', backref='movimentacoes_caixa', lazy='joined')
    corretora = relationship(
        'Corretora',
        foreign_keys=[corretora_id],
        backref='movimentacoes_caixa',
        lazy='joined'
    )
    corretora_destino = relationship(
        'Corretora',
        foreign_keys=[corretora_destino_id],
        lazy='joined'
    )
    provento = relationship('Provento', lazy='joined')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "valor > 0",
            name="movimentacao_valor_positivo"
        ),
        db.CheckConstraint(
            "moeda ~* '^[A-Z]{3}$'",
            name="movimentacao_moeda_iso_format"
        ),
        db.CheckConstraint(
            """
            (tipo_movimentacao IN ('transferencia_enviada', 'transferencia_recebida') 
             AND corretora_destino_id IS NOT NULL)
            OR 
            (tipo_movimentacao NOT IN ('transferencia_enviada', 'transferencia_recebida'))
            """,
            name="movimentacao_transferencia_tem_destino"
        ),
        db.CheckConstraint(
            """
            (tipo_movimentacao = 'credito_provento' AND provento_id IS NOT NULL)
            OR 
            (tipo_movimentacao != 'credito_provento')
            """,
            name="movimentacao_credito_tem_provento"
        ),
        {'comment': 'Tabela de movimenta√ß√µes de caixa em corretoras'}
    )
    
    def is_entrada(self):
        """Verifica se √© movimenta√ß√£o de entrada (aumenta saldo)"""
        return self.tipo_movimentacao in [
            TipoMovimentacao.DEPOSITO,
            TipoMovimentacao.TRANSFERENCIA_RECEBIDA,
            TipoMovimentacao.CREDITO_PROVENTO,
            TipoMovimentacao.AJUSTE  # Depende do contexto, mas inclu√≠mos aqui
        ]
    
    def is_saida(self):
        """Verifica se √© movimenta√ß√£o de sa√≠da (diminui saldo)"""
        return self.tipo_movimentacao in [
            TipoMovimentacao.SAQUE,
            TipoMovimentacao.TRANSFERENCIA_ENVIADA,
            TipoMovimentacao.PAGAMENTO_TAXA,
            TipoMovimentacao.PAGAMENTO_IMPOSTO
        ]
    
    def is_transferencia(self):
        """Verifica se √© transfer√™ncia entre corretoras"""
        return self.tipo_movimentacao in [
            TipoMovimentacao.TRANSFERENCIA_ENVIADA,
            TipoMovimentacao.TRANSFERENCIA_RECEBIDA
        ]
    
    def is_credito_provento(self):
        """Verifica se √© cr√©dito de provento"""
        return self.tipo_movimentacao == TipoMovimentacao.CREDITO_PROVENTO
    
    def impacto_saldo(self):
        """
        Calcula o impacto no saldo da corretora
        
        Returns:
            Decimal: Valor positivo para entradas, negativo para sa√≠das
        """
        if self.is_entrada():
            return self.valor
        elif self.is_saida():
            return -self.valor
        return 0
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados da movimenta√ß√£o
        """
        return {
            'id': str(self.id),
            'usuario_id': str(self.usuario_id),
            'corretora_id': str(self.corretora_id),
            'corretora_destino_id': str(self.corretora_destino_id) if self.corretora_destino_id else None,
            'provento_id': str(self.provento_id) if self.provento_id else None,
            'tipo_movimentacao': self.tipo_movimentacao.value if self.tipo_movimentacao else None,
            'valor': float(self.valor) if self.valor else 0,
            'moeda': self.moeda,
            'impacto_saldo': float(self.impacto_saldo()),
            'data_movimentacao': self.data_movimentacao.isoformat() if self.data_movimentacao else None,
            'descricao': self.descricao,
            'comprovante': self.comprovante,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        tipo = self.tipo_movimentacao.value if self.tipo_movimentacao else "N/A"
        sinal = "+" if self.is_entrada() else "-"
        return f"<MovimentacaoCaixa {tipo.upper()} {sinal} {self.moeda} {self.valor}>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/posicao.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model Posicao
Entidade para holdings/posi√ß√µes em carteira de ativos
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, DateTime, Numeric, Date, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid


class Posicao(db.Model):
    """
    Model para posi√ß√µes em carteira (holdings)
    
    Attributes:
        id (UUID): Identificador √∫nico
        usuario_id (UUID): ID do usu√°rio propriet√°rio
        corretora_id (UUID): ID da corretora onde est√° a posi√ß√£o
        ativo_id (UUID): ID do ativo
        quantidade (Decimal): Quantidade de ativos em posse
        preco_medio (Decimal): Pre√ßo m√©dio de aquisi√ß√£o
        custo_total (Decimal): Custo total investido
        taxas_acumuladas (Decimal): Taxas de corretagem acumuladas
        impostos_acumulados (Decimal): Impostos pagos acumulados
        valor_atual (Decimal): Valor de mercado atual da posi√ß√£o
        lucro_prejuizo_realizado (Decimal): L/P realizado (vendas)
        lucro_prejuizo_nao_realizado (Decimal): L/P n√£o realizado
        data_primeira_compra (date): Data da primeira aquisi√ß√£o
        data_ultima_atualizacao (datetime): √öltima atualiza√ß√£o
        created_at (datetime): Data de cria√ß√£o
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        usuario: Usu√°rio propriet√°rio
        corretora: Corretora onde est√° a posi√ß√£o
        ativo: Ativo da posi√ß√£o
    """
    
    __tablename__ = 'posicao'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico da posi√ß√£o"
    )
    
    # Foreign keys
    usuario_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('usuario.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID do usu√°rio propriet√°rio"
    )
    
    corretora_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('corretora.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID da corretora onde est√° a posi√ß√£o"
    )
    
    ativo_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('ativo.id', ondelete='RESTRICT'),
        nullable=False,
        index=True,
        comment="ID do ativo"
    )
    
    # Dados da posi√ß√£o
    quantidade = db.Column(
        Numeric(precision=18, scale=8),
        nullable=False,
        default=0,
        comment="Quantidade de ativos (suporta fracion√°rios)"
    )
    
    preco_medio = db.Column(
        Numeric(precision=18, scale=6),
        nullable=False,
        default=0,
        comment="Pre√ßo m√©dio de aquisi√ß√£o"
    )
    
    custo_total = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="Custo total investido (quantidade * pre√ßo m√©dio)"
    )
    
    taxas_acumuladas = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="Taxas de corretagem e cust√≥dia acumuladas"
    )
    
    impostos_acumulados = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="Impostos pagos acumulados (IR, IOF, etc.)"
    )
    
    # Valores calculados
    valor_atual = db.Column(
        Numeric(precision=18, scale=2),
        nullable=True,
        comment="Valor de mercado atual da posi√ß√£o"
    )
    
    lucro_prejuizo_realizado = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="Lucro/preju√≠zo realizado em vendas"
    )
    
    lucro_prejuizo_nao_realizado = db.Column(
        Numeric(precision=18, scale=2),
        nullable=True,
        comment="Lucro/preju√≠zo n√£o realizado (marca√ß√£o a mercado)"
    )
    
    # Datas
    data_primeira_compra = db.Column(
        Date,
        nullable=True,
        index=True,
        comment="Data da primeira aquisi√ß√£o deste ativo"
    )
    
    data_ultima_atualizacao = db.Column(
        DateTime(timezone=True),
        nullable=True,
        index=True,
        comment="Data da √∫ltima atualiza√ß√£o de valores"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos
    usuario = relationship('Usuario', backref='posicoes', lazy='joined')
    corretora = relationship('Corretora', backref='posicoes', lazy='joined')
    ativo = relationship('Ativo', backref='posicoes', lazy='joined')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "quantidade >= 0",
            name="posicao_quantidade_positiva"
        ),
        db.CheckConstraint(
            "preco_medio >= 0",
            name="posicao_preco_medio_positivo"
        ),
        db.CheckConstraint(
            "custo_total >= 0",
            name="posicao_custo_total_positivo"
        ),
        db.CheckConstraint(
            "taxas_acumuladas >= 0",
            name="posicao_taxas_positivas"
        ),
        db.CheckConstraint(
            "impostos_acumulados >= 0",
            name="posicao_impostos_positivos"
        ),
        db.UniqueConstraint(
            'usuario_id', 'corretora_id', 'ativo_id',
            name='unique_posicao_usuario_corretora_ativo'
        ),
        {'comment': 'Tabela de posi√ß√µes em carteira (holdings)'}
    )
    
    def calcular_valor_atual(self, preco_mercado):
        """
        Calcula o valor atual da posi√ß√£o baseado no pre√ßo de mercado
        
        Args:
            preco_mercado (Decimal): Pre√ßo atual do ativo no mercado
        
        Returns:
            Decimal: Valor atual da posi√ß√£o
        """
        self.valor_atual = self.quantidade * preco_mercado
        self.data_ultima_atualizacao = datetime.utcnow()
        return self.valor_atual
    
    def calcular_lucro_prejuizo_nao_realizado(self):
        """
        Calcula o lucro/preju√≠zo n√£o realizado (marca√ß√£o a mercado)
        
        Returns:
            Decimal: L/P n√£o realizado
        """
        if self.valor_atual is not None:
            self.lucro_prejuizo_nao_realizado = self.valor_atual - self.custo_total
        return self.lucro_prejuizo_nao_realizado
    
    def adicionar_compra(self, quantidade, preco_unitario, taxas=0, impostos=0):
        """
        Adiciona uma compra √† posi√ß√£o (recalcula pre√ßo m√©dio)
        
        Args:
            quantidade (Decimal): Quantidade comprada
            preco_unitario (Decimal): Pre√ßo unit√°rio da compra
            taxas (Decimal): Taxas da opera√ß√£o
            impostos (Decimal): Impostos da opera√ß√£o
        """
        # Garantir valores n√£o-None (defaults do SQLAlchemy s√≥ aplicam ao persistir)
        if self.quantidade is None:
            self.quantidade = 0
        if self.preco_medio is None:
            self.preco_medio = 0
        if self.custo_total is None:
            self.custo_total = 0
        if self.taxas_acumuladas is None:
            self.taxas_acumuladas = 0
        if self.impostos_acumulados is None:
            self.impostos_acumulados = 0
        if self.lucro_prejuizo_realizado is None:
            self.lucro_prejuizo_realizado = 0
        
        custo_compra = quantidade * preco_unitario
        
        # Recalcular pre√ßo m√©dio ponderado
        novo_custo_total = self.custo_total + custo_compra
        nova_quantidade = self.quantidade + quantidade
        
        if nova_quantidade > 0:
            self.preco_medio = novo_custo_total / nova_quantidade
        
        self.quantidade = nova_quantidade
        self.custo_total = novo_custo_total
        self.taxas_acumuladas += taxas
        self.impostos_acumulados += impostos
        
        # Definir data primeira compra se for a primeira
        if self.data_primeira_compra is None:
            self.data_primeira_compra = datetime.utcnow().date()

    
    def adicionar_venda(self, quantidade, preco_unitario, taxas=0, impostos=0):
        """
        Adiciona uma venda √† posi√ß√£o
        
        Args:
            quantidade (Decimal): Quantidade vendida
            preco_unitario (Decimal): Pre√ßo unit√°rio da venda
            taxas (Decimal): Taxas da opera√ß√£o
            impostos (Decimal): Impostos da opera√ß√£o
        
        Raises:
            ValueError: Se quantidade vendida for maior que quantidade em posse
        """
        # Garantir valores n√£o-None
        if self.quantidade is None:
            self.quantidade = 0
        if self.preco_medio is None:
            self.preco_medio = 0
        if self.custo_total is None:
            self.custo_total = 0
        if self.taxas_acumuladas is None:
            self.taxas_acumuladas = 0
        if self.impostos_acumulados is None:
            self.impostos_acumulados = 0
        if self.lucro_prejuizo_realizado is None:
            self.lucro_prejuizo_realizado = 0
        
        if quantidade > self.quantidade:
            raise ValueError(
                f"Quantidade vendida ({quantidade}) maior que quantidade em posse ({self.quantidade})"
            )
        
        # Calcular lucro/preju√≠zo realizado
        receita_venda = quantidade * preco_unitario
        custo_proporcional = quantidade * self.preco_medio
        lp_realizado = receita_venda - custo_proporcional - taxas - impostos
        
        self.lucro_prejuizo_realizado += lp_realizado
        self.quantidade -= quantidade
        self.custo_total -= custo_proporcional
        self.taxas_acumuladas += taxas
        self.impostos_acumulados += impostos
        
        # Se zerou a posi√ß√£o, resetar pre√ßo m√©dio
        if self.quantidade == 0:
            self.preco_medio = 0
            self.custo_total = 0

    
    def percentual_lucro_prejuizo(self):
        """
        Calcula o percentual de lucro/preju√≠zo n√£o realizado
        
        Returns:
            Decimal: Percentual de L/P (ex: 15.5 = 15.5%)
        """
        if self.custo_total > 0 and self.lucro_prejuizo_nao_realizado is not None:
            return (self.lucro_prejuizo_nao_realizado / self.custo_total) * 100
        return 0
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados da posi√ß√£o
        """
        return {
            'id': str(self.id),
            'usuario_id': str(self.usuario_id),
            'corretora_id': str(self.corretora_id),
            'ativo_id': str(self.ativo_id),
            'quantidade': float(self.quantidade) if self.quantidade else 0,
            'preco_medio': float(self.preco_medio) if self.preco_medio else 0,
            'custo_total': float(self.custo_total) if self.custo_total else 0,
            'taxas_acumuladas': float(self.taxas_acumuladas) if self.taxas_acumuladas else 0,
            'impostos_acumulados': float(self.impostos_acumulados) if self.impostos_acumulados else 0,
            'valor_atual': float(self.valor_atual) if self.valor_atual else None,
            'lucro_prejuizo_realizado': float(self.lucro_prejuizo_realizado) if self.lucro_prejuizo_realizado else 0,
            'lucro_prejuizo_nao_realizado': float(self.lucro_prejuizo_nao_realizado) if self.lucro_prejuizo_nao_realizado else None,
            'percentual_lp': float(self.percentual_lucro_prejuizo()),
            'data_primeira_compra': self.data_primeira_compra.isoformat() if self.data_primeira_compra else None,
            'data_ultima_atualizacao': self.data_ultima_atualizacao.isoformat() if self.data_ultima_atualizacao else None,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        return f"<Posicao {self.quantidade}x {self.ativo.ticker if self.ativo else 'N/A'}>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/provento.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model Provento
Entidade para registro de proventos (dividendos, JCP, rendimentos)
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, DateTime, Enum, Numeric, Text, Date, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid
import enum


class TipoProvento(enum.Enum):
    """Enum para tipos de provento"""
    DIVIDENDO = "dividendo"              # Dividendo ordin√°rio
    JCP = "jcp"                          # Juros sobre Capital Pr√≥prio
    RENDIMENTO = "rendimento"            # Rendimento de FII
    CUPOM = "cupom"                      # Cupom de t√≠tulo de renda fixa
    BONIFICACAO = "bonificacao"          # Bonifica√ß√£o em dinheiro
    DIREITO_SUBSCRICAO = "direito_sub"   # Direito de subscri√ß√£o vendido
    OUTRO = "outro"                      # Outros tipos


class Provento(db.Model):
    """
    Model para proventos recebidos de ativos
    
    Attributes:
        id (UUID): Identificador √∫nico
        ativo_id (UUID): ID do ativo que pagou o provento
        tipo_provento (TipoProvento): Tipo do provento
        valor_por_acao (Decimal): Valor unit√°rio por ativo
        data_com (date): Data COM (√∫ltimo dia para ter direito)
        data_pagamento (date): Data efetiva do pagamento
        quantidade_ativos (Decimal): Quantidade de ativos que geraram provento
        valor_bruto (Decimal): Valor bruto recebido
        imposto_retido (Decimal): IR retido na fonte
        valor_liquido (Decimal): Valor l√≠quido creditado
        observacoes (str): Observa√ß√µes sobre o provento
        created_at (datetime): Data de cria√ß√£o do registro
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        ativo: Ativo que pagou o provento
    """
    
    __tablename__ = 'provento'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico do provento"
    )
    
    # Foreign key
    ativo_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('ativo.id', ondelete='RESTRICT'),
        nullable=False,
        index=True,
        comment="ID do ativo que pagou o provento"
    )
    
    # Tipo de provento
    tipo_provento = db.Column(
        Enum(TipoProvento),
        nullable=False,
        index=True,
        comment="Tipo do provento (dividendo, JCP, rendimento, etc.)"
    )
    
    # Valores
    valor_por_acao = db.Column(
        Numeric(precision=18, scale=6),
        nullable=False,
        comment="Valor unit√°rio por ativo"
    )
    
    quantidade_ativos = db.Column(
        Numeric(precision=18, scale=8),
        nullable=False,
        comment="Quantidade de ativos que geraram o provento"
    )
    
    valor_bruto = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        comment="Valor bruto recebido"
    )
    
    imposto_retido = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="IR retido na fonte"
    )
    
    valor_liquido = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        comment="Valor l√≠quido creditado"
    )
    
    # Datas
    data_com = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data COM (√∫ltimo dia para ter direito ao provento)"
    )
    
    data_pagamento = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data efetiva do pagamento"
    )
    
    # Metadados
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes sobre o provento"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos
    ativo = relationship('Ativo', backref='proventos', lazy='joined')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "valor_por_acao > 0",
            name="provento_valor_por_acao_positivo"
        ),
        db.CheckConstraint(
            "quantidade_ativos > 0",
            name="provento_quantidade_positiva"
        ),
        db.CheckConstraint(
            "valor_bruto > 0",
            name="provento_valor_bruto_positivo"
        ),
        db.CheckConstraint(
            "imposto_retido >= 0",
            name="provento_imposto_positivo"
        ),
        db.CheckConstraint(
            "valor_liquido > 0",
            name="provento_valor_liquido_positivo"
        ),
        db.CheckConstraint(
            "valor_liquido <= valor_bruto",
            name="provento_liquido_menor_bruto"
        ),
        db.CheckConstraint(
            "data_pagamento >= data_com",
            name="provento_data_pagamento_valida"
        ),
        {'comment': 'Tabela de proventos recebidos (dividendos, JCP, rendimentos)'}
    )
    
    def __init__(self, **kwargs):
        """
        Inicializa provento com c√°lculos autom√°ticos
        """
        super(Provento, self).__init__(**kwargs)
        
        # Calcular valor bruto se n√£o fornecido
        if self.valor_bruto is None and self.valor_por_acao and self.quantidade_ativos:
            self.valor_bruto = self.valor_por_acao * self.quantidade_ativos
        
        # Calcular valor l√≠quido se n√£o fornecido
        if self.valor_liquido is None and self.valor_bruto is not None:
            imposto = self.imposto_retido if self.imposto_retido else 0
            self.valor_liquido = self.valor_bruto - imposto
    
    def is_dividendo(self):
        """Verifica se √© dividendo"""
        return self.tipo_provento == TipoProvento.DIVIDENDO
    
    def is_jcp(self):
        """Verifica se √© JCP"""
        return self.tipo_provento == TipoProvento.JCP
    
    def is_rendimento_fii(self):
        """Verifica se √© rendimento de FII"""
        return self.tipo_provento == TipoProvento.RENDIMENTO
    
    def percentual_imposto(self):
        """
        Calcula o percentual de imposto retido
        
        Returns:
            Decimal: Percentual de imposto (ex: 15.0 = 15%)
        """
        if self.valor_bruto and self.valor_bruto > 0:
            imposto = self.imposto_retido if self.imposto_retido else 0
            return (imposto / self.valor_bruto) * 100
        return 0
    
    def dividend_yield_efetivo(self, preco_ativo):
        """
        Calcula o dividend yield efetivo baseado no pre√ßo do ativo
        
        Args:
            preco_ativo (Decimal): Pre√ßo atual do ativo
            
        Returns:
            Decimal: DY efetivo em % (ex: 6.5 = 6.5%)
        """
        if preco_ativo and preco_ativo > 0:
            return (self.valor_por_acao / preco_ativo) * 100
        return 0
    
    def dias_ate_pagamento(self):
        """
        Calcula quantos dias faltam para o pagamento
        
        Returns:
            int: Dias at√© pagamento (negativo se j√° pago)
        """
        hoje = datetime.utcnow().date()
        delta = self.data_pagamento - hoje
        return delta.days
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados do provento
        """
        return {
            'id': str(self.id),
            'ativo_id': str(self.ativo_id),
            'tipo_provento': self.tipo_provento.value if self.tipo_provento else None,
            'valor_por_acao': float(self.valor_por_acao) if self.valor_por_acao else 0,
            'quantidade_ativos': float(self.quantidade_ativos) if self.quantidade_ativos else 0,
            'valor_bruto': float(self.valor_bruto) if self.valor_bruto else 0,
            'imposto_retido': float(self.imposto_retido) if self.imposto_retido else 0,
            'valor_liquido': float(self.valor_liquido) if self.valor_liquido else 0,
            'percentual_imposto': float(self.percentual_imposto()),
            'data_com': self.data_com.isoformat() if self.data_com else None,
            'data_pagamento': self.data_pagamento.isoformat() if self.data_pagamento else None,
            'dias_ate_pagamento': self.dias_ate_pagamento(),
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        ticker = self.ativo.ticker if self.ativo else "N/A"
        tipo = self.tipo_provento.value if self.tipo_provento else "N/A"
        return f"<Provento {tipo.upper()} {ticker} R$ {self.valor_por_acao}/a√ß√£o>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/regra_fiscal.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model RegraFiscal
Entidade para regras tribut√°rias por pa√≠s e tipo de ativo
"""

from datetime import datetime, date
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Enum, Numeric, Text, Date
from sqlalchemy.dialects.postgresql import UUID
import uuid
import enum


class IncidenciaImposto(enum.Enum):
    """Enum para tipo de incid√™ncia do imposto"""
    LUCRO = "lucro"              # Incide sobre lucro/ganho de capital
    RECEITA = "receita"          # Incide sobre receita bruta
    PROVENTO = "provento"        # Incide sobre proventos recebidos
    OPERACAO = "operacao"        # Incide sobre cada opera√ß√£o


class RegraFiscal(db.Model):
    """
    Model para regras tribut√°rias
    
    Attributes:
        id (UUID): Identificador √∫nico
        pais (str): Pa√≠s da regra (c√≥digo ISO)
        tipo_ativo (str): Tipo de ativo (ACAO, FII, REIT, etc.)
        tipo_operacao (str): Tipo de opera√ß√£o (COMPRA, VENDA, DAY_TRADE)
        aliquota_ir (Decimal): Al√≠quota de IR em %
        valor_isencao (Decimal): Valor de isen√ß√£o mensal
        incide_sobre (IncidenciaImposto): Sobre o que incide o imposto
        descricao (str): Descri√ß√£o da regra
        vigencia_inicio (date): Data de in√≠cio da vig√™ncia
        vigencia_fim (date): Data de fim da vig√™ncia
        ativa (bool): Indica se regra est√° ativa
        created_at (datetime): Data de cria√ß√£o
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    """
    
    __tablename__ = 'regra_fiscal'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico da regra"
    )
    
    # Identifica√ß√£o da regra
    pais = db.Column(
        String(2),
        nullable=False,
        index=True,
        comment="C√≥digo ISO do pa√≠s (BR, US, etc.)"
    )
    
    tipo_ativo = db.Column(
        String(20),
        nullable=True,
        index=True,
        comment="Tipo de ativo (ACAO, FII, REIT, BOND, etc.) - NULL = todos"
    )
    
    tipo_operacao = db.Column(
        String(20),
        nullable=True,
        index=True,
        comment="Tipo de opera√ß√£o (COMPRA, VENDA, DAY_TRADE, SWING_TRADE) - NULL = todas"
    )
    
    # Valores fiscais
    aliquota_ir = db.Column(
        Numeric(precision=6, scale=4),
        nullable=False,
        comment="Al√≠quota de IR em % (ex: 15.0000 = 15%)"
    )
    
    valor_isencao = db.Column(
        Numeric(precision=18, scale=2),
        nullable=True,
        comment="Valor de isen√ß√£o mensal (ex: R$ 20.000,00 no Brasil)"
    )
    
    incide_sobre = db.Column(
        Enum(IncidenciaImposto),
        nullable=False,
        index=True,
        comment="Sobre o que incide o imposto"
    )
    
    # Descri√ß√£o
    descricao = db.Column(
        Text,
        nullable=False,
        comment="Descri√ß√£o detalhada da regra fiscal"
    )
    
    # Vig√™ncia
    vigencia_inicio = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data de in√≠cio da vig√™ncia da regra"
    )
    
    vigencia_fim = db.Column(
        Date,
        nullable=True,
        index=True,
        comment="Data de fim da vig√™ncia (NULL = vigente indefinidamente)"
    )
    
    # Status
    ativa = db.Column(
        Boolean,
        default=True,
        nullable=False,
        index=True,
        comment="Indica se regra est√° ativa"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "aliquota_ir >= 0 AND aliquota_ir <= 100",
            name="regra_aliquota_valida"
        ),
        db.CheckConstraint(
            "valor_isencao IS NULL OR valor_isencao >= 0",
            name="regra_isencao_positiva"
        ),
        db.CheckConstraint(
            "pais ~* '^[A-Z]{2}$'",
            name="regra_pais_iso_format"
        ),
        db.CheckConstraint(
            "vigencia_fim IS NULL OR vigencia_fim >= vigencia_inicio",
            name="regra_vigencia_valida"
        ),
        {'comment': 'Tabela de regras tribut√°rias por pa√≠s e tipo de ativo'}
    )
    
    def is_active(self):
        """Verifica se regra est√° ativa"""
        return self.ativa
    
    def is_vigente(self, data_referencia=None):
        """
        Verifica se regra est√° vigente em uma data
        
        Args:
            data_referencia (date): Data de refer√™ncia (default: hoje)
            
        Returns:
            bool: True se vigente
        """
        if not self.ativa:
            return False
        
        if data_referencia is None:
            data_referencia = datetime.utcnow().date()
        
        # Verifica in√≠cio
        if data_referencia < self.vigencia_inicio:
            return False
        
        # Verifica fim (se definido)
        if self.vigencia_fim and data_referencia > self.vigencia_fim:
            return False
        
        return True
    
    def tem_isencao(self):
        """Verifica se regra possui valor de isen√ß√£o"""
        return self.valor_isencao is not None and self.valor_isencao > 0
    
    def calcular_imposto(self, base_calculo):
        """
        Calcula o imposto devido sobre uma base de c√°lculo
        
        Args:
            base_calculo (Decimal): Valor base para c√°lculo
            
        Returns:
            Decimal: Valor do imposto devido
        """
        # Se tem isen√ß√£o e base est√° abaixo, n√£o h√° imposto
        if self.tem_isencao() and base_calculo <= self.valor_isencao:
            return 0
        
        # Calcula imposto sobre o valor (ou valor acima da isen√ß√£o)
        valor_tributavel = base_calculo
        if self.tem_isencao():
            valor_tributavel = base_calculo - self.valor_isencao
        
        imposto = valor_tributavel * (self.aliquota_ir / 100)
        return max(imposto, 0)  # Nunca retornar negativo
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados da regra
        """
        return {
            'id': str(self.id),
            'pais': self.pais,
            'tipo_ativo': self.tipo_ativo,
            'tipo_operacao': self.tipo_operacao,
            'aliquota_ir': float(self.aliquota_ir) if self.aliquota_ir else 0,
            'valor_isencao': float(self.valor_isencao) if self.valor_isencao else None,
            'incide_sobre': self.incide_sobre.value if self.incide_sobre else None,
            'descricao': self.descricao,
            'vigencia_inicio': self.vigencia_inicio.isoformat() if self.vigencia_inicio else None,
            'vigencia_fim': self.vigencia_fim.isoformat() if self.vigencia_fim else None,
            'ativa': self.ativa,
            'vigente': self.is_vigente(),
            'tem_isencao': self.tem_isencao(),
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        return f"<RegraFiscal {self.pais} {self.tipo_ativo or 'ALL'} IR={self.aliquota_ir}%>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/transacao.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model Transacao
Entidade para registro de opera√ß√µes de compra e venda de ativos
"""

from datetime import datetime, timedelta
from app.database import db
from sqlalchemy import String, DateTime, Enum, Numeric, Text, Date, ForeignKey
from sqlalchemy.dialects.postgresql import UUID
from sqlalchemy.orm import relationship
import uuid
import enum


class TipoOperacao(enum.Enum):
    """Enum para tipos de opera√ß√£o"""
    COMPRA = "compra"
    VENDA = "venda"


class Transacao(db.Model):
    """
    Model para transa√ß√µes de compra e venda de ativos
    
    Attributes:
        id (UUID): Identificador √∫nico
        usuario_id (UUID): ID do usu√°rio
        corretora_id (UUID): ID da corretora
        ativo_id (UUID): ID do ativo
        tipo_operacao (TipoOperacao): COMPRA ou VENDA
        quantidade (Decimal): Quantidade transacionada
        preco_unitario (Decimal): Pre√ßo por unidade
        valor_total (Decimal): Valor total da opera√ß√£o
        taxas (Decimal): Taxas de corretagem e cust√≥dia
        impostos (Decimal): IR e outros impostos
        data_operacao (date): Data da opera√ß√£o
        data_liquidacao (date): Data de liquida√ß√£o
        observacoes (str): Observa√ß√µes sobre a transa√ß√£o
        created_at (datetime): Data de cria√ß√£o do registro
        updated_at (datetime): Data da √∫ltima atualiza√ß√£o
    
    Relationships:
        usuario: Usu√°rio que realizou a opera√ß√£o
        corretora: Corretora onde foi realizada
        ativo: Ativo transacionado
    """
    
    __tablename__ = 'transacao'
    
    # Chave prim√°ria
    id = db.Column(
        UUID(as_uuid=True),
        primary_key=True,
        default=uuid.uuid4,
        comment="Identificador √∫nico da transa√ß√£o"
    )
    
    # Foreign keys
    usuario_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('usuario.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID do usu√°rio"
    )
    
    corretora_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('corretora.id', ondelete='CASCADE'),
        nullable=False,
        index=True,
        comment="ID da corretora"
    )
    
    ativo_id = db.Column(
        UUID(as_uuid=True),
        ForeignKey('ativo.id', ondelete='RESTRICT'),
        nullable=False,
        index=True,
        comment="ID do ativo transacionado"
    )
    
    # Dados da transa√ß√£o
    tipo_operacao = db.Column(
        Enum(TipoOperacao),
        nullable=False,
        index=True,
        comment="Tipo de opera√ß√£o: COMPRA ou VENDA"
    )
    
    quantidade = db.Column(
        Numeric(precision=18, scale=8),
        nullable=False,
        comment="Quantidade transacionada (suporta fracion√°rios)"
    )
    
    preco_unitario = db.Column(
        Numeric(precision=18, scale=6),
        nullable=False,
        comment="Pre√ßo por unidade"
    )
    
    valor_total = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        comment="Valor total da opera√ß√£o (quantidade * pre√ßo)"
    )
    
    taxas = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="Taxas de corretagem, cust√≥dia, emolumentos"
    )
    
    impostos = db.Column(
        Numeric(precision=18, scale=2),
        nullable=False,
        default=0,
        comment="IR retido na fonte, IOF, etc."
    )
    
    # Datas
    data_operacao = db.Column(
        Date,
        nullable=False,
        index=True,
        comment="Data da opera√ß√£o"
    )
    
    data_liquidacao = db.Column(
        Date,
        nullable=True,
        index=True,
        comment="Data de liquida√ß√£o (D+2, D+3, etc.)"
    )
    
    # Metadados
    observacoes = db.Column(
        Text,
        nullable=True,
        comment="Observa√ß√µes sobre a transa√ß√£o"
    )
    
    # Timestamps
    created_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        nullable=False,
        comment="Data de cria√ß√£o do registro"
    )
    
    updated_at = db.Column(
        DateTime(timezone=True),
        default=datetime.utcnow,
        onupdate=datetime.utcnow,
        nullable=False,
        comment="Data da √∫ltima atualiza√ß√£o"
    )
    
    # Relacionamentos
    usuario = relationship('Usuario', backref='transacoes', lazy='joined')
    corretora = relationship('Corretora', backref='transacoes', lazy='joined')
    ativo = relationship('Ativo', backref='transacoes', lazy='joined')
    
    # Constraints de tabela
    __table_args__ = (
        db.CheckConstraint(
            "quantidade > 0",
            name="transacao_quantidade_positiva"
        ),
        db.CheckConstraint(
            "preco_unitario > 0",
            name="transacao_preco_positivo"
        ),
        db.CheckConstraint(
            "valor_total > 0",
            name="transacao_valor_total_positivo"
        ),
        db.CheckConstraint(
            "taxas >= 0",
            name="transacao_taxas_positivas"
        ),
        db.CheckConstraint(
            "impostos >= 0",
            name="transacao_impostos_positivos"
        ),
        db.CheckConstraint(
            "data_liquidacao IS NULL OR data_liquidacao >= data_operacao",
            name="transacao_data_liquidacao_valida"
        ),
        {'comment': 'Tabela de transa√ß√µes de compra e venda de ativos'}
    )
    
    def __init__(self, **kwargs):
        """
        Inicializa transa√ß√£o com c√°lculos autom√°ticos
        """
        super(Transacao, self).__init__(**kwargs)
        
        # Calcular valor total se n√£o fornecido
        if self.valor_total is None and self.quantidade and self.preco_unitario:
            self.valor_total = self.quantidade * self.preco_unitario
        
        # Calcular data de liquida√ß√£o se n√£o fornecida (D+2 para a√ß√µes BR)
        if self.data_liquidacao is None and self.data_operacao:
            self.data_liquidacao = self.data_operacao + timedelta(days=2)
    
    def is_compra(self):
        """Verifica se √© uma opera√ß√£o de compra"""
        return self.tipo_operacao == TipoOperacao.COMPRA
    
    def is_venda(self):
        """Verifica se √© uma opera√ß√£o de venda"""
        return self.tipo_operacao == TipoOperacao.VENDA
    
    def custo_total(self):
        """
        Calcula o custo total da opera√ß√£o (valor + taxas + impostos)
        
        Returns:
            Decimal: Custo total
        """
        taxas = self.taxas if self.taxas else 0
        impostos = self.impostos if self.impostos else 0
        return self.valor_total + taxas + impostos
    
    def receita_liquida(self):
        """
        Calcula a receita l√≠quida em caso de venda (valor - taxas - impostos)
        
        Returns:
            Decimal: Receita l√≠quida (None se n√£o for venda)
        """
        if not self.is_venda():
            return None
        
        taxas = self.taxas if self.taxas else 0
        impostos = self.impostos if self.impostos else 0
        return self.valor_total - taxas - impostos
    
    def percentual_custos(self):
        """
        Calcula o percentual de custos (taxas + impostos) sobre o valor
        
        Returns:
            Decimal: Percentual de custos (ex: 1.5 = 1.5%)
        """
        if self.valor_total > 0:
            taxas = self.taxas if self.taxas else 0
            impostos = self.impostos if self.impostos else 0
            total_custos = taxas + impostos
            return (total_custos / self.valor_total) * 100
        return 0
    
    def dias_ate_liquidacao(self):
        """
        Calcula quantos dias faltam para liquida√ß√£o
        
        Returns:
            int: Dias at√© liquida√ß√£o (negativo se j√° liquidada)
        """
        if self.data_liquidacao:
            hoje = datetime.utcnow().date()
            delta = self.data_liquidacao - hoje
            return delta.days
        return None
    
    def to_dict(self):
        """
        Converte objeto para dicion√°rio (para serializa√ß√£o JSON)
        
        Returns:
            dict: Dicion√°rio com dados da transa√ß√£o
        """
        return {
            'id': str(self.id),
            'usuario_id': str(self.usuario_id),
            'corretora_id': str(self.corretora_id),
            'ativo_id': str(self.ativo_id),
            'tipo_operacao': self.tipo_operacao.value if self.tipo_operacao else None,
            'quantidade': float(self.quantidade) if self.quantidade else 0,
            'preco_unitario': float(self.preco_unitario) if self.preco_unitario else 0,
            'valor_total': float(self.valor_total) if self.valor_total else 0,
            'taxas': float(self.taxas) if self.taxas else 0,
            'impostos': float(self.impostos) if self.impostos else 0,
            'custo_total': float(self.custo_total()),
            'receita_liquida': float(self.receita_liquida()) if self.receita_liquida() else None,
            'percentual_custos': float(self.percentual_custos()),
            'data_operacao': self.data_operacao.isoformat() if self.data_operacao else None,
            'data_liquidacao': self.data_liquidacao.isoformat() if self.data_liquidacao else None,
            'dias_ate_liquidacao': self.dias_ate_liquidacao(),
            'observacoes': self.observacoes,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        tipo = "COMPRA" if self.is_compra() else "VENDA"
        ticker = self.ativo.ticker if self.ativo else "N/A"
        return f"<Transacao {tipo} {self.quantidade}x {ticker} @ {self.preco_unitario}>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/models/usuario.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Model Usuario
Entidade principal para autentica√ß√£o e gest√£o de usu√°rios
"""

from datetime import datetime
from app.database import db
from sqlalchemy import String, Boolean, DateTime, Enum
from sqlalchemy.dialects.postgresql import UUID
import uuid
import enum
from werkzeug.security import generate_password_hash, check_password_hash


class UserRole(enum.Enum):
    """Enum para roles/perfis de usu√°rio"""
    ADMIN = "admin"
    USER = "user"
    READONLY = "readonly"


class Usuario(db.Model):
    """Model para usu√°rios do sistema Exitus"""
    
    __tablename__ = 'usuario'
    
    id = db.Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    username = db.Column(String(50), unique=True, nullable=False, index=True)
    email = db.Column(String(120), unique=True, nullable=False, index=True)
    password_hash = db.Column(String(255), nullable=False)
    nome_completo = db.Column(String(200), nullable=True)
    ativo = db.Column(Boolean, default=True, nullable=False)
    role = db.Column(Enum(UserRole), default=UserRole.USER, nullable=False)
    created_at = db.Column(DateTime(timezone=True), default=datetime.utcnow, nullable=False)
    updated_at = db.Column(DateTime(timezone=True), default=datetime.utcnow, onupdate=datetime.utcnow, nullable=False)
    
    def set_password(self, password):
        """Define a senha do usu√°rio (gera hash bcrypt)"""
        self.password_hash = generate_password_hash(password)
    
    def check_password(self, password):
        """Verifica se a senha fornecida est√° correta"""
        return check_password_hash(self.password_hash, password)
    
    def is_admin(self):
        """Verifica se usu√°rio √© administrador"""
        return self.role == UserRole.ADMIN
    
    def is_active(self):
        """Verifica se usu√°rio est√° ativo"""
        return self.ativo
    
    def to_dict(self, include_sensitive=False):
        """Converte objeto para dicion√°rio (para serializa√ß√£o JSON)"""
        data = {
            'id': str(self.id),
            'username': self.username,
            'email': self.email,
            'nome_completo': self.nome_completo,
            'ativo': self.ativo,
            'role': self.role.value if self.role else UserRole.USER.value,
            'created_at': self.created_at.isoformat() if self.created_at else None,
            'updated_at': self.updated_at.isoformat() if self.updated_at else None
        }
        if include_sensitive:
            data['password_hash'] = self.password_hash
        return data
    
    def __repr__(self):
        """Representa√ß√£o string do objeto"""
        return f"<Usuario {self.username} ({self.email})>"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/__init__.py ---

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/run_all_seeds.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Executar Todos os Seeds
Script master para popular o banco com dados iniciais
"""

import sys
from app.seeds.seed_usuarios import seed_usuarios
from app.seeds.seed_ativos_br import seed_ativos_br
from app.seeds.seed_regras_fiscais_br import seed_regras_fiscais_br
from app.seeds.seed_feriados_b3 import seed_feriados_b3
from app.seeds.seed_fontes_dados import seed_fontes_dados


def run_all_seeds():
    """Executa todos os seeds em sequ√™ncia"""
    
    print("\n" + "=" * 60)
    print("  EXITUS - EXECUTAR TODOS OS SEEDS")
    print("=" * 60)
    print("\nEste script ir√° popular o banco com dados iniciais:")
    print("  1. Usu√°rios (4)")
    print("  2. Ativos BR (25)")
    print("  3. Regras Fiscais BR (6)")
    print("  4. Feriados B3 2025-2026 (30)")
    print("  5. Fontes de Dados (7)")
    print("\n‚ö† ATEN√á√ÉO: Seeds existentes ser√£o solicitados para confirma√ß√£o.\n")
    
    resposta = input("Deseja continuar? (s/N): ").lower()
    if resposta != 's':
        print("\n‚úó Opera√ß√£o cancelada pelo usu√°rio.\n")
        return
    
    seeds = [
        ("Usu√°rios", seed_usuarios),
        ("Ativos BR", seed_ativos_br),
        ("Regras Fiscais BR", seed_regras_fiscais_br),
        ("Feriados B3", seed_feriados_b3),
        ("Fontes de Dados", seed_fontes_dados),
    ]
    
    sucessos = 0
    erros = 0
    
    for nome, seed_func in seeds:
        print("\n" + "=" * 60)
        try:
            seed_func()
            sucessos += 1
        except KeyboardInterrupt:
            print(f"\n\n‚ö† Seed '{nome}' interrompido pelo usu√°rio.")
            print("Processo de seeds cancelado.\n")
            sys.exit(1)
        except Exception as e:
            print(f"\n‚úó Erro ao executar seed '{nome}': {e}")
            erros += 1
            resposta = input("\nDeseja continuar com os pr√≥ximos seeds? (s/N): ").lower()
            if resposta != 's':
                break
    
    # Resumo final
    print("\n" + "=" * 60)
    print("  RESUMO FINAL")
    print("=" * 60)
    print(f"‚úì Seeds executados com sucesso: {sucessos}")
    if erros > 0:
        print(f"‚úó Seeds com erro: {erros}")
    print("=" * 60 + "\n")
    
    if erros == 0:
        print("üéâ Todos os seeds foram executados com sucesso!")
        print("O banco de dados est√° pronto para uso.\n")
    else:
        print("‚ö† Alguns seeds falharam. Verifique os erros acima.\n")


if __name__ == '__main__':
    run_all_seeds()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/seed_ativos_br.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Seed de Ativos Brasileiros
Popular tabela ativo com a√ß√µes e FIIs da B3
"""

from app import create_app
from app.database import db
from app.models import Ativo, TipoAtivo, ClasseAtivo
from decimal import Decimal


def seed_ativos_br():
    """Cria ativos brasileiros (B3)"""
    
    app = create_app()
    
    with app.app_context():
        print("=" * 50)
        print("SEED: Criando Ativos Brasileiros (B3)")
        print("=" * 50)
        
        # Verificar se j√° existem ativos
        count = Ativo.query.filter_by(mercado='BR').count()
        if count > 0:
            print(f"‚ö† J√° existem {count} ativos brasileiros cadastrados.")
            resposta = input("Deseja recriar os ativos BR? (s/N): ").lower()
            if resposta != 's':
                print("‚úó Seed cancelado pelo usu√°rio.")
                return
            
            # Limpar ativos BR existentes
            Ativo.query.filter_by(mercado='BR').delete()
            db.session.commit()
            print("‚úì Ativos brasileiros anteriores removidos.")
        
        # A√ß√µes mais negociadas da B3
        acoes = [
            # Ticker, Nome, Setor, Pre√ßo Inicial
            ('PETR4', 'Petrobras PN', 'Petr√≥leo e G√°s', Decimal('38.50')),
            ('VALE3', 'Vale ON', 'Minera√ß√£o', Decimal('62.80')),
            ('ITUB4', 'Ita√∫ Unibanco PN', 'Bancos', Decimal('28.45')),
            ('BBDC4', 'Bradesco PN', 'Bancos', Decimal('13.20')),
            ('BBAS3', 'Banco do Brasil ON', 'Bancos', Decimal('25.60')),
            ('MGLU3', 'Magazine Luiza ON', 'Varejo', Decimal('8.75')),
            ('WEGE3', 'WEG ON', 'M√°quinas e Equipamentos', Decimal('42.30')),
            ('RENT3', 'Localiza ON', 'Loca√ß√£o de Ve√≠culos', Decimal('56.90')),
            ('RAIL3', 'Rumo ON', 'Transporte', Decimal('18.45')),
            ('SUZB3', 'Suzano ON', 'Papel e Celulose', Decimal('52.80')),
            ('KLBN11', 'Klabin Units', 'Papel e Celulose', Decimal('22.15')),
            ('ELET3', 'Eletrobras ON', 'Energia El√©trica', Decimal('42.10')),
            ('CMIG4', 'Cemig PN', 'Energia El√©trica', Decimal('10.85')),
            ('CPLE6', 'Copel PNB', 'Energia El√©trica', Decimal('8.95')),
            ('ABEV3', 'Ambev ON', 'Bebidas', Decimal('11.20')),
        ]
        
        # FIIs mais negociados
        fiis = [
            # Ticker, Nome, Segmento, Pre√ßo Inicial
            ('HGLG11', 'CSHG Log√≠stica FII', 'Log√≠stica', Decimal('152.30')),
            ('VISC11', 'Vinci Shopping Centers FII', 'Shopping', Decimal('105.80')),
            ('KNRI11', 'Kinea Renda Imobili√°ria FII', 'H√≠brido', Decimal('98.45')),
            ('BTLG11', 'BTG Pactual Log√≠stica FII', 'Log√≠stica', Decimal('102.70')),
            ('XPML11', 'XP Malls FII', 'Shopping', Decimal('95.60')),
            ('MXRF11', 'Maxi Renda FII', 'H√≠brido', Decimal('10.25')),
            ('TRXF11', 'TRX Real Estate FII', 'Lajes Corporativas', Decimal('95.30')),
            ('KNCR11', 'Kinea Rendimentos Imobili√°rios FII', 'Papel', Decimal('110.50')),
            ('LVBI11', 'VBI Log√≠stico FII', 'Log√≠stica', Decimal('98.20')),
            ('GGRC11', 'GGR Covepi Renda FII', 'Lajes Corporativas', Decimal('105.40')),
        ]
        
        created_ativos = []
        
        # Criar a√ß√µes
        print("\nüìà Criando A√ß√µes...")
        for ticker, nome, setor, preco in acoes:
            ativo = Ativo(
                ticker=ticker,
                nome=nome,
                tipo=TipoAtivo.ACAO,
                classe=ClasseAtivo.RENDA_VARIAVEL,
                mercado='BR',
                moeda='BRL',
                preco_atual=preco,
                observacoes=f'Setor: {setor}',
                ativo=True
            )
            db.session.add(ativo)
            created_ativos.append(ativo)
            print(f"  ‚úì {ticker:8} - {nome:35} - R$ {preco}")
        
        # Criar FIIs
        print("\nüè¢ Criando FIIs...")
        for ticker, nome, segmento, preco in fiis:
            ativo = Ativo(
                ticker=ticker,
                nome=nome,
                tipo=TipoAtivo.FII,
                classe=ClasseAtivo.RENDA_VARIAVEL,
                mercado='BR',
                moeda='BRL',
                preco_atual=preco,
                observacoes=f'Segmento: {segmento}',
                ativo=True
            )
            db.session.add(ativo)
            created_ativos.append(ativo)
            print(f"  ‚úì {ticker:8} - {nome:40} - R$ {preco}")
        
        # Commit no banco
        try:
            db.session.commit()
            print("\n" + "=" * 50)
            print(f"‚úì {len(created_ativos)} ativos criados com sucesso!")
            print(f"  - {len(acoes)} a√ß√µes")
            print(f"  - {len(fiis)} FIIs")
            print("=" * 50 + "\n")
            
        except Exception as e:
            db.session.rollback()
            print(f"\n‚úó Erro ao criar ativos: {e}")
            raise


if __name__ == '__main__':
    seed_ativos_br()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/seed_feriados_b3.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Seed de Feriados B3
Popular tabela feriado_mercado com feriados da B3
"""

from app import create_app
from app.database import db
from app.models import FeriadoMercado, TipoFeriado
from datetime import date


def seed_feriados_b3():
    """Cria feriados da B3 para 2025 e 2026"""
    
    app = create_app()
    
    with app.app_context():
        print("=" * 50)
        print("SEED: Criando Feriados B3 (2025-2026)")
        print("=" * 50)
        
        # Verificar se j√° existem feriados B3
        count = FeriadoMercado.query.filter_by(pais='BR', mercado='B3').count()
        if count > 0:
            print(f"‚ö† J√° existem {count} feriados B3 cadastrados.")
            resposta = input("Deseja recriar os feriados? (s/N): ").lower()
            if resposta != 's':
                print("‚úó Seed cancelado pelo usu√°rio.")
                return
            
            # Limpar feriados B3 existentes
            FeriadoMercado.query.filter_by(pais='BR', mercado='B3').delete()
            db.session.commit()
            print("‚úì Feriados B3 anteriores removidos.")
        
        # Feriados B3 2025
        feriados_2025 = [
            (date(2025, 1, 1), 'Confraterniza√ß√£o Universal', TipoFeriado.NACIONAL, True),
            (date(2025, 3, 3), 'Carnaval', TipoFeriado.NACIONAL, False),
            (date(2025, 3, 4), 'Carnaval (Quarta de Cinzas - meio per√≠odo)', TipoFeriado.NACIONAL, False),
            (date(2025, 4, 18), 'Sexta-feira Santa', TipoFeriado.NACIONAL, True),
            (date(2025, 4, 21), 'Tiradentes', TipoFeriado.NACIONAL, True),
            (date(2025, 5, 1), 'Dia do Trabalho', TipoFeriado.NACIONAL, True),
            (date(2025, 6, 19), 'Corpus Christi', TipoFeriado.NACIONAL, False),
            (date(2025, 9, 7), 'Independ√™ncia do Brasil', TipoFeriado.NACIONAL, True),
            (date(2025, 10, 12), 'Nossa Senhora Aparecida', TipoFeriado.NACIONAL, True),
            (date(2025, 11, 2), 'Finados', TipoFeriado.NACIONAL, True),
            (date(2025, 11, 15), 'Proclama√ß√£o da Rep√∫blica', TipoFeriado.NACIONAL, True),
            (date(2025, 11, 20), 'Dia da Consci√™ncia Negra', TipoFeriado.NACIONAL, True),
            (date(2025, 12, 24), 'V√©spera de Natal (meio per√≠odo)', TipoFeriado.FECHAMENTO_ANTECIPADO, False),
            (date(2025, 12, 25), 'Natal', TipoFeriado.NACIONAL, True),
            (date(2025, 12, 31), 'V√©spera de Ano Novo (meio per√≠odo)', TipoFeriado.FECHAMENTO_ANTECIPADO, False),
        ]
        
        # Feriados B3 2026
        feriados_2026 = [
            (date(2026, 1, 1), 'Confraterniza√ß√£o Universal', TipoFeriado.NACIONAL, True),
            (date(2026, 2, 16), 'Carnaval', TipoFeriado.NACIONAL, False),
            (date(2026, 2, 17), 'Carnaval (Quarta de Cinzas - meio per√≠odo)', TipoFeriado.NACIONAL, False),
            (date(2026, 4, 3), 'Sexta-feira Santa', TipoFeriado.NACIONAL, True),
            (date(2026, 4, 21), 'Tiradentes', TipoFeriado.NACIONAL, True),
            (date(2026, 5, 1), 'Dia do Trabalho', TipoFeriado.NACIONAL, True),
            (date(2026, 6, 4), 'Corpus Christi', TipoFeriado.NACIONAL, False),
            (date(2026, 9, 7), 'Independ√™ncia do Brasil', TipoFeriado.NACIONAL, True),
            (date(2026, 10, 12), 'Nossa Senhora Aparecida', TipoFeriado.NACIONAL, True),
            (date(2026, 11, 2), 'Finados', TipoFeriado.NACIONAL, True),
            (date(2026, 11, 15), 'Proclama√ß√£o da Rep√∫blica', TipoFeriado.NACIONAL, True),
            (date(2026, 11, 20), 'Dia da Consci√™ncia Negra', TipoFeriado.NACIONAL, True),
            (date(2026, 12, 24), 'V√©spera de Natal (meio per√≠odo)', TipoFeriado.FECHAMENTO_ANTECIPADO, False),
            (date(2026, 12, 25), 'Natal', TipoFeriado.NACIONAL, True),
            (date(2026, 12, 31), 'V√©spera de Ano Novo (meio per√≠odo)', TipoFeriado.FECHAMENTO_ANTECIPADO, False),
        ]
        
        todos_feriados = feriados_2025 + feriados_2026
        created_feriados = []
        
        print("\nüìÖ Criando Feriados 2025...")
        for data_feriado, nome, tipo, recorrente in feriados_2025:
            feriado = FeriadoMercado(
                pais='BR',
                mercado='B3',
                data_feriado=data_feriado,
                tipo_feriado=tipo,
                nome=nome,
                recorrente=recorrente
            )
            db.session.add(feriado)
            created_feriados.append(feriado)
            tipo_icon = "üö´" if tipo == TipoFeriado.NACIONAL else "‚è∞"
            print(f"  {tipo_icon} {data_feriado.strftime('%d/%m/%Y')} - {nome}")
        
        print("\nüìÖ Criando Feriados 2026...")
        for data_feriado, nome, tipo, recorrente in feriados_2026:
            feriado = FeriadoMercado(
                pais='BR',
                mercado='B3',
                data_feriado=data_feriado,
                tipo_feriado=tipo,
                nome=nome,
                recorrente=recorrente
            )
            db.session.add(feriado)
            created_feriados.append(feriado)
            tipo_icon = "üö´" if tipo == TipoFeriado.NACIONAL else "‚è∞"
            print(f"  {tipo_icon} {data_feriado.strftime('%d/%m/%Y')} - {nome}")
        
        # Commit no banco
        try:
            db.session.commit()
            print("\n" + "=" * 50)
            print(f"‚úì {len(created_feriados)} feriados criados!")
            print(f"  - 2025: {len(feriados_2025)} feriados")
            print(f"  - 2026: {len(feriados_2026)} feriados")
            print("=" * 50)
            print("\nüìå LEGENDA:")
            print("  üö´ = Fechamento total (sem preg√£o)")
            print("  ‚è∞ = Fechamento antecipado (meio per√≠odo)\n")
            
        except Exception as e:
            db.session.rollback()
            print(f"\n‚úó Erro ao criar feriados: {e}")
            raise


if __name__ == '__main__':
    seed_feriados_b3()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/seed_fontes_dados.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Seed de Fontes de Dados
Popular tabela fonte_dados com APIs de cota√ß√µes
"""

from app import create_app
from app.database import db
from app.models import FonteDados, TipoFonteDados


def seed_fontes_dados():
    """Cria fontes de dados (APIs)"""
    
    app = create_app()
    
    with app.app_context():
        print("=" * 50)
        print("SEED: Criando Fontes de Dados (APIs)")
        print("=" * 50)
        
        # Verificar se j√° existem fontes
        count = FonteDados.query.count()
        if count > 0:
            print(f"‚ö† J√° existem {count} fontes de dados cadastradas.")
            resposta = input("Deseja recriar as fontes? (s/N): ").lower()
            if resposta != 's':
                print("‚úó Seed cancelado pelo usu√°rio.")
                return
            
            # Limpar fontes existentes
            FonteDados.query.delete()
            db.session.commit()
            print("‚úì Fontes de dados anteriores removidas.")
        
        # Fontes de dados
        fontes = [
            {
                'nome': 'yfinance',
                'tipo_fonte': TipoFonteDados.API,
                'url_base': 'https://query1.finance.yahoo.com',
                'requer_autenticacao': False,
                'rate_limit': '2000/hour',
                'ativa': True,
                'prioridade': 1,
                'observacoes': 'Biblioteca Python gratuita para Yahoo Finance. Boa cobertura global, incluindo B3.'
            },
            {
                'nome': 'brapi.dev',
                'tipo_fonte': TipoFonteDados.API,
                'url_base': 'https://brapi.dev/api',
                'requer_autenticacao': False,
                'rate_limit': '100/minute',
                'ativa': True,
                'prioridade': 1,
                'observacoes': 'API brasileira gratuita especializada em ativos da B3. Dados em tempo real.'
            },
            {
                'nome': 'Alpha Vantage',
                'tipo_fonte': TipoFonteDados.API,
                'url_base': 'https://www.alphavantage.co/query',
                'requer_autenticacao': True,
                'rate_limit': '5/minute',
                'ativa': True,
                'prioridade': 2,
                'observacoes': 'API gratuita com chave. Limite de 5 requisi√ß√µes por minuto (plano free).'
            },
            {
                'nome': 'Finnhub',
                'tipo_fonte': TipoFonteDados.API,
                'url_base': 'https://finnhub.io/api/v1',
                'requer_autenticacao': True,
                'rate_limit': '60/minute',
                'ativa': True,
                'prioridade': 2,
                'observacoes': 'API com plano gratuito. Boa cobertura de mercados globais e not√≠cias.'
            },
            {
                'nome': 'IEX Cloud',
                'tipo_fonte': TipoFonteDados.API,
                'url_base': 'https://cloud.iexapis.com/stable',
                'requer_autenticacao': True,
                'rate_limit': '50000/month',
                'ativa': True,
                'prioridade': 3,
                'observacoes': 'API focada em mercado americano. Plano gratuito com limite mensal.'
            },
            {
                'nome': 'Polygon.io',
                'tipo_fonte': TipoFonteDados.API,
                'url_base': 'https://api.polygon.io',
                'requer_autenticacao': True,
                'rate_limit': '5/minute',
                'ativa': False,
                'prioridade': 4,
                'observacoes': 'API premium com dados hist√≥ricos detalhados. Desativada por padr√£o.'
            },
            {
                'nome': 'Manual',
                'tipo_fonte': TipoFonteDados.MANUAL,
                'url_base': None,
                'requer_autenticacao': False,
                'rate_limit': None,
                'ativa': True,
                'prioridade': 99,
                'observacoes': 'Entrada manual de dados pelo usu√°rio.'
            },
        ]
        
        created_fontes = []
        
        print("\nüîå Criando Fontes de Dados...")
        for fonte_data in fontes:
            fonte = FonteDados(
                nome=fonte_data['nome'],
                tipo_fonte=fonte_data['tipo_fonte'],
                url_base=fonte_data['url_base'],
                requer_autenticacao=fonte_data['requer_autenticacao'],
                rate_limit=fonte_data['rate_limit'],
                ativa=fonte_data['ativa'],
                prioridade=fonte_data['prioridade'],
                observacoes=fonte_data['observacoes']
            )
            db.session.add(fonte)
            created_fontes.append(fonte)
            
            status_icon = "‚úì" if fonte.ativa else "‚úó"
            auth_icon = "üîê" if fonte.requer_autenticacao else "üîì"
            
            print(f"  {status_icon} {auth_icon} {fonte.nome:20} | Prioridade: {fonte.prioridade} | Limite: {fonte.rate_limit or 'N/A'}")
        
        # Commit no banco
        try:
            db.session.commit()
            print("\n" + "=" * 50)
            print(f"‚úì {len(created_fontes)} fontes de dados criadas!")
            print("=" * 50)
            print("\nüìå LEGENDA:")
            print("  ‚úì = Ativa    | ‚úó = Inativa")
            print("  üîì = Sem auth | üîê = Requer chave API")
            print("\nüí° PRIORIDADE:")
            print("  1 = Alta (usar primeiro)")
            print("  2-3 = M√©dia (fallback)")
            print("  99 = Baixa (manual)\n")
            
        except Exception as e:
            db.session.rollback()
            print(f"\n‚úó Erro ao criar fontes: {e}")
            raise


if __name__ == '__main__':
    seed_fontes_dados()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/seed_regras_fiscais_br.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Seed de Regras Fiscais Brasileiras
Popular tabela regra_fiscal com regras de IR do Brasil
"""

from app import create_app
from app.database import db
from app.models import RegraFiscal, IncidenciaImposto
from decimal import Decimal
from datetime import date


def seed_regras_fiscais_br():
    """Cria regras fiscais brasileiras"""
    
    app = create_app()
    
    with app.app_context():
        print("=" * 50)
        print("SEED: Criando Regras Fiscais Brasileiras")
        print("=" * 50)
        
        # Verificar se j√° existem regras BR
        count = RegraFiscal.query.filter_by(pais='BR').count()
        if count > 0:
            print(f"‚ö† J√° existem {count} regras fiscais brasileiras.")
            resposta = input("Deseja recriar as regras BR? (s/N): ").lower()
            if resposta != 's':
                print("‚úó Seed cancelado pelo usu√°rio.")
                return
            
            # Limpar regras BR existentes
            RegraFiscal.query.filter_by(pais='BR').delete()
            db.session.commit()
            print("‚úì Regras fiscais brasileiras anteriores removidas.")
        
        # Regras fiscais brasileiras
        regras = [
            {
                'tipo_ativo': 'ACAO',
                'tipo_operacao': 'SWING_TRADE',
                'aliquota_ir': Decimal('15.0000'),
                'valor_isencao': Decimal('20000.00'),
                'incide_sobre': IncidenciaImposto.LUCRO,
                'descricao': 'IR sobre ganho de capital em a√ß√µes - Swing Trade. Isen√ß√£o para vendas at√© R$ 20.000,00 por m√™s.'
            },
            {
                'tipo_ativo': 'ACAO',
                'tipo_operacao': 'DAY_TRADE',
                'aliquota_ir': Decimal('20.0000'),
                'valor_isencao': None,
                'incide_sobre': IncidenciaImposto.LUCRO,
                'descricao': 'IR sobre ganho de capital em Day Trade. SEM isen√ß√£o, al√≠quota de 20%.'
            },
            {
                'tipo_ativo': 'FII',
                'tipo_operacao': 'SWING_TRADE',
                'aliquota_ir': Decimal('20.0000'),
                'valor_isencao': None,
                'incide_sobre': IncidenciaImposto.LUCRO,
                'descricao': 'IR sobre ganho de capital em FIIs. SEM isen√ß√£o, al√≠quota de 20%.'
            },
            {
                'tipo_ativo': None,  # Aplica a todos
                'tipo_operacao': None,
                'aliquota_ir': Decimal('15.0000'),
                'valor_isencao': None,
                'incide_sobre': IncidenciaImposto.PROVENTO,
                'descricao': 'IR sobre JCP (Juros sobre Capital Pr√≥prio). Retido na fonte, al√≠quota de 15%.'
            },
            {
                'tipo_ativo': 'FII',
                'tipo_operacao': None,
                'aliquota_ir': Decimal('0.0000'),
                'valor_isencao': None,
                'incide_sobre': IncidenciaImposto.PROVENTO,
                'descricao': 'Rendimentos de FII s√£o ISENTOS de IR para pessoa f√≠sica (requisitos: FII com +50 cotistas, cotas negociadas em bolsa, investidor com <10% das cotas).'
            },
            {
                'tipo_ativo': 'ACAO',
                'tipo_operacao': None,
                'aliquota_ir': Decimal('0.0000'),
                'valor_isencao': None,
                'incide_sobre': IncidenciaImposto.PROVENTO,
                'descricao': 'Dividendos de a√ß√µes s√£o ISENTOS de IR para pessoa f√≠sica no Brasil.'
            },
        ]
        
        created_regras = []
        
        print("\nüìã Criando Regras...")
        for regra_data in regras:
            regra = RegraFiscal(
                pais='BR',
                tipo_ativo=regra_data['tipo_ativo'],
                tipo_operacao=regra_data['tipo_operacao'],
                aliquota_ir=regra_data['aliquota_ir'],
                valor_isencao=regra_data['valor_isencao'],
                incide_sobre=regra_data['incide_sobre'],
                descricao=regra_data['descricao'],
                vigencia_inicio=date(2024, 1, 1),
                ativa=True
            )
            db.session.add(regra)
            created_regras.append(regra)
            
            tipo_str = regra_data['tipo_ativo'] or 'TODOS'
            op_str = regra_data['tipo_operacao'] or 'TODAS'
            isencao_str = f"R$ {regra_data['valor_isencao']}" if regra_data['valor_isencao'] else "SEM"
            
            print(f"  ‚úì {tipo_str:10} | {op_str:12} | IR: {regra_data['aliquota_ir']:6}% | Isen√ß√£o: {isencao_str}")
        
        # Commit no banco
        try:
            db.session.commit()
            print("\n" + "=" * 50)
            print(f"‚úì {len(created_regras)} regras fiscais criadas!")
            print("=" * 50)
            print("\nüìå RESUMO DAS REGRAS:")
            print("-" * 50)
            print("‚Ä¢ A√ß√µes Swing Trade: 15% IR (isen√ß√£o at√© R$ 20k/m√™s)")
            print("‚Ä¢ A√ß√µes Day Trade: 20% IR (sem isen√ß√£o)")
            print("‚Ä¢ FII Swing Trade: 20% IR (sem isen√ß√£o)")
            print("‚Ä¢ Dividendos de A√ß√µes: ISENTO")
            print("‚Ä¢ Rendimentos de FII: ISENTO*")
            print("‚Ä¢ JCP: 15% IR retido na fonte")
            print("-" * 50)
            print("* Requisitos para isen√ß√£o de FII aplicam-se\n")
            
        except Exception as e:
            db.session.rollback()
            print(f"\n‚úó Erro ao criar regras fiscais: {e}")
            raise


if __name__ == '__main__':
    seed_regras_fiscais_br()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/app/seeds/seed_usuarios.py ---
# -*- coding: utf-8 -*-
"""
Exitus - Seed de Usu√°rios
Popular tabela usuario com dados iniciais
"""
import sys
import os
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '../..')))


from app import create_app
from app.database import db
from app.models import Usuario, UserRole
from datetime import datetime


def seed_usuarios():
    """Cria usu√°rios iniciais do sistema"""
    
    app = create_app()
    
    with app.app_context():
        print("=" * 50)
        print("SEED: Criando Usu√°rios Iniciais")
        print("=" * 50)
        
        # Verificar se j√° existem usu√°rios
        count = Usuario.query.count()
        if count > 0:
            print(f"‚ö† J√° existem {count} usu√°rios cadastrados.")
            resposta = input("Deseja recriar os usu√°rios? (s/N): ").lower()
            if resposta != 's':
                print("‚úó Seed cancelado pelo usu√°rio.")
                return
            
            # Limpar usu√°rios existentes
            Usuario.query.delete()
            db.session.commit()
            print("‚úì Usu√°rios anteriores removidos.")
        
        # Lista de usu√°rios a criar
        usuarios = [
            {
                'username': 'admin',
                'email': 'admin@exitus.com',
                'password': 'admin123',  # Senha padr√£o para desenvolvimento
                'nome_completo': 'Administrador do Sistema',
                'role': UserRole.ADMIN,
                'ativo': True
            },
            {
                'username': 'joao.silva',
                'email': 'joao.silva@example.com',
                'password': 'user123',
                'nome_completo': 'Jo√£o Silva',
                'role': UserRole.USER,
                'ativo': True
            },
            {
                'username': 'maria.santos',
                'email': 'maria.santos@example.com',
                'password': 'user123',
                'nome_completo': 'Maria Santos',
                'role': UserRole.USER,
                'ativo': True
            },
            {
                'username': 'viewer',
                'email': 'viewer@exitus.com',
                'password': 'viewer123',
                'nome_completo': 'Usu√°rio Visualizador',
                'role': UserRole.READONLY,
                'ativo': True
            }
        ]
        
        # Criar usu√°rios
        created_users = []
        for user_data in usuarios:
            user = Usuario(
                username=user_data['username'],
                email=user_data['email'],
                nome_completo=user_data.get('nome_completo'),
                role=user_data['role'],
                ativo=user_data['ativo']
            )
            user.set_password(user_data['password'])
            
            db.session.add(user)
            created_users.append(user)
            
            print(f"‚úì Usu√°rio criado: {user.username} ({user.role.value}) - {user.email}")
        
        # Commit no banco
        try:
            db.session.commit()
            print("\n" + "=" * 50)
            print(f"‚úì {len(created_users)} usu√°rios criados com sucesso!")
            print("=" * 50)
            
            # Exibir credenciais
            print("\nüìã CREDENCIAIS DE ACESSO:")
            print("-" * 50)
            for user_data in usuarios:
                print(f"Username: {user_data['username']:<15} | Senha: {user_data['password']}")
            print("-" * 50)
            print("‚ö† ATEN√á√ÉO: Altere as senhas em produ√ß√£o!\n")
            
        except Exception as e:
            db.session.rollback()
            print(f"\n‚úó Erro ao criar usu√°rios: {e}")
            raise


if __name__ == '__main__':
    seed_usuarios()

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/requirements.txt ---
Flask==3.0.0
Flask-SQLAlchemy==3.1.1
Flask-Migrate==4.0.5
Flask-CORS==4.0.0
psycopg2-binary==2.9.9
python-dotenv==1.0.0
requests==2.31.0
pytest==7.4.3
gunicorn==21.2.0
alembic==1.13.1
Flask-Migrate==4.0.5

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backend/run.py ---
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Exitus Backend - Entry Point"""

from app import create_app
import os

app = create_app()

if __name__ == '__main__':
    port = int(os.getenv('FLASK_PORT', 5000))
    app.run(host='0.0.0.0', port=port, debug=(os.getenv('FLASK_ENV') == 'development'))

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/backup_fase4_20251126.sql ---
--
-- PostgreSQL database dump
--

\restrict GKPkJ0HUazHhGWoZucB0W175i385M8gluav75q4QDk791AqK2yfWUeOUdV3G2s9

-- Dumped from database version 15.15 (Debian 15.15-1.pgdg13+1)
-- Dumped by pg_dump version 15.15 (Debian 15.15-1.pgdg13+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: classeativo; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.classeativo AS ENUM (
    'RENDA_VARIAVEL',
    'RENDA_FIXA',
    'CRIPTO',
    'HIBRIDO'
);


ALTER TYPE public.classeativo OWNER TO exitus;

--
-- Name: incidenciaimposto; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.incidenciaimposto AS ENUM (
    'LUCRO',
    'RECEITA',
    'PROVENTO',
    'OPERACAO'
);


ALTER TYPE public.incidenciaimposto OWNER TO exitus;

--
-- Name: tipoativo; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipoativo AS ENUM (
    'ACAO',
    'FII',
    'REIT',
    'BOND',
    'ETF',
    'CRIPTO',
    'OUTRO'
);


ALTER TYPE public.tipoativo OWNER TO exitus;

--
-- Name: tipocorretora; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipocorretora AS ENUM (
    'CORRETORA',
    'EXCHANGE'
);


ALTER TYPE public.tipocorretora OWNER TO exitus;

--
-- Name: tipoeventocorporativo; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipoeventocorporativo AS ENUM (
    'SPLIT',
    'GRUPAMENTO',
    'BONIFICACAO',
    'DIREITO_SUBSCRICAO',
    'FUSAO',
    'CISAO',
    'INCORPORACAO',
    'MUDANCA_TICKER',
    'DESLISTAGEM',
    'RELISTING',
    'CANCELAMENTO',
    'OUTRO'
);


ALTER TYPE public.tipoeventocorporativo OWNER TO exitus;

--
-- Name: tipoferiado; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipoferiado AS ENUM (
    'NACIONAL',
    'BOLSA',
    'PONTE',
    'FECHAMENTO_ANTECIPADO',
    'MANUTENCAO',
    'OUTRO'
);


ALTER TYPE public.tipoferiado OWNER TO exitus;

--
-- Name: tipofontedados; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipofontedados AS ENUM (
    'API',
    'SCRAPER',
    'MANUAL',
    'ARQUIVO',
    'OUTRO'
);


ALTER TYPE public.tipofontedados OWNER TO exitus;

--
-- Name: tipomovimentacao; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipomovimentacao AS ENUM (
    'DEPOSITO',
    'SAQUE',
    'TRANSFERENCIA_ENVIADA',
    'TRANSFERENCIA_RECEBIDA',
    'CREDITO_PROVENTO',
    'PAGAMENTO_TAXA',
    'PAGAMENTO_IMPOSTO',
    'AJUSTE',
    'OUTRO'
);


ALTER TYPE public.tipomovimentacao OWNER TO exitus;

--
-- Name: tipooperacao; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipooperacao AS ENUM (
    'COMPRA',
    'VENDA'
);


ALTER TYPE public.tipooperacao OWNER TO exitus;

--
-- Name: tipoprovento; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.tipoprovento AS ENUM (
    'DIVIDENDO',
    'JCP',
    'RENDIMENTO',
    'CUPOM',
    'BONIFICACAO',
    'DIREITO_SUBSCRICAO',
    'OUTRO'
);


ALTER TYPE public.tipoprovento OWNER TO exitus;

--
-- Name: userrole; Type: TYPE; Schema: public; Owner: exitus
--

CREATE TYPE public.userrole AS ENUM (
    'ADMIN',
    'USER',
    'READONLY'
);


ALTER TYPE public.userrole OWNER TO exitus;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: alembic_version; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.alembic_version (
    version_num character varying(32) NOT NULL
);


ALTER TABLE public.alembic_version OWNER TO exitus;

--
-- Name: ativo; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.ativo (
    id uuid NOT NULL,
    ticker character varying(20) NOT NULL,
    nome character varying(200) NOT NULL,
    tipo public.tipoativo NOT NULL,
    classe public.classeativo NOT NULL,
    mercado character varying(10) NOT NULL,
    moeda character varying(3) NOT NULL,
    preco_atual numeric(18,6),
    data_ultima_cotacao timestamp with time zone,
    dividend_yield numeric(8,4),
    p_l numeric(10,2),
    p_vp numeric(10,2),
    roe numeric(8,4),
    ativo boolean NOT NULL,
    deslistado boolean NOT NULL,
    data_deslistagem date,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT ativo_nome_min_length CHECK ((length((nome)::text) >= 2)),
    CONSTRAINT ativo_preco_positivo CHECK (((preco_atual IS NULL) OR (preco_atual >= (0)::numeric))),
    CONSTRAINT ativo_ticker_min_length CHECK ((length((ticker)::text) >= 1))
);


ALTER TABLE public.ativo OWNER TO exitus;

--
-- Name: TABLE ativo; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.ativo IS 'Tabela de ativos financeiros (a√ß√µes, FIIs, REITs, bonds, criptomoedas)';


--
-- Name: COLUMN ativo.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.id IS 'Identificador √∫nico do ativo';


--
-- Name: COLUMN ativo.ticker; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.ticker IS 'C√≥digo/s√≠mbolo do ativo (ex: PETR4, AAPL, BTC)';


--
-- Name: COLUMN ativo.nome; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.nome IS 'Nome completo do ativo';


--
-- Name: COLUMN ativo.tipo; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.tipo IS 'Tipo do ativo (a√ß√£o, FII, REIT, bond, cripto)';


--
-- Name: COLUMN ativo.classe; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.classe IS 'Classe do ativo (renda vari√°vel, fixa, cripto)';


--
-- Name: COLUMN ativo.mercado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.mercado IS 'Mercado/pa√≠s de negocia√ß√£o (BR, US, EUR)';


--
-- Name: COLUMN ativo.moeda; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.moeda IS 'Moeda de negocia√ß√£o (BRL, USD, EUR)';


--
-- Name: COLUMN ativo.preco_atual; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.preco_atual IS 'Pre√ßo/cota√ß√£o atual do ativo';


--
-- Name: COLUMN ativo.data_ultima_cotacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.data_ultima_cotacao IS 'Data e hora da √∫ltima cota√ß√£o';


--
-- Name: COLUMN ativo.dividend_yield; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.dividend_yield IS 'Dividend Yield em % (ex: 6.5000 = 6.5%)';


--
-- Name: COLUMN ativo.p_l; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.p_l IS '√çndice Pre√ßo/Lucro';


--
-- Name: COLUMN ativo.p_vp; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.p_vp IS '√çndice Pre√ßo/Valor Patrimonial';


--
-- Name: COLUMN ativo.roe; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.roe IS 'Return on Equity em %';


--
-- Name: COLUMN ativo.ativo; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.ativo IS 'Indica se ativo est√° dispon√≠vel para negocia√ß√£o';


--
-- Name: COLUMN ativo.deslistado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.deslistado IS 'Indica se ativo foi deslistado da bolsa';


--
-- Name: COLUMN ativo.data_deslistagem; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.data_deslistagem IS 'Data de deslistagem (se aplic√°vel)';


--
-- Name: COLUMN ativo.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.observacoes IS 'Observa√ß√µes e notas sobre o ativo';


--
-- Name: COLUMN ativo.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN ativo.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.ativo.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: corretora; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.corretora (
    id uuid NOT NULL,
    usuario_id uuid NOT NULL,
    nome character varying(100) NOT NULL,
    tipo public.tipocorretora NOT NULL,
    pais character varying(2) NOT NULL,
    moeda_padrao character varying(3) NOT NULL,
    saldo_atual numeric(18,2) NOT NULL,
    ativa boolean NOT NULL,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT corretora_moeda_iso_format CHECK (((moeda_padrao)::text ~* '^[A-Z]{3}$'::text)),
    CONSTRAINT corretora_nome_min_length CHECK ((length((nome)::text) >= 2)),
    CONSTRAINT corretora_pais_iso_format CHECK (((pais)::text ~* '^[A-Z]{2}$'::text)),
    CONSTRAINT corretora_saldo_positivo CHECK ((saldo_atual >= (0)::numeric))
);


ALTER TABLE public.corretora OWNER TO exitus;

--
-- Name: TABLE corretora; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.corretora IS 'Tabela de corretoras e contas de investimento';


--
-- Name: COLUMN corretora.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.id IS 'Identificador √∫nico da corretora';


--
-- Name: COLUMN corretora.usuario_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.usuario_id IS 'ID do usu√°rio propriet√°rio';


--
-- Name: COLUMN corretora.nome; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.nome IS 'Nome da corretora/exchange (ex: XP, Clear, Binance)';


--
-- Name: COLUMN corretora.tipo; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.tipo IS 'Tipo: corretora tradicional ou exchange cripto';


--
-- Name: COLUMN corretora.pais; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.pais IS 'C√≥digo ISO 3166-1 alpha-2 do pa√≠s (BR, US, etc.)';


--
-- Name: COLUMN corretora.moeda_padrao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.moeda_padrao IS 'C√≥digo ISO 4217 da moeda (BRL, USD, EUR)';


--
-- Name: COLUMN corretora.saldo_atual; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.saldo_atual IS 'Saldo dispon√≠vel em caixa (na moeda padr√£o)';


--
-- Name: COLUMN corretora.ativa; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.ativa IS 'Indica se conta est√° ativa';


--
-- Name: COLUMN corretora.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.observacoes IS 'Observa√ß√µes e notas do usu√°rio sobre a conta';


--
-- Name: COLUMN corretora.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN corretora.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.corretora.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: evento_corporativo; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.evento_corporativo (
    id uuid NOT NULL,
    ativo_id uuid NOT NULL,
    ativo_novo_id uuid,
    tipo_evento public.tipoeventocorporativo NOT NULL,
    data_evento date NOT NULL,
    data_com date,
    proporcao character varying(20),
    descricao text NOT NULL,
    impacto_posicoes boolean NOT NULL,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT evento_data_com_valida CHECK (((data_com IS NULL) OR (data_com <= data_evento)))
);


ALTER TABLE public.evento_corporativo OWNER TO exitus;

--
-- Name: TABLE evento_corporativo; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.evento_corporativo IS 'Tabela de eventos corporativos que afetam ativos';


--
-- Name: COLUMN evento_corporativo.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.id IS 'Identificador √∫nico do evento';


--
-- Name: COLUMN evento_corporativo.ativo_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.ativo_id IS 'ID do ativo afetado pelo evento';


--
-- Name: COLUMN evento_corporativo.ativo_novo_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.ativo_novo_id IS 'ID do novo ativo (fus√µes, mudan√ßas de ticker)';


--
-- Name: COLUMN evento_corporativo.tipo_evento; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.tipo_evento IS 'Tipo do evento corporativo';


--
-- Name: COLUMN evento_corporativo.data_evento; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.data_evento IS 'Data do evento';


--
-- Name: COLUMN evento_corporativo.data_com; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.data_com IS 'Data COM (√∫ltimo dia para ter direito ao evento)';


--
-- Name: COLUMN evento_corporativo.proporcao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.proporcao IS 'Propor√ß√£o do evento (ex: ''2:1'', ''1:10'', ''1:1.5'')';


--
-- Name: COLUMN evento_corporativo.descricao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.descricao IS 'Descri√ß√£o detalhada do evento';


--
-- Name: COLUMN evento_corporativo.impacto_posicoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.impacto_posicoes IS 'Indica se as posi√ß√µes j√° foram ajustadas';


--
-- Name: COLUMN evento_corporativo.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.observacoes IS 'Observa√ß√µes adicionais sobre o evento';


--
-- Name: COLUMN evento_corporativo.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN evento_corporativo.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.evento_corporativo.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: feriado_mercado; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.feriado_mercado (
    id uuid NOT NULL,
    pais character varying(2) NOT NULL,
    mercado character varying(20),
    data_feriado date NOT NULL,
    tipo_feriado public.tipoferiado NOT NULL,
    nome character varying(200) NOT NULL,
    horario_fechamento time without time zone,
    recorrente boolean NOT NULL,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT feriado_nome_min_length CHECK ((length((nome)::text) >= 3)),
    CONSTRAINT feriado_pais_iso_format CHECK (((pais)::text ~* '^[A-Z]{2}$'::text))
);


ALTER TABLE public.feriado_mercado OWNER TO exitus;

--
-- Name: TABLE feriado_mercado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.feriado_mercado IS 'Tabela de feriados e dias sem preg√£o nos mercados';


--
-- Name: COLUMN feriado_mercado.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.id IS 'Identificador √∫nico do feriado';


--
-- Name: COLUMN feriado_mercado.pais; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.pais IS 'C√≥digo ISO do pa√≠s (BR, US, etc.)';


--
-- Name: COLUMN feriado_mercado.mercado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.mercado IS 'Mercado/bolsa espec√≠fica (B3, NYSE, NASDAQ, etc.) - NULL = todos';


--
-- Name: COLUMN feriado_mercado.data_feriado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.data_feriado IS 'Data do feriado';


--
-- Name: COLUMN feriado_mercado.tipo_feriado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.tipo_feriado IS 'Tipo do feriado';


--
-- Name: COLUMN feriado_mercado.nome; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.nome IS 'Nome do feriado';


--
-- Name: COLUMN feriado_mercado.horario_fechamento; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.horario_fechamento IS 'Hor√°rio de fechamento antecipado (se aplic√°vel)';


--
-- Name: COLUMN feriado_mercado.recorrente; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.recorrente IS 'Indica se √© feriado anual fixo (sempre no mesmo dia/m√™s)';


--
-- Name: COLUMN feriado_mercado.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.observacoes IS 'Observa√ß√µes sobre o feriado';


--
-- Name: COLUMN feriado_mercado.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN feriado_mercado.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.feriado_mercado.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: fonte_dados; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.fonte_dados (
    id uuid NOT NULL,
    nome character varying(100) NOT NULL,
    tipo_fonte public.tipofontedados NOT NULL,
    url_base character varying(500),
    requer_autenticacao boolean NOT NULL,
    rate_limit character varying(50),
    ativa boolean NOT NULL,
    prioridade integer NOT NULL,
    ultima_consulta timestamp with time zone,
    total_consultas integer NOT NULL,
    total_erros integer NOT NULL,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT fonte_consultas_positivas CHECK ((total_consultas >= 0)),
    CONSTRAINT fonte_erros_positivos CHECK ((total_erros >= 0)),
    CONSTRAINT fonte_nome_min_length CHECK ((length((nome)::text) >= 2)),
    CONSTRAINT fonte_prioridade_positiva CHECK ((prioridade > 0))
);


ALTER TABLE public.fonte_dados OWNER TO exitus;

--
-- Name: TABLE fonte_dados; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.fonte_dados IS 'Tabela de fontes de dados externas (APIs, scrapers)';


--
-- Name: COLUMN fonte_dados.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.id IS 'Identificador √∫nico da fonte';


--
-- Name: COLUMN fonte_dados.nome; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.nome IS 'Nome da fonte de dados (ex: yfinance, Alpha Vantage)';


--
-- Name: COLUMN fonte_dados.tipo_fonte; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.tipo_fonte IS 'Tipo da fonte de dados';


--
-- Name: COLUMN fonte_dados.url_base; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.url_base IS 'URL base da API ou site';


--
-- Name: COLUMN fonte_dados.requer_autenticacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.requer_autenticacao IS 'Indica se requer chave API ou autentica√ß√£o';


--
-- Name: COLUMN fonte_dados.rate_limit; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.rate_limit IS 'Limite de requisi√ß√µes (ex: ''5/minute'', ''500/day'')';


--
-- Name: COLUMN fonte_dados.ativa; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.ativa IS 'Indica se fonte est√° ativa';


--
-- Name: COLUMN fonte_dados.prioridade; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.prioridade IS 'Ordem de prioridade (1 = maior prioridade)';


--
-- Name: COLUMN fonte_dados.ultima_consulta; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.ultima_consulta IS 'Timestamp da √∫ltima consulta bem-sucedida';


--
-- Name: COLUMN fonte_dados.total_consultas; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.total_consultas IS 'Total de consultas realizadas';


--
-- Name: COLUMN fonte_dados.total_erros; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.total_erros IS 'Total de erros encontrados';


--
-- Name: COLUMN fonte_dados.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.observacoes IS 'Observa√ß√µes sobre a fonte de dados';


--
-- Name: COLUMN fonte_dados.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN fonte_dados.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.fonte_dados.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: log_auditoria; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.log_auditoria (
    id uuid NOT NULL,
    usuario_id uuid,
    acao character varying(50) NOT NULL,
    entidade character varying(100),
    entidade_id uuid,
    dados_antes json,
    dados_depois json,
    ip_address character varying(45),
    user_agent character varying(500),
    "timestamp" timestamp with time zone NOT NULL,
    sucesso boolean NOT NULL,
    mensagem text,
    CONSTRAINT log_acao_min_length CHECK ((length((acao)::text) >= 3))
);


ALTER TABLE public.log_auditoria OWNER TO exitus;

--
-- Name: TABLE log_auditoria; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.log_auditoria IS 'Tabela de logs de auditoria para compliance';


--
-- Name: COLUMN log_auditoria.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.id IS 'Identificador √∫nico do log';


--
-- Name: COLUMN log_auditoria.usuario_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.usuario_id IS 'ID do usu√°rio (NULL para a√ß√µes an√¥nimas)';


--
-- Name: COLUMN log_auditoria.acao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.acao IS 'Tipo de a√ß√£o (LOGIN, LOGOUT, CREATE, UPDATE, DELETE, VIEW, EXPORT, etc.)';


--
-- Name: COLUMN log_auditoria.entidade; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.entidade IS 'Nome da entidade afetada (Usuario, Transacao, Posicao, etc.)';


--
-- Name: COLUMN log_auditoria.entidade_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.entidade_id IS 'ID do registro afetado';


--
-- Name: COLUMN log_auditoria.dados_antes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.dados_antes IS 'Estado anterior do registro (JSON)';


--
-- Name: COLUMN log_auditoria.dados_depois; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.dados_depois IS 'Estado posterior do registro (JSON)';


--
-- Name: COLUMN log_auditoria.ip_address; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.ip_address IS 'Endere√ßo IP de origem';


--
-- Name: COLUMN log_auditoria.user_agent; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.user_agent IS 'User-Agent (navegador/cliente)';


--
-- Name: COLUMN log_auditoria."timestamp"; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria."timestamp" IS 'Data/hora da a√ß√£o';


--
-- Name: COLUMN log_auditoria.sucesso; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.sucesso IS 'Indica se a√ß√£o foi bem-sucedida';


--
-- Name: COLUMN log_auditoria.mensagem; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.log_auditoria.mensagem IS 'Mensagem de erro ou detalhes adicionais';


--
-- Name: movimentacao_caixa; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.movimentacao_caixa (
    id uuid NOT NULL,
    usuario_id uuid NOT NULL,
    corretora_id uuid NOT NULL,
    corretora_destino_id uuid,
    provento_id uuid,
    tipo_movimentacao public.tipomovimentacao NOT NULL,
    valor numeric(18,2) NOT NULL,
    moeda character varying(3) NOT NULL,
    data_movimentacao date NOT NULL,
    descricao text,
    comprovante character varying(200),
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT movimentacao_moeda_iso_format CHECK (((moeda)::text ~* '^[A-Z]{3}$'::text)),
    CONSTRAINT movimentacao_valor_positivo CHECK ((valor > (0)::numeric))
);


ALTER TABLE public.movimentacao_caixa OWNER TO exitus;

--
-- Name: TABLE movimentacao_caixa; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.movimentacao_caixa IS 'Tabela de movimenta√ß√µes de caixa em corretoras';


--
-- Name: COLUMN movimentacao_caixa.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.id IS 'Identificador √∫nico da movimenta√ß√£o';


--
-- Name: COLUMN movimentacao_caixa.usuario_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.usuario_id IS 'ID do usu√°rio';


--
-- Name: COLUMN movimentacao_caixa.corretora_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.corretora_id IS 'ID da corretora (origem)';


--
-- Name: COLUMN movimentacao_caixa.corretora_destino_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.corretora_destino_id IS 'ID da corretora destino (apenas para transfer√™ncias)';


--
-- Name: COLUMN movimentacao_caixa.provento_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.provento_id IS 'ID do provento (apenas para cr√©dito de provento)';


--
-- Name: COLUMN movimentacao_caixa.tipo_movimentacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.tipo_movimentacao IS 'Tipo da movimenta√ß√£o';


--
-- Name: COLUMN movimentacao_caixa.valor; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.valor IS 'Valor da movimenta√ß√£o';


--
-- Name: COLUMN movimentacao_caixa.moeda; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.moeda IS 'C√≥digo ISO 4217 da moeda (BRL, USD, EUR)';


--
-- Name: COLUMN movimentacao_caixa.data_movimentacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.data_movimentacao IS 'Data da movimenta√ß√£o';


--
-- Name: COLUMN movimentacao_caixa.descricao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.descricao IS 'Descri√ß√£o da movimenta√ß√£o';


--
-- Name: COLUMN movimentacao_caixa.comprovante; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.comprovante IS 'Refer√™ncia ao comprovante (n√∫mero, hash, arquivo)';


--
-- Name: COLUMN movimentacao_caixa.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN movimentacao_caixa.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.movimentacao_caixa.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: posicao; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.posicao (
    id uuid NOT NULL,
    usuario_id uuid NOT NULL,
    corretora_id uuid NOT NULL,
    ativo_id uuid NOT NULL,
    quantidade numeric(18,8) NOT NULL,
    preco_medio numeric(18,6) NOT NULL,
    custo_total numeric(18,2) NOT NULL,
    taxas_acumuladas numeric(18,2) NOT NULL,
    impostos_acumulados numeric(18,2) NOT NULL,
    valor_atual numeric(18,2),
    lucro_prejuizo_realizado numeric(18,2) NOT NULL,
    lucro_prejuizo_nao_realizado numeric(18,2),
    data_primeira_compra date,
    data_ultima_atualizacao timestamp with time zone,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT posicao_custo_total_positivo CHECK ((custo_total >= (0)::numeric)),
    CONSTRAINT posicao_impostos_positivos CHECK ((impostos_acumulados >= (0)::numeric)),
    CONSTRAINT posicao_preco_medio_positivo CHECK ((preco_medio >= (0)::numeric)),
    CONSTRAINT posicao_quantidade_positiva CHECK ((quantidade >= (0)::numeric)),
    CONSTRAINT posicao_taxas_positivas CHECK ((taxas_acumuladas >= (0)::numeric))
);


ALTER TABLE public.posicao OWNER TO exitus;

--
-- Name: TABLE posicao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.posicao IS 'Tabela de posi√ß√µes em carteira (holdings)';


--
-- Name: COLUMN posicao.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.id IS 'Identificador √∫nico da posi√ß√£o';


--
-- Name: COLUMN posicao.usuario_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.usuario_id IS 'ID do usu√°rio propriet√°rio';


--
-- Name: COLUMN posicao.corretora_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.corretora_id IS 'ID da corretora onde est√° a posi√ß√£o';


--
-- Name: COLUMN posicao.ativo_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.ativo_id IS 'ID do ativo';


--
-- Name: COLUMN posicao.quantidade; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.quantidade IS 'Quantidade de ativos (suporta fracion√°rios)';


--
-- Name: COLUMN posicao.preco_medio; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.preco_medio IS 'Pre√ßo m√©dio de aquisi√ß√£o';


--
-- Name: COLUMN posicao.custo_total; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.custo_total IS 'Custo total investido (quantidade * pre√ßo m√©dio)';


--
-- Name: COLUMN posicao.taxas_acumuladas; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.taxas_acumuladas IS 'Taxas de corretagem e cust√≥dia acumuladas';


--
-- Name: COLUMN posicao.impostos_acumulados; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.impostos_acumulados IS 'Impostos pagos acumulados (IR, IOF, etc.)';


--
-- Name: COLUMN posicao.valor_atual; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.valor_atual IS 'Valor de mercado atual da posi√ß√£o';


--
-- Name: COLUMN posicao.lucro_prejuizo_realizado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.lucro_prejuizo_realizado IS 'Lucro/preju√≠zo realizado em vendas';


--
-- Name: COLUMN posicao.lucro_prejuizo_nao_realizado; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.lucro_prejuizo_nao_realizado IS 'Lucro/preju√≠zo n√£o realizado (marca√ß√£o a mercado)';


--
-- Name: COLUMN posicao.data_primeira_compra; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.data_primeira_compra IS 'Data da primeira aquisi√ß√£o deste ativo';


--
-- Name: COLUMN posicao.data_ultima_atualizacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.data_ultima_atualizacao IS 'Data da √∫ltima atualiza√ß√£o de valores';


--
-- Name: COLUMN posicao.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN posicao.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.posicao.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: provento; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.provento (
    id uuid NOT NULL,
    ativo_id uuid NOT NULL,
    tipo_provento public.tipoprovento NOT NULL,
    valor_por_acao numeric(18,6) NOT NULL,
    quantidade_ativos numeric(18,8) NOT NULL,
    valor_bruto numeric(18,2) NOT NULL,
    imposto_retido numeric(18,2) NOT NULL,
    valor_liquido numeric(18,2) NOT NULL,
    data_com date NOT NULL,
    data_pagamento date NOT NULL,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT provento_data_pagamento_valida CHECK ((data_pagamento >= data_com)),
    CONSTRAINT provento_imposto_positivo CHECK ((imposto_retido >= (0)::numeric)),
    CONSTRAINT provento_liquido_menor_bruto CHECK ((valor_liquido <= valor_bruto)),
    CONSTRAINT provento_quantidade_positiva CHECK ((quantidade_ativos > (0)::numeric)),
    CONSTRAINT provento_valor_bruto_positivo CHECK ((valor_bruto > (0)::numeric)),
    CONSTRAINT provento_valor_liquido_positivo CHECK ((valor_liquido > (0)::numeric)),
    CONSTRAINT provento_valor_por_acao_positivo CHECK ((valor_por_acao > (0)::numeric))
);


ALTER TABLE public.provento OWNER TO exitus;

--
-- Name: TABLE provento; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.provento IS 'Tabela de proventos recebidos (dividendos, JCP, rendimentos)';


--
-- Name: COLUMN provento.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.id IS 'Identificador √∫nico do provento';


--
-- Name: COLUMN provento.ativo_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.ativo_id IS 'ID do ativo que pagou o provento';


--
-- Name: COLUMN provento.tipo_provento; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.tipo_provento IS 'Tipo do provento (dividendo, JCP, rendimento, etc.)';


--
-- Name: COLUMN provento.valor_por_acao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.valor_por_acao IS 'Valor unit√°rio por ativo';


--
-- Name: COLUMN provento.quantidade_ativos; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.quantidade_ativos IS 'Quantidade de ativos que geraram o provento';


--
-- Name: COLUMN provento.valor_bruto; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.valor_bruto IS 'Valor bruto recebido';


--
-- Name: COLUMN provento.imposto_retido; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.imposto_retido IS 'IR retido na fonte';


--
-- Name: COLUMN provento.valor_liquido; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.valor_liquido IS 'Valor l√≠quido creditado';


--
-- Name: COLUMN provento.data_com; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.data_com IS 'Data COM (√∫ltimo dia para ter direito ao provento)';


--
-- Name: COLUMN provento.data_pagamento; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.data_pagamento IS 'Data efetiva do pagamento';


--
-- Name: COLUMN provento.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.observacoes IS 'Observa√ß√µes sobre o provento';


--
-- Name: COLUMN provento.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN provento.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.provento.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: regra_fiscal; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.regra_fiscal (
    id uuid NOT NULL,
    pais character varying(2) NOT NULL,
    tipo_ativo character varying(20),
    tipo_operacao character varying(20),
    aliquota_ir numeric(6,4) NOT NULL,
    valor_isencao numeric(18,2),
    incide_sobre public.incidenciaimposto NOT NULL,
    descricao text NOT NULL,
    vigencia_inicio date NOT NULL,
    vigencia_fim date,
    ativa boolean NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT regra_aliquota_valida CHECK (((aliquota_ir >= (0)::numeric) AND (aliquota_ir <= (100)::numeric))),
    CONSTRAINT regra_isencao_positiva CHECK (((valor_isencao IS NULL) OR (valor_isencao >= (0)::numeric))),
    CONSTRAINT regra_pais_iso_format CHECK (((pais)::text ~* '^[A-Z]{2}$'::text)),
    CONSTRAINT regra_vigencia_valida CHECK (((vigencia_fim IS NULL) OR (vigencia_fim >= vigencia_inicio)))
);


ALTER TABLE public.regra_fiscal OWNER TO exitus;

--
-- Name: TABLE regra_fiscal; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.regra_fiscal IS 'Tabela de regras tribut√°rias por pa√≠s e tipo de ativo';


--
-- Name: COLUMN regra_fiscal.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.id IS 'Identificador √∫nico da regra';


--
-- Name: COLUMN regra_fiscal.pais; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.pais IS 'C√≥digo ISO do pa√≠s (BR, US, etc.)';


--
-- Name: COLUMN regra_fiscal.tipo_ativo; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.tipo_ativo IS 'Tipo de ativo (ACAO, FII, REIT, BOND, etc.) - NULL = todos';


--
-- Name: COLUMN regra_fiscal.tipo_operacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.tipo_operacao IS 'Tipo de opera√ß√£o (COMPRA, VENDA, DAY_TRADE, SWING_TRADE) - NULL = todas';


--
-- Name: COLUMN regra_fiscal.aliquota_ir; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.aliquota_ir IS 'Al√≠quota de IR em % (ex: 15.0000 = 15%)';


--
-- Name: COLUMN regra_fiscal.valor_isencao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.valor_isencao IS 'Valor de isen√ß√£o mensal (ex: R$ 20.000,00 no Brasil)';


--
-- Name: COLUMN regra_fiscal.incide_sobre; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.incide_sobre IS 'Sobre o que incide o imposto';


--
-- Name: COLUMN regra_fiscal.descricao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.descricao IS 'Descri√ß√£o detalhada da regra fiscal';


--
-- Name: COLUMN regra_fiscal.vigencia_inicio; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.vigencia_inicio IS 'Data de in√≠cio da vig√™ncia da regra';


--
-- Name: COLUMN regra_fiscal.vigencia_fim; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.vigencia_fim IS 'Data de fim da vig√™ncia (NULL = vigente indefinidamente)';


--
-- Name: COLUMN regra_fiscal.ativa; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.ativa IS 'Indica se regra est√° ativa';


--
-- Name: COLUMN regra_fiscal.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN regra_fiscal.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.regra_fiscal.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: transacao; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.transacao (
    id uuid NOT NULL,
    usuario_id uuid NOT NULL,
    corretora_id uuid NOT NULL,
    ativo_id uuid NOT NULL,
    tipo_operacao public.tipooperacao NOT NULL,
    quantidade numeric(18,8) NOT NULL,
    preco_unitario numeric(18,6) NOT NULL,
    valor_total numeric(18,2) NOT NULL,
    taxas numeric(18,2) NOT NULL,
    impostos numeric(18,2) NOT NULL,
    data_operacao date NOT NULL,
    data_liquidacao date,
    observacoes text,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL,
    CONSTRAINT transacao_data_liquidacao_valida CHECK (((data_liquidacao IS NULL) OR (data_liquidacao >= data_operacao))),
    CONSTRAINT transacao_impostos_positivos CHECK ((impostos >= (0)::numeric)),
    CONSTRAINT transacao_preco_positivo CHECK ((preco_unitario > (0)::numeric)),
    CONSTRAINT transacao_quantidade_positiva CHECK ((quantidade > (0)::numeric)),
    CONSTRAINT transacao_taxas_positivas CHECK ((taxas >= (0)::numeric)),
    CONSTRAINT transacao_valor_total_positivo CHECK ((valor_total > (0)::numeric))
);


ALTER TABLE public.transacao OWNER TO exitus;

--
-- Name: TABLE transacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON TABLE public.transacao IS 'Tabela de transa√ß√µes de compra e venda de ativos';


--
-- Name: COLUMN transacao.id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.id IS 'Identificador √∫nico da transa√ß√£o';


--
-- Name: COLUMN transacao.usuario_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.usuario_id IS 'ID do usu√°rio';


--
-- Name: COLUMN transacao.corretora_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.corretora_id IS 'ID da corretora';


--
-- Name: COLUMN transacao.ativo_id; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.ativo_id IS 'ID do ativo transacionado';


--
-- Name: COLUMN transacao.tipo_operacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.tipo_operacao IS 'Tipo de opera√ß√£o: COMPRA ou VENDA';


--
-- Name: COLUMN transacao.quantidade; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.quantidade IS 'Quantidade transacionada (suporta fracion√°rios)';


--
-- Name: COLUMN transacao.preco_unitario; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.preco_unitario IS 'Pre√ßo por unidade';


--
-- Name: COLUMN transacao.valor_total; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.valor_total IS 'Valor total da opera√ß√£o (quantidade * pre√ßo)';


--
-- Name: COLUMN transacao.taxas; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.taxas IS 'Taxas de corretagem, cust√≥dia, emolumentos';


--
-- Name: COLUMN transacao.impostos; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.impostos IS 'IR retido na fonte, IOF, etc.';


--
-- Name: COLUMN transacao.data_operacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.data_operacao IS 'Data da opera√ß√£o';


--
-- Name: COLUMN transacao.data_liquidacao; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.data_liquidacao IS 'Data de liquida√ß√£o (D+2, D+3, etc.)';


--
-- Name: COLUMN transacao.observacoes; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.observacoes IS 'Observa√ß√µes sobre a transa√ß√£o';


--
-- Name: COLUMN transacao.created_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.created_at IS 'Data de cria√ß√£o do registro';


--
-- Name: COLUMN transacao.updated_at; Type: COMMENT; Schema: public; Owner: exitus
--

COMMENT ON COLUMN public.transacao.updated_at IS 'Data da √∫ltima atualiza√ß√£o';


--
-- Name: usuario; Type: TABLE; Schema: public; Owner: exitus
--

CREATE TABLE public.usuario (
    id uuid NOT NULL,
    username character varying(50) NOT NULL,
    email character varying(120) NOT NULL,
    password_hash character varying(255) NOT NULL,
    nome_completo character varying(200),
    ativo boolean NOT NULL,
    role public.userrole NOT NULL,
    created_at timestamp with time zone NOT NULL,
    updated_at timestamp with time zone NOT NULL
);


ALTER TABLE public.usuario OWNER TO exitus;

--
-- Data for Name: alembic_version; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.alembic_version (version_num) FROM stdin;
b2542b2f7857
\.


--
-- Data for Name: ativo; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.ativo (id, ticker, nome, tipo, classe, mercado, moeda, preco_atual, data_ultima_cotacao, dividend_yield, p_l, p_vp, roe, ativo, deslistado, data_deslistagem, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: corretora; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.corretora (id, usuario_id, nome, tipo, pais, moeda_padrao, saldo_atual, ativa, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: evento_corporativo; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.evento_corporativo (id, ativo_id, ativo_novo_id, tipo_evento, data_evento, data_com, proporcao, descricao, impacto_posicoes, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: feriado_mercado; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.feriado_mercado (id, pais, mercado, data_feriado, tipo_feriado, nome, horario_fechamento, recorrente, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: fonte_dados; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.fonte_dados (id, nome, tipo_fonte, url_base, requer_autenticacao, rate_limit, ativa, prioridade, ultima_consulta, total_consultas, total_erros, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: log_auditoria; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.log_auditoria (id, usuario_id, acao, entidade, entidade_id, dados_antes, dados_depois, ip_address, user_agent, "timestamp", sucesso, mensagem) FROM stdin;
\.


--
-- Data for Name: movimentacao_caixa; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.movimentacao_caixa (id, usuario_id, corretora_id, corretora_destino_id, provento_id, tipo_movimentacao, valor, moeda, data_movimentacao, descricao, comprovante, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: posicao; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.posicao (id, usuario_id, corretora_id, ativo_id, quantidade, preco_medio, custo_total, taxas_acumuladas, impostos_acumulados, valor_atual, lucro_prejuizo_realizado, lucro_prejuizo_nao_realizado, data_primeira_compra, data_ultima_atualizacao, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: provento; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.provento (id, ativo_id, tipo_provento, valor_por_acao, quantidade_ativos, valor_bruto, imposto_retido, valor_liquido, data_com, data_pagamento, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: regra_fiscal; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.regra_fiscal (id, pais, tipo_ativo, tipo_operacao, aliquota_ir, valor_isencao, incide_sobre, descricao, vigencia_inicio, vigencia_fim, ativa, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: transacao; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.transacao (id, usuario_id, corretora_id, ativo_id, tipo_operacao, quantidade, preco_unitario, valor_total, taxas, impostos, data_operacao, data_liquidacao, observacoes, created_at, updated_at) FROM stdin;
\.


--
-- Data for Name: usuario; Type: TABLE DATA; Schema: public; Owner: exitus
--

COPY public.usuario (id, username, email, password_hash, nome_completo, ativo, role, created_at, updated_at) FROM stdin;
\.


--
-- Name: alembic_version alembic_version_pkc; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.alembic_version
    ADD CONSTRAINT alembic_version_pkc PRIMARY KEY (version_num);


--
-- Name: ativo ativo_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.ativo
    ADD CONSTRAINT ativo_pkey PRIMARY KEY (id);


--
-- Name: corretora corretora_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.corretora
    ADD CONSTRAINT corretora_pkey PRIMARY KEY (id);


--
-- Name: evento_corporativo evento_corporativo_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.evento_corporativo
    ADD CONSTRAINT evento_corporativo_pkey PRIMARY KEY (id);


--
-- Name: feriado_mercado feriado_mercado_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.feriado_mercado
    ADD CONSTRAINT feriado_mercado_pkey PRIMARY KEY (id);


--
-- Name: fonte_dados fonte_dados_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.fonte_dados
    ADD CONSTRAINT fonte_dados_pkey PRIMARY KEY (id);


--
-- Name: log_auditoria log_auditoria_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.log_auditoria
    ADD CONSTRAINT log_auditoria_pkey PRIMARY KEY (id);


--
-- Name: movimentacao_caixa movimentacao_caixa_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.movimentacao_caixa
    ADD CONSTRAINT movimentacao_caixa_pkey PRIMARY KEY (id);


--
-- Name: posicao posicao_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.posicao
    ADD CONSTRAINT posicao_pkey PRIMARY KEY (id);


--
-- Name: provento provento_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.provento
    ADD CONSTRAINT provento_pkey PRIMARY KEY (id);


--
-- Name: regra_fiscal regra_fiscal_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.regra_fiscal
    ADD CONSTRAINT regra_fiscal_pkey PRIMARY KEY (id);


--
-- Name: transacao transacao_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.transacao
    ADD CONSTRAINT transacao_pkey PRIMARY KEY (id);


--
-- Name: ativo unique_ativo_ticker_mercado; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.ativo
    ADD CONSTRAINT unique_ativo_ticker_mercado UNIQUE (ticker, mercado);


--
-- Name: corretora unique_corretora_usuario_nome_pais; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.corretora
    ADD CONSTRAINT unique_corretora_usuario_nome_pais UNIQUE (usuario_id, nome, pais);


--
-- Name: feriado_mercado unique_feriado_pais_mercado_data; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.feriado_mercado
    ADD CONSTRAINT unique_feriado_pais_mercado_data UNIQUE (pais, mercado, data_feriado);


--
-- Name: posicao unique_posicao_usuario_corretora_ativo; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.posicao
    ADD CONSTRAINT unique_posicao_usuario_corretora_ativo UNIQUE (usuario_id, corretora_id, ativo_id);


--
-- Name: usuario usuario_pkey; Type: CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.usuario
    ADD CONSTRAINT usuario_pkey PRIMARY KEY (id);


--
-- Name: ix_ativo_ativo; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_ativo ON public.ativo USING btree (ativo);


--
-- Name: ix_ativo_classe; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_classe ON public.ativo USING btree (classe);


--
-- Name: ix_ativo_data_ultima_cotacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_data_ultima_cotacao ON public.ativo USING btree (data_ultima_cotacao);


--
-- Name: ix_ativo_deslistado; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_deslistado ON public.ativo USING btree (deslistado);


--
-- Name: ix_ativo_mercado; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_mercado ON public.ativo USING btree (mercado);


--
-- Name: ix_ativo_moeda; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_moeda ON public.ativo USING btree (moeda);


--
-- Name: ix_ativo_nome; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_nome ON public.ativo USING btree (nome);


--
-- Name: ix_ativo_ticker; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_ticker ON public.ativo USING btree (ticker);


--
-- Name: ix_ativo_tipo; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_ativo_tipo ON public.ativo USING btree (tipo);


--
-- Name: ix_corretora_ativa; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_corretora_ativa ON public.corretora USING btree (ativa);


--
-- Name: ix_corretora_moeda_padrao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_corretora_moeda_padrao ON public.corretora USING btree (moeda_padrao);


--
-- Name: ix_corretora_nome; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_corretora_nome ON public.corretora USING btree (nome);


--
-- Name: ix_corretora_pais; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_corretora_pais ON public.corretora USING btree (pais);


--
-- Name: ix_corretora_tipo; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_corretora_tipo ON public.corretora USING btree (tipo);


--
-- Name: ix_corretora_usuario_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_corretora_usuario_id ON public.corretora USING btree (usuario_id);


--
-- Name: ix_evento_corporativo_ativo_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_evento_corporativo_ativo_id ON public.evento_corporativo USING btree (ativo_id);


--
-- Name: ix_evento_corporativo_ativo_novo_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_evento_corporativo_ativo_novo_id ON public.evento_corporativo USING btree (ativo_novo_id);


--
-- Name: ix_evento_corporativo_data_com; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_evento_corporativo_data_com ON public.evento_corporativo USING btree (data_com);


--
-- Name: ix_evento_corporativo_data_evento; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_evento_corporativo_data_evento ON public.evento_corporativo USING btree (data_evento);


--
-- Name: ix_evento_corporativo_impacto_posicoes; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_evento_corporativo_impacto_posicoes ON public.evento_corporativo USING btree (impacto_posicoes);


--
-- Name: ix_evento_corporativo_tipo_evento; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_evento_corporativo_tipo_evento ON public.evento_corporativo USING btree (tipo_evento);


--
-- Name: ix_feriado_mercado_data_feriado; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_feriado_mercado_data_feriado ON public.feriado_mercado USING btree (data_feriado);


--
-- Name: ix_feriado_mercado_mercado; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_feriado_mercado_mercado ON public.feriado_mercado USING btree (mercado);


--
-- Name: ix_feriado_mercado_pais; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_feriado_mercado_pais ON public.feriado_mercado USING btree (pais);


--
-- Name: ix_feriado_mercado_recorrente; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_feriado_mercado_recorrente ON public.feriado_mercado USING btree (recorrente);


--
-- Name: ix_feriado_mercado_tipo_feriado; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_feriado_mercado_tipo_feriado ON public.feriado_mercado USING btree (tipo_feriado);


--
-- Name: ix_fonte_dados_ativa; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_fonte_dados_ativa ON public.fonte_dados USING btree (ativa);


--
-- Name: ix_fonte_dados_nome; Type: INDEX; Schema: public; Owner: exitus
--

CREATE UNIQUE INDEX ix_fonte_dados_nome ON public.fonte_dados USING btree (nome);


--
-- Name: ix_fonte_dados_prioridade; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_fonte_dados_prioridade ON public.fonte_dados USING btree (prioridade);


--
-- Name: ix_fonte_dados_tipo_fonte; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_fonte_dados_tipo_fonte ON public.fonte_dados USING btree (tipo_fonte);


--
-- Name: ix_fonte_dados_ultima_consulta; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_fonte_dados_ultima_consulta ON public.fonte_dados USING btree (ultima_consulta);


--
-- Name: ix_log_auditoria_acao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_acao ON public.log_auditoria USING btree (acao);


--
-- Name: ix_log_auditoria_entidade; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_entidade ON public.log_auditoria USING btree (entidade);


--
-- Name: ix_log_auditoria_entidade_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_entidade_id ON public.log_auditoria USING btree (entidade_id);


--
-- Name: ix_log_auditoria_ip_address; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_ip_address ON public.log_auditoria USING btree (ip_address);


--
-- Name: ix_log_auditoria_sucesso; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_sucesso ON public.log_auditoria USING btree (sucesso);


--
-- Name: ix_log_auditoria_timestamp; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_timestamp ON public.log_auditoria USING btree ("timestamp");


--
-- Name: ix_log_auditoria_usuario_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_log_auditoria_usuario_id ON public.log_auditoria USING btree (usuario_id);


--
-- Name: ix_movimentacao_caixa_corretora_destino_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_corretora_destino_id ON public.movimentacao_caixa USING btree (corretora_destino_id);


--
-- Name: ix_movimentacao_caixa_corretora_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_corretora_id ON public.movimentacao_caixa USING btree (corretora_id);


--
-- Name: ix_movimentacao_caixa_data_movimentacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_data_movimentacao ON public.movimentacao_caixa USING btree (data_movimentacao);


--
-- Name: ix_movimentacao_caixa_moeda; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_moeda ON public.movimentacao_caixa USING btree (moeda);


--
-- Name: ix_movimentacao_caixa_provento_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_provento_id ON public.movimentacao_caixa USING btree (provento_id);


--
-- Name: ix_movimentacao_caixa_tipo_movimentacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_tipo_movimentacao ON public.movimentacao_caixa USING btree (tipo_movimentacao);


--
-- Name: ix_movimentacao_caixa_usuario_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_movimentacao_caixa_usuario_id ON public.movimentacao_caixa USING btree (usuario_id);


--
-- Name: ix_posicao_ativo_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_posicao_ativo_id ON public.posicao USING btree (ativo_id);


--
-- Name: ix_posicao_corretora_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_posicao_corretora_id ON public.posicao USING btree (corretora_id);


--
-- Name: ix_posicao_data_primeira_compra; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_posicao_data_primeira_compra ON public.posicao USING btree (data_primeira_compra);


--
-- Name: ix_posicao_data_ultima_atualizacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_posicao_data_ultima_atualizacao ON public.posicao USING btree (data_ultima_atualizacao);


--
-- Name: ix_posicao_usuario_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_posicao_usuario_id ON public.posicao USING btree (usuario_id);


--
-- Name: ix_provento_ativo_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_provento_ativo_id ON public.provento USING btree (ativo_id);


--
-- Name: ix_provento_data_com; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_provento_data_com ON public.provento USING btree (data_com);


--
-- Name: ix_provento_data_pagamento; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_provento_data_pagamento ON public.provento USING btree (data_pagamento);


--
-- Name: ix_provento_tipo_provento; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_provento_tipo_provento ON public.provento USING btree (tipo_provento);


--
-- Name: ix_regra_fiscal_ativa; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_ativa ON public.regra_fiscal USING btree (ativa);


--
-- Name: ix_regra_fiscal_incide_sobre; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_incide_sobre ON public.regra_fiscal USING btree (incide_sobre);


--
-- Name: ix_regra_fiscal_pais; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_pais ON public.regra_fiscal USING btree (pais);


--
-- Name: ix_regra_fiscal_tipo_ativo; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_tipo_ativo ON public.regra_fiscal USING btree (tipo_ativo);


--
-- Name: ix_regra_fiscal_tipo_operacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_tipo_operacao ON public.regra_fiscal USING btree (tipo_operacao);


--
-- Name: ix_regra_fiscal_vigencia_fim; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_vigencia_fim ON public.regra_fiscal USING btree (vigencia_fim);


--
-- Name: ix_regra_fiscal_vigencia_inicio; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_regra_fiscal_vigencia_inicio ON public.regra_fiscal USING btree (vigencia_inicio);


--
-- Name: ix_transacao_ativo_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_transacao_ativo_id ON public.transacao USING btree (ativo_id);


--
-- Name: ix_transacao_corretora_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_transacao_corretora_id ON public.transacao USING btree (corretora_id);


--
-- Name: ix_transacao_data_liquidacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_transacao_data_liquidacao ON public.transacao USING btree (data_liquidacao);


--
-- Name: ix_transacao_data_operacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_transacao_data_operacao ON public.transacao USING btree (data_operacao);


--
-- Name: ix_transacao_tipo_operacao; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_transacao_tipo_operacao ON public.transacao USING btree (tipo_operacao);


--
-- Name: ix_transacao_usuario_id; Type: INDEX; Schema: public; Owner: exitus
--

CREATE INDEX ix_transacao_usuario_id ON public.transacao USING btree (usuario_id);


--
-- Name: ix_usuario_email; Type: INDEX; Schema: public; Owner: exitus
--

CREATE UNIQUE INDEX ix_usuario_email ON public.usuario USING btree (email);


--
-- Name: ix_usuario_username; Type: INDEX; Schema: public; Owner: exitus
--

CREATE UNIQUE INDEX ix_usuario_username ON public.usuario USING btree (username);


--
-- Name: corretora corretora_usuario_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.corretora
    ADD CONSTRAINT corretora_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES public.usuario(id) ON DELETE CASCADE;


--
-- Name: evento_corporativo evento_corporativo_ativo_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.evento_corporativo
    ADD CONSTRAINT evento_corporativo_ativo_id_fkey FOREIGN KEY (ativo_id) REFERENCES public.ativo(id) ON DELETE RESTRICT;


--
-- Name: evento_corporativo evento_corporativo_ativo_novo_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.evento_corporativo
    ADD CONSTRAINT evento_corporativo_ativo_novo_id_fkey FOREIGN KEY (ativo_novo_id) REFERENCES public.ativo(id) ON DELETE SET NULL;


--
-- Name: log_auditoria log_auditoria_usuario_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.log_auditoria
    ADD CONSTRAINT log_auditoria_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES public.usuario(id) ON DELETE SET NULL;


--
-- Name: movimentacao_caixa movimentacao_caixa_corretora_destino_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.movimentacao_caixa
    ADD CONSTRAINT movimentacao_caixa_corretora_destino_id_fkey FOREIGN KEY (corretora_destino_id) REFERENCES public.corretora(id) ON DELETE SET NULL;


--
-- Name: movimentacao_caixa movimentacao_caixa_corretora_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.movimentacao_caixa
    ADD CONSTRAINT movimentacao_caixa_corretora_id_fkey FOREIGN KEY (corretora_id) REFERENCES public.corretora(id) ON DELETE CASCADE;


--
-- Name: movimentacao_caixa movimentacao_caixa_provento_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.movimentacao_caixa
    ADD CONSTRAINT movimentacao_caixa_provento_id_fkey FOREIGN KEY (provento_id) REFERENCES public.provento(id) ON DELETE SET NULL;


--
-- Name: movimentacao_caixa movimentacao_caixa_usuario_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.movimentacao_caixa
    ADD CONSTRAINT movimentacao_caixa_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES public.usuario(id) ON DELETE CASCADE;


--
-- Name: posicao posicao_ativo_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.posicao
    ADD CONSTRAINT posicao_ativo_id_fkey FOREIGN KEY (ativo_id) REFERENCES public.ativo(id) ON DELETE RESTRICT;


--
-- Name: posicao posicao_corretora_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.posicao
    ADD CONSTRAINT posicao_corretora_id_fkey FOREIGN KEY (corretora_id) REFERENCES public.corretora(id) ON DELETE CASCADE;


--
-- Name: posicao posicao_usuario_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.posicao
    ADD CONSTRAINT posicao_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES public.usuario(id) ON DELETE CASCADE;


--
-- Name: provento provento_ativo_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.provento
    ADD CONSTRAINT provento_ativo_id_fkey FOREIGN KEY (ativo_id) REFERENCES public.ativo(id) ON DELETE RESTRICT;


--
-- Name: transacao transacao_ativo_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.transacao
    ADD CONSTRAINT transacao_ativo_id_fkey FOREIGN KEY (ativo_id) REFERENCES public.ativo(id) ON DELETE RESTRICT;


--
-- Name: transacao transacao_corretora_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.transacao
    ADD CONSTRAINT transacao_corretora_id_fkey FOREIGN KEY (corretora_id) REFERENCES public.corretora(id) ON DELETE CASCADE;


--
-- Name: transacao transacao_usuario_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: exitus
--

ALTER TABLE ONLY public.transacao
    ADD CONSTRAINT transacao_usuario_id_fkey FOREIGN KEY (usuario_id) REFERENCES public.usuario(id) ON DELETE CASCADE;


--
-- PostgreSQL database dump complete
--

\unrestrict GKPkJ0HUazHhGWoZucB0W175i385M8gluav75q4QDk791AqK2yfWUeOUdV3G2s9


====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/concatenate_git_files.sh ---
#!/bin/bash

# Nome do arquivo de sa√≠da
OUTPUT_FILE="all_git_files_concatenated.txt"

# Separador visual entre os arquivos
SEPARATOR="===================================================="

# Verifica se estamos em um reposit√≥rio Git
if ! git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
    echo "Erro: Este n√£o √© um diret√≥rio de trabalho Git."
    exit 1
fi

# Inicia o arquivo de sa√≠da (cria ou limpa)
> "$OUTPUT_FILE"

echo "Iniciando a concatena√ß√£o dos arquivos rastreados pelo Git em: $OUTPUT_FILE"
echo "$SEPARATOR" >> "$OUTPUT_FILE"

# Usa 'git ls-files' para obter a lista de arquivos rastreados
# O argumento -z (null-termination) e o 'xargs -0' s√£o usados para lidar corretamente
# com nomes de arquivos que contenham espa√ßos ou outros caracteres especiais.
git ls-files -z | while IFS= read -r -d $'\0' FILE_PATH; do
    # Verifica se o arquivo existe e √© regular (para evitar links simb√≥licos ou diret√≥rios, embora o git ls-files j√° ajude)
    if [ -f "$FILE_PATH" ]; then
        echo "Adicionando: $FILE_PATH"
        
        # Escreve o caminho completo do arquivo no arquivo de sa√≠da
        echo "--- ARQUIVO: $(pwd)/$FILE_PATH ---" >> "$OUTPUT_FILE"
        
        # Concatena o conte√∫do do arquivo
        cat "$FILE_PATH" >> "$OUTPUT_FILE"
        
        # Adiciona o separador
        echo -e "\n$SEPARATOR\n" >> "$OUTPUT_FILE"
    else
        echo "Aviso: Ignorando caminho n√£o-arquivo ou inexistente: $FILE_PATH"
    fi
done

echo "Conclu√≠do! Todos os arquivos rastreados foram concatenados em $OUTPUT_FILE."

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/docs/modulo0_ambiente.md ---

# Exitus - M√≥dulo 0: Prepara√ß√£o do Ambiente (Podman)

## Introdu√ß√£o

Este documento detalha o passo a passo para a prepara√ß√£o do ambiente computacional do Sistema Exitus, iniciando pela cria√ß√£o da estrutura de projeto, configura√ß√£o de vari√°veis de ambiente em estilo produ√ß√£o (.env), instala√ß√£o do Podman, configura√ß√£o de rede e volumes, build das imagens, cria√ß√£o dos containers e testes de comunica√ß√£o para a arquitetura proposta: PostgreSQL (DB), Flask Backend (API) e Flask Frontend (UI).

O pr√≥prio conte√∫do deste arquivo deve ser salvo em `exitus/docs/docs_modulo0.md` e servir√° como documenta√ß√£o oficial do M√≥dulo 0.

## 1. Estrutura do Projeto

Crie o diret√≥rio raiz e a estrutura base do projeto:

```bash
mkdir -p exitus/{docs,scripts,backend,frontend,tests,backups}
cd exitus
```

### Estrutura de Diret√≥rios

```text
exitus/
‚îú‚îÄ‚îÄ README.md                    # Introdu√ß√£o ao sistema e links para m√≥dulos
‚îú‚îÄ‚îÄ docs/                        # Documenta√ß√£o modular
‚îÇ   ‚îú‚îÄ‚îÄ docs_modulo0.md          # Este documento (M√≥dulo 0)
‚îÇ   ‚îú‚îÄ‚îÄ docs_modulo1.md          # Ser√° criado no M√≥dulo 1
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îú‚îÄ‚îÄ scripts/                     # Scripts de gerenciamento e automa√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ setup_env.sh            # Sele√ß√£o de ambiente (dev/staging/prod)
‚îÇ   ‚îú‚îÄ‚îÄ setup_containers.sh     # Configura√ß√£o inicial dos containers
‚îÇ   ‚îú‚îÄ‚îÄ start_services.sh       # Iniciar todos os servi√ßos
‚îÇ   ‚îú‚îÄ‚îÄ stop_services.sh        # Parar todos os servi√ßos
‚îÇ   ‚îú‚îÄ‚îÄ backup_db.sh            # Backup do banco de dados
‚îÇ   ‚îî‚îÄ‚îÄ cleanup_containers.sh   # Limpeza de containers e recursos
‚îú‚îÄ‚îÄ backend/                     # C√≥digo do Backend Flask
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes/             # (ser√° detalhado em m√≥dulos futuros)
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îú‚îÄ‚îÄ .env.development.example
‚îÇ   ‚îú‚îÄ‚îÄ .env.staging.example
‚îÇ   ‚îú‚îÄ‚îÄ .env.production.example
‚îÇ   ‚îî‚îÄ‚îÄ run.py
‚îú‚îÄ‚îÄ frontend/                    # C√≥digo do Frontend Flask
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/             # (ser√° detalhado em m√≥dulos futuros)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ static/
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile
‚îÇ   ‚îú‚îÄ‚îÄ .env.example
‚îÇ   ‚îú‚îÄ‚îÄ .env.development.example
‚îÇ   ‚îú‚îÄ‚îÄ .env.staging.example
‚îÇ   ‚îú‚îÄ‚îÄ .env.production.example
‚îÇ   ‚îî‚îÄ‚îÄ run.py
‚îú‚îÄ‚îÄ tests/                       # Testes automatizados
‚îÇ   ‚îú‚îÄ‚îÄ test_backend.py
‚îÇ   ‚îî‚îÄ‚îÄ test_frontend.py
‚îî‚îÄ‚îÄ backups/                     # Backups do banco de dados
```

### README.md Principal

Crie o arquivo `exitus/README.md` com vis√£o geral do sistema e links para os m√≥dulos:

```markdown
-----

## üèóÔ∏è Arquitetura T√©cnica

Para m√°xima portabilidade e desempenho, o **Exitus** adota uma arquitetura em cont√™ineres:

| Componente | Tecnologia Principal | Descri√ß√£o/Detalhes |
| :--- | :--- | :--- |
| **Banco de Dados** | **PostgreSQL 15** | Armazenamento robusto e transacional (em container Podman). |
| **Backend** | **Flask + SQLAlchemy** | APIs RESTful de alto desempenho para l√≥gica de neg√≥cios (em container Podman). |
| **Frontend** | **Flask + HTMX + Alpine.js** | Interface de usu√°rio moderna, leve e reativa (em container Podman). |
| **Infraestrutura** | **Ubuntu + Podman** | Sistema operacional base e runtime de cont√™ineres. |

-----

## üõ†Ô∏è Tecnologias Chave

  * üêç **Python 3.11+** (Linguagem de Backend)
  * üåê **Flask 3.x** (Framework Web)
  * üíæ **PostgreSQL 15** (Base de Dados)
  * ‚öôÔ∏è **SQLAlchemy 2.x** (ORM)
  * üê≥ **Podman** (Containeriza√ß√£o)
  * ‚ú® **HTMX, Alpine.js** (Interatividade de Frontend)

-----

## üìö Documenta√ß√£o Detalhada dos M√≥dulos

Nossa documenta√ß√£o est√° organizada para guiar voc√™ desde a configura√ß√£o inicial at√© o deploy:

## Documenta√ß√£o dos M√≥dulos

- [M√≥dulo 0: Prepara√ß√£o do Ambiente](docs/modulo0_ambiente.md)
- [M√≥dulo 1: Estrutura do Banco de Dados](docs/modulo1_database.md)
- [M√≥dulo 2: Backend - Autentica√ß√£o e Usu√°rios](docs/modulo2_backend_auth.md)
- [M√≥dulo 3: Backend - Gest√£o de Ativos](docs/modulo3_backend_financeiro.md)
- [M√≥dulo 4: Backend - Transa√ß√µes e Portf√≥lio](docs/modulo4_backend_integracoes.md)
- [M√≥dulo 5: Backend - APIs de Integra√ß√£o](docs/modulo5_frontend_base.md)
- [M√≥dulo 6: Frontend - Interface do Usu√°rio](docs/modulo6_frontend_dashboards.md)
- [M√≥dulo 7: Testes e Valida√ß√£o](docs/modulo7_relatorios.md)
- [M√≥dulo 8: Deploy e Monitoramento](docs/modulo8_deploy.md)

-----

## ‚ñ∂Ô∏è Guia de In√≠cio R√°pido (Quick Start)

1.  **Configura√ß√£o do Ambiente** (Veja o [M√≥dulo 0]((docs/modulo0_ambiente.md)):
    ```bash
    ./scripts/setup_containers.sh
    ```
2.  **Iniciar Servi√ßos:**
    ```bash
    ./scripts/start_services.sh
    ```
3.  **Acessar a Aplica√ß√£o:**
      * **Frontend (Interface Web):** `http://localhost:8080`
      * **Backend (API RESTful):** `http://localhost:5000`
```

## 2. Cria√ß√£o da Estrutura Backend

### 2.1 Criar Estrutura de Diret√≥rios

```bash
mkdir -p backend/app/routes
mkdir -p backend/logs
```

### 2.2 backend/requirements.txt

Crie o arquivo `backend/requirements.txt`:

```text
Flask==3.0.0
Flask-SQLAlchemy==3.1.1
Flask-Migrate==4.0.5
Flask-CORS==4.0.0
psycopg2-binary==2.9.9
python-dotenv==1.0.0
requests==2.31.0
pytest==7.4.3
gunicorn==21.2.0
```

### 2.3 backend/.env.example (template base)

Crie o arquivo `backend/.env.example`:

```bash
# Database Configuration
POSTGRES_HOST=exitus-db
POSTGRES_USER=exitus
POSTGRES_PASSWORD=exitus123
POSTGRES_DB=exitusdb
POSTGRES_PORT=5432

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo
```

Opcionalmente, crie varia√ß√µes espec√≠ficas por ambiente apenas como exemplos (staging/production):

```bash
cp backend/.env.example backend/.env.development.example
cp backend/.env.example backend/.env.staging.example
cp backend/.env.example backend/.env.production.example
```

### 2.4 backend/run.py

Crie o arquivo `backend/run.py`:

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Exitus Backend - Entry Point"""

from app import create_app
import os

app = create_app()

if __name__ == '__main__':
    port = int(os.getenv('FLASK_PORT', 5000))
    app.run(host='0.0.0.0', port=port, debug=(os.getenv('FLASK_ENV') == 'development'))
```

### 2.5 backend/app/config.py

Crie o arquivo `backend/app/config.py` para carregar vari√°veis de ambiente em estilo produ√ß√£o:

```python
# -*- coding: utf-8 -*-
"""Exitus Backend - Configuration"""

import os
from dotenv import load_dotenv

# Carrega .env se existir
load_dotenv()

class Config:
    """Configura√ß√µes da aplica√ß√£o"""

    # Database
    POSTGRES_HOST = os.getenv('POSTGRES_HOST', 'localhost')
    POSTGRES_USER = os.getenv('POSTGRES_USER', 'exitus')
    POSTGRES_PASSWORD = os.getenv('POSTGRES_PASSWORD', 'exitus123')
    POSTGRES_DB = os.getenv('POSTGRES_DB', 'exitusdb')
    POSTGRES_PORT = os.getenv('POSTGRES_PORT', '5432')

    # Flask
    SECRET_KEY = os.getenv('SECRET_KEY', 'dev-secret-key-change-in-production')
    FLASK_ENV = os.getenv('FLASK_ENV', 'development')

    # SQLAlchemy
    SQLALCHEMY_DATABASE_URI = (
        f"postgresql://{POSTGRES_USER}:{POSTGRES_PASSWORD}@"
        f"{POSTGRES_HOST}:{POSTGRES_PORT}/{POSTGRES_DB}"
    )
    SQLALCHEMY_TRACK_MODIFICATIONS = False
```

### 2.6 backend/app/\_\_init\_\_.py

Crie/atualize o arquivo `backend/app/__init__.py`:

```python
# -*- coding: utf-8 -*-
"""Exitus Backend - Application Factory"""

from flask import Flask
from flask_cors import CORS
from .config import Config


def create_app():
    """Cria e configura a aplica√ß√£o Flask"""
    app = Flask(__name__)

    # Carrega configura√ß√µes
    app.config.from_object(Config)

    # Habilita CORS
    CORS(app)

    # Health check route
    @app.route('/health')
    def health():
        return {
            'status': 'ok',
            'service': 'exitus-backend',
            'env': app.config.get('FLASK_ENV', 'unknown')
        }, 200

    return app
```

### 2.7 backend/Dockerfile

Atualize ou crie o arquivo `backend/Dockerfile` com boas pr√°ticas de produ√ß√£o (imagem slim, depend√™ncias m√≠nimas e ferramentas de diagn√≥stico):

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# Instala depend√™ncias do sistema (incluindo ping e curl para diagn√≥stico)
RUN apt-get update && apt-get install -y     gcc     postgresql-client     iputils-ping     curl     && rm -rf /var/lib/apt/lists/*

# Copia e instala depend√™ncias Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copia c√≥digo da aplica√ß√£o
COPY . .

# Se n√£o existir .env dentro da imagem, cria a partir do exemplo (√∫til para dev)
RUN if [ ! -f .env ]; then cp .env.example .env; fi

# Exp√µe porta
EXPOSE 5000

# Comando anterior
# CMD ["python", "run.py"]

# Novo comando
CMD ["gunicorn", "-b", "0.0.0.0:5000", "run:app", "--reload"]
```

## 3. Cria√ß√£o da Estrutura Frontend

### 3.1 Criar Estrutura de Diret√≥rios

```bash
mkdir -p frontend/app/{routes,templates,static/{css,js}}
mkdir -p frontend/logs
```

### 3.2 frontend/requirements.txt

Crie o arquivo `frontend/requirements.txt`:

```text
Flask==3.0.0
requests==2.31.0
python-dotenv==1.0.0
pytest==7.4.3
gunicorn==21.2.0
```

### 3.3 frontend/.env.example

Crie o arquivo `frontend/.env.example`:

```bash
# Backend API Configuration
BACKEND_API_URL=http://exitus-backend:5000

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo
```

Opcionalmente, crie varia√ß√µes por ambiente (apenas templates):

```bash
cp frontend/.env.example frontend/.env.development.example
cp frontend/.env.example frontend/.env.staging.example
cp frontend/.env.example frontend/.env.production.example
```

### 3.4 frontend/run.py

Crie o arquivo `frontend/run.py`:

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Exitus Frontend - Entry Point"""

from app import create_app
import os

app = create_app()

if __name__ == '__main__':
    port = int(os.getenv('FLASK_PORT', 8080))
    app.run(host='0.0.0.0', port=port, debug=(os.getenv('FLASK_ENV') == 'development'))
```

### 3.5 frontend/app/config.py

Crie o arquivo `frontend/app/config.py`:

```python
# -*- coding: utf-8 -*-
"""Exitus Frontend - Configuration"""

import os
from dotenv import load_dotenv

load_dotenv()


class Config:
    """Configura√ß√µes da aplica√ß√£o"""

    BACKEND_API_URL = os.getenv('BACKEND_API_URL', 'http://localhost:5000')
    SECRET_KEY = os.getenv('SECRET_KEY', 'dev-secret-key-change-in-production')
    FLASK_ENV = os.getenv('FLASK_ENV', 'development')
```

### 3.6 frontend/app/\_\_init\_\_.py

Crie/atualize o arquivo `frontend/app/__init__.py`:

```python
# -*- coding: utf-8 -*-
"""Exitus Frontend - Application Factory"""

from flask import Flask, render_template_string
from .config import Config


def create_app():
    """Cria e configura a aplica√ß√£o Flask"""
    app = Flask(__name__)

    # Carrega configura√ß√µes
    app.config.from_object(Config)

    # Rota inicial simples (ser√° substitu√≠da em m√≥dulos futuros)
    @app.route('/')
    def index():
        html = """
        <!DOCTYPE html>
        <html>
        <head>
            <title>Exitus - Sistema de Investimentos</title>
        </head>
        <body>
            <h1>Exitus - Sistema de Controle e An√°lise de Investimentos</h1>
            <p>Frontend funcionando corretamente!</p>
        </body>
        </html>
        """
        return render_template_string(html)

    # Health check
    @app.route('/health')
    def health():
        return {
            'status': 'ok',
            'service': 'exitus-frontend',
            'env': app.config.get('FLASK_ENV', 'unknown')
        }, 200

    return app
```

### 3.7 frontend/Dockerfile

Atualize ou crie o arquivo `frontend/Dockerfile`:

```dockerfile
FROM python:3.11-slim

WORKDIR /app

# Instala ferramentas √∫teis de diagn√≥stico
RUN apt-get update && apt-get install -y     curl     && rm -rf /var/lib/apt/lists/*

# Copia e instala depend√™ncias Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copia c√≥digo da aplica√ß√£o
COPY . .

# Se n√£o existir .env dentro da imagem, cria a partir do exemplo (√∫til para dev)
RUN if [ ! -f .env ]; then cp .env.example .env; fi

# Exp√µe porta
EXPOSE 8080

# Comando anterior
# CMD ["python", "run.py"]

# Novo comando
CMD ["gunicorn", "-b", "0.0.0.0:8080", "run:app", "--reload"]

```

## 4. Instala√ß√£o do Podman (Ubuntu)

No host Ubuntu, instale e prepare o Podman para uso rootless:

```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y podman

# Verificar instala√ß√£o
podman --version

# Configurar subuid/subgid para rootless (se ainda n√£o configurado)
echo "$USER:100000:65536" | sudo tee -a /etc/subuid
echo "$USER:100000:65536" | sudo tee -a /etc/subgid
```

## 5. Network e Volumes

Crie a rede dedicada e volumes persistentes (pode ser feito manualmente ou pelo script):

```bash
# Network
podman network create exitus-net

# Volumes
podman volume create exitus-pgdata
podman volume create exitus-backend-logs
podman volume create exitus-frontend-logs
```

## 6. Build das Imagens

Em ambiente de desenvolvimento, o build ser√° automatizado pelo script `scripts/setup_containers.sh`, mas os comandos manuais s√£o:

```bash
# Backend
cd backend
podman build -t exitus-backend:latest .
cd ..

# Frontend
cd frontend
podman build -t exitus-frontend:latest .
cd ..
```

## 7. Scripts de Ambiente e Containers

### 7.1 scripts/setup_env.sh

Crie o arquivo `scripts/setup_env.sh` para selecionar o ambiente (development/staging/production):

```bash
#!/bin/bash
# Configura ambiente (development, staging, production)

ENV=${1:-development}

echo "Configurando ambiente: $ENV"

case $ENV in
  development)
    echo "Usando configura√ß√µes de desenvolvimento..."
    cp backend/.env.example backend/.env
    cp frontend/.env.example frontend/.env
    ;;

  staging)
    echo "Usando configura√ß√µes de staging..."
    if [ -f backend/.env.staging ]; then
      cp backend/.env.staging backend/.env
    else
      echo "ERRO: backend/.env.staging n√£o encontrado"; exit 1
    fi
    if [ -f frontend/.env.staging ]; then
      cp frontend/.env.staging frontend/.env
    else
      echo "ERRO: frontend/.env.staging n√£o encontrado"; exit 1
    fi
    ;;

  production)
    echo "Usando configura√ß√µes de produ√ß√£o..."
    if [ -f backend/.env.production ]; then
      cp backend/.env.production backend/.env
    else
      echo "ERRO: backend/.env.production n√£o encontrado"; exit 1
    fi
    if [ -f frontend/.env.production ]; then
      cp frontend/.env.production frontend/.env
    else
      echo "ERRO: frontend/.env.production n√£o encontrado"; exit 1
    fi
    ;;

  *)
    echo "Ambiente inv√°lido. Use: development, staging ou production"; exit 1;;
esac

echo "Ambiente $ENV configurado com sucesso!"
```

Torne execut√°vel:

```bash
chmod +x scripts/setup_env.sh
```

### 7.2 scripts/setup_containers.sh

Atualize `scripts/setup_containers.sh` para operar de forma idempotente e usar `.env`:

```bash
#!/bin/bash
# Configura√ß√£o inicial dos containers do Exitus

set -e

# Remover containers existentes
echo "Removendo containers antigos (se existirem)..."
podman stop exitus-db  2>/dev/null || true
podman stop exitus-backend 2>/dev/null || true
podman stop exitus-frontend 2>/dev/null || true

podman rm exitus-db 2>/dev/null || true
podman rm exitus-backend 2>/dev/null || true
podman rm exitus-frontend 2>/dev/null || true
pkill -9 containers-rootlessport || true

echo "=== Setup Exitus - M√≥dulo 0 ==="

# Criar network
echo "Criando network..."
podman network create exitus-net 2>/dev/null || echo "Network j√° existe"

# Criar volumes
echo "Criando volumes..."
podman volume create exitus-pgdata 2>/dev/null || echo "Volume pgdata j√° existe"
podman volume create exitus-backend-logs 2>/dev/null || echo "Volume backend-logs j√° existe"
podman volume create exitus-frontend-logs 2>/dev/null || echo "Volume frontend-logs j√° existe"

# Criar arquivos .env a partir dos exemplos (se n√£o existirem)
echo "Criando arquivos .env..."
if [ ! -f backend/.env ]; then
    cp backend/.env.example backend/.env
    echo "‚úì backend/.env criado a partir do .env.example"
else
    echo "‚úì backend/.env j√° existe"
fi

if [ ! -f frontend/.env ]; then
    cp frontend/.env.example frontend/.env
    echo "‚úì frontend/.env criado a partir do .env.example"
else
    echo "‚úì frontend/.env j√° existe"
fi

# Build das imagens
echo "Building backend image..."
cd backend
podman build -t exitus-backend:latest .
cd ..

echo "Building frontend image..."
cd frontend
podman build -t exitus-frontend:latest .
cd ..

# Criar container PostgreSQL
echo "Criando container PostgreSQL..."
podman run -d --name exitus-db   --network exitus-net   -v exitus-pgdata:/var/lib/postgresql/data   -e POSTGRES_USER=exitus   -e POSTGRES_PASSWORD=exitus123   -e POSTGRES_DB=exitusdb   -e TZ=America/Sao_Paulo   docker.io/postgres:15

echo "Aguardando PostgreSQL inicializar..."
sleep 10

# Criar container Backend (usando .env)
echo "Criando container Backend..."
podman run -d --name exitus-backend   --network exitus-net   -p 5000:5000   -v ./backend:/app:Z   -v exitus-backend-logs:/app/logs:Z   --env-file ./backend/.env   exitus-backend:latest

# Criar container Frontend (usando .env)
echo "Criando container Frontend..."
podman run -d --name exitus-frontend   --network exitus-net   -p 8080:8080   -v ./frontend:/app:Z   -v exitus-frontend-logs:/app/logs:Z   --env-file ./frontend/.env   exitus-frontend:latest

echo ""
echo "=== Setup conclu√≠do! ==="
echo "Backend: http://localhost:5000"
echo "Frontend: http://localhost:8080"
echo ""
podman ps
```

### 7.3 scripts/start_services.sh

```bash
#!/bin/bash
# Inicia todos os servi√ßos do Exitus

echo "Iniciando servi√ßos Exitus..."

podman start exitus-db || true
echo "PostgreSQL iniciado"
sleep 5

podman start exitus-backend || true
echo "Backend iniciado"

podman start exitus-frontend || true
echo "Frontend iniciado"

echo ""
echo "=== Servi√ßos iniciados! ==="
echo "Backend: http://localhost:5000"
echo "Frontend: http://localhost:8080"
echo ""
podman ps
```

### 7.4 scripts/stop_services.sh

```bash
#!/bin/bash
# Para todos os servi√ßos do Exitus

echo "Parando servi√ßos Exitus..."

podman stop exitus-frontend exitus-backend exitus-db 2>/dev/null || true

echo "=== Servi√ßos parados! ==="
```

### 7.5 scripts/cleanup_containers.sh

```bash
#!/bin/bash
# Remove todos os containers do Exitus

echo "=== Cleanup Exitus ==="

echo "Parando containers..."
podman stop exitus-frontend exitus-backend exitus-db 2>/dev/null || true

echo "Removendo containers..."
podman rm exitus-frontend exitus-backend exitus-db 2>/dev/null || true

echo "Containers removidos!"

echo "Para remover tamb√©m volumes e network, execute manualmente (cuidado!):"
echo "  podman volume rm exitus-pgdata exitus-backend-logs exitus-frontend-logs"
echo "  podman network rm exitus-net"
```

### 7.6 scripts/backup_db.sh

```bash
#!/bin/bash
# Backup do banco de dados PostgreSQL

BACKUP_DIR="./backups"
mkdir -p "$BACKUP_DIR"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

echo "Criando backup do banco de dados..."

podman exec exitus-db pg_dump -U exitus exitusdb > "$BACKUP_DIR/exitusdb_$TIMESTAMP.sql"

echo "Backup criado: $BACKUP_DIR/exitusdb_$TIMESTAMP.sql"
```

Torne todos os scripts execut√°veis:

```bash
chmod +x scripts/*.sh
```

## 8. Testes de Comunica√ß√£o e Sa√∫de

### 8.1 Testes a partir do host

```bash
# Backend health
curl http://localhost:5000/health

# Frontend health
curl http://localhost:8080/health
```

### 8.2 Testes dentro dos containers

```bash
# Frontend ‚Üí Backend (via curl)
podman exec exitus-frontend curl http://exitus-backend:5000/health

# Backend ‚Üí Database (TCP via Python)
podman exec exitus-backend python -c "import socket; socket.create_connection(('exitus-db', 5432), timeout=5); print('Conexao OK com PostgreSQL')"

# Database respondendo
podman exec exitus-db psql -U exitus -d exitusdb -c "SELECT 'PostgreSQL OK' as status;"
```

### 8.3 Verifica√ß√£o de logs e status

```bash
# Status dos containers
podman ps

# Logs
podman logs exitus-db --tail 50
podman logs exitus-backend --tail 50
podman logs exitus-frontend --tail 50
```

## 9. Boas Pr√°ticas

### .gitignore

Crie o arquivo `exitus/.gitignore` para evitar versionar artefatos sens√≠veis ou gerados:

```gitignore
# Python
__pycache__/
*.py[cod]
*.pyo
*.pyd
*.env
.env
.env.*
!.env.example    # Permite apenas .env.example
instance/
db.sqlite3
# logs
logs/
*.log
# Docker
*.pid
*.db
backups/

# IDEs/editors
.vscode/
.idea/
*.swp

# Test files
*.coverage
htmlcov/
.tox/
*.cache
pytest_cache/
.mypy_cache/
coverage.xml

# Container artifacts
exitus-backend/
exitus-frontend/
exitus-db/

# OS files
.DS_Store
Thumbs.db
```

### 9.2 Template dotenv.

Segue exemplo de uso dos dotenv para prepara√ß√£o do ambiente.

```bash
# Desenvolvimento (padr√£o)
./scripts/setup_env.sh development
./scripts/setup_containers.sh

# Staging
./scripts/setup_env.sh staging
./scripts/setup_containers.sh

# Produ√ß√£o
./scripts/setup_env.sh production
./scripts/setup_containers.sh
```

## 10. Documenta√ß√£o do M√≥dulo

Este documento deve ser salvo como `exitus/docs/docs_modulo0.md` e ter√° as seguintes finalidades:

- Refer√™ncia oficial para recria√ß√£o do ambiente de desenvolvimento e homologa√ß√£o.
- Base para onboarding de novos desenvolvedores no projeto Exitus.
- Guia de troubleshooting inicial envolvendo containers, rede, volumes e vari√°veis de ambiente.
- Ponto de partida para ajustes espec√≠ficos de ambientes (staging/production) em m√≥dulos posteriores.

Ap√≥s concluir todos os passos deste m√≥dulo e validar os testes de comunica√ß√£o, prossiga para o **M√≥dulo 1**, que tratar√° da modelagem e implementa√ß√£o da estrutura de banco de dados PostgreSQL do sistema Exitus.

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/.env.development.example ---
# Backend API URL
BACKEND_API_URL=http://exitus-backend:5000

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/.env.example ---
# Backend API URL
BACKEND_API_URL=http://exitus-backend:5000

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/.env.production.example ---
# Backend API URL
BACKEND_API_URL=http://exitus-backend:5000

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/.env.staging.example ---
# Backend API URL
BACKEND_API_URL=http://exitus-backend:5000

# Flask Configuration
FLASK_APP=run.py
FLASK_ENV=development
SECRET_KEY=change-me-in-env

# Timezone
TZ=America/Sao_Paulo

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/Dockerfile ---
FROM python:3.11-slim

WORKDIR /app

# Instala ferramentas √∫teis de diagn√≥stico
RUN apt-get update && apt-get install -y     curl     && rm -rf /var/lib/apt/lists/*

# Copia e instala depend√™ncias Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copia c√≥digo da aplica√ß√£o
COPY . .

# Se n√£o existir .env dentro da imagem, cria a partir do exemplo (√∫til para dev)
RUN if [ ! -f .env ]; then cp .env.example .env; fi

# Exp√µe porta
EXPOSE 8080

# Comando anterior
# CMD ["python", "run.py"]

# Novo comando
CMD ["gunicorn", "-b", "0.0.0.0:8080", "run:app", "--reload"]


====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/app/__init__.py ---
# -*- coding: utf-8 -*-
"""Exitus Frontend - Application Factory"""

from flask import Flask, render_template_string
from .config import Config


def create_app():
    """Cria e configura a aplica√ß√£o Flask"""
    app = Flask(__name__)

    # Carrega configura√ß√µes
    app.config.from_object(Config)

    # Rota inicial simples (ser√° substitu√≠da em m√≥dulos futuros)
    @app.route('/')
    def index():
        html = """
        <!DOCTYPE html>
        <html>
        <head>
            <title>Exitus - Sistema de Investimentos</title>
        </head>
        <body>
            <h1>Exitus - Sistema de Controle e An√°lise de Investimentos</h1>
            <p>Frontend funcionando corretamente!</p>
        </body>
        </html>
        """
        return render_template_string(html)

    # Health check
    @app.route('/health')
    def health():
        return {
            'status': 'ok',
            'service': 'exitus-frontend',
            'env': app.config.get('FLASK_ENV', 'unknown')
        }, 200

    return app

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/app/config.py ---
# -*- coding: utf-8 -*-
"""Exitus Frontend - Configuration"""

import os
from dotenv import load_dotenv

load_dotenv()


class Config:
    """Configura√ß√µes da aplica√ß√£o"""

    BACKEND_API_URL = os.getenv('BACKEND_API_URL', 'http://localhost:5000')
    SECRET_KEY = os.getenv('SECRET_KEY', 'dev-secret-key-change-in-production')
    FLASK_ENV = os.getenv('FLASK_ENV', 'development')

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/requirements.txt ---
Flask==3.0.0
requests==2.31.0
python-dotenv==1.0.0
pytest==7.4.3
gunicorn==21.2.0

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/frontend/run.py ---
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""Exitus Frontend - Entry Point"""

from app import create_app
import os

app = create_app()

if __name__ == '__main__':
    port = int(os.getenv('FLASK_PORT', 8080))
    app.run(host='0.0.0.0', port=port, debug=(os.getenv('FLASK_ENV') == 'development'))

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/scripts/backup_db.sh ---
#!/bin/bash
# Backup do banco de dados PostgreSQL

BACKUP_DIR="./backups"
mkdir -p "$BACKUP_DIR"
TIMESTAMP=$(date +%Y%m%d_%H%M%S)

echo "Criando backup do banco de dados..."

podman exec exitus-db pg_dump -U exitus exitusdb > "$BACKUP_DIR/exitusdb_$TIMESTAMP.sql"

echo "Backup criado: $BACKUP_DIR/exitusdb_$TIMESTAMP.sql"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/scripts/cleanup_containers.sh ---
#!/bin/bash
# Remove todos os containers, volumes do Exitus E mata processos √≥rf√£os na porta 5000

echo "=== Cleanup Exitus ==="

# --- 1. Limpeza de Cont√™ineres ---

echo "Parando containers..."
podman stop exitus-frontend 2>/dev/null || true
podman stop exitus-backend 2>/dev/null || true
podman stop exitus-db 2>/dev/null || true

echo "Removendo containers..."
podman rm exitus-frontend 2>/dev/null || true
podman rm exitus-backend 2>/dev/null || true
podman rm exitus-db 2>/dev/null || true

pkill -9 containers-rootlessport || true

echo "Containers removidos!"
echo ""

echo "Para remover tamb√©m volumes e network, execute manualmente (cuidado!):"
echo "  podman volume rm exitus-pgdata exitus-backend-logs exitus-frontend-logs"
echo "  podman network rm exitus-net"
echo ""

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/scripts/setup_containers.sh ---
#!/bin/bash
# Configura√ß√£o inicial dos containers do Exitus

set -e

# Remover containers existentes
echo "Removendo containers antigos (se existirem)..."
podman stop exitus-db  2>/dev/null || true
podman stop exitus-backend 2>/dev/null || true
podman stop exitus-frontend 2>/dev/null || true

podman rm exitus-db 2>/dev/null || true
podman rm exitus-backend 2>/dev/null || true
podman rm exitus-frontend 2>/dev/null || true

pkill -9 containers-rootlessport || true

echo "=== Setup Exitus - M√≥dulo 0 ==="

# Criar network
echo "Criando network..."
podman network create exitus-net 2>/dev/null || echo "Network j√° existe"

# Criar volumes
echo "Criando volumes..."
podman volume create exitus-pgdata 2>/dev/null || echo "Volume pgdata j√° existe"
podman volume create exitus-backend-logs 2>/dev/null || echo "Volume backend-logs j√° existe"
podman volume create exitus-frontend-logs 2>/dev/null || echo "Volume frontend-logs j√° existe"

# Criar arquivos .env a partir dos exemplos (se n√£o existirem)
echo "Criando arquivos .env..."
if [ ! -f backend/.env ]; then
    cp backend/.env.example backend/.env
    echo "‚úì backend/.env criado a partir do .env.example"
else
    echo "‚úì backend/.env j√° existe"
fi

if [ ! -f frontend/.env ]; then
    cp frontend/.env.example frontend/.env
    echo "‚úì frontend/.env criado a partir do .env.example"
else
    echo "‚úì frontend/.env j√° existe"
fi

# Build das imagens
echo "Building backend image..."
cd backend
podman build -t exitus-backend:latest .
cd ..

echo "Building frontend image..."
cd frontend
podman build -t exitus-frontend:latest .
cd ..

# Criar container PostgreSQL
echo "Criando container PostgreSQL..."
podman run -d --name exitus-db \
  --network exitus-net \
  -v exitus-pgdata:/var/lib/postgresql/data \
  -e POSTGRES_USER=exitus \
  -e POSTGRES_PASSWORD=exitus123 \
  -e POSTGRES_DB=exitusdb \
  -e TZ=America/Sao_Paulo \
  docker.io/postgres:15

echo "Aguardando PostgreSQL inicializar..."
sleep 10

# Criar container Backend (usando .env)
echo "Criando container Backend..."
podman run -d --name exitus-backend \
  --network exitus-net \
  -p 5000:5000 \
  -v ./backend:/app:Z \
  -v exitus-backend-logs:/app/logs:Z \
  --env-file ./backend/.env \
  exitus-backend:latest

# Criar container Frontend (usando .env)
echo "Criando container Frontend..."
podman run -d --name exitus-frontend \
  --network exitus-net \
  -p 8080:8080 \
  -v ./frontend:/app:Z \
  -v exitus-frontend-logs:/app/logs:Z \
  --env-file ./frontend/.env \
  exitus-frontend:latest

echo ""
echo "=== Setup conclu√≠do! ==="
echo "Backend: http://localhost:5000"
echo "Frontend: http://localhost:8080"
echo ""
podman ps

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/scripts/setup_env.sh ---
#!/bin/bash
# Configura ambiente (development, staging, production)

ENV=${1:-development}

echo "Configurando ambiente: $ENV"

case $ENV in
  development)
    echo "Usando configura√ß√µes de desenvolvimento..."
    cp backend/.env.example backend/.env
    cp frontend/.env.example frontend/.env
    ;;

  staging)
    echo "Usando configura√ß√µes de staging..."
    if [ -f backend/.env.staging ]; then
      cp backend/.env.staging backend/.env
    else
      echo "ERRO: backend/.env.staging n√£o encontrado"; exit 1
    fi
    if [ -f frontend/.env.staging ]; then
      cp frontend/.env.staging frontend/.env
    else
      echo "ERRO: frontend/.env.staging n√£o encontrado"; exit 1
    fi
    ;;

  production)
    echo "Usando configura√ß√µes de produ√ß√£o..."
    if [ -f backend/.env.production ]; then
      cp backend/.env.production backend/.env
    else
      echo "ERRO: backend/.env.production n√£o encontrado"; exit 1
    fi
    if [ -f frontend/.env.production ]; then
      cp frontend/.env.production frontend/.env
    else
      echo "ERRO: frontend/.env.production n√£o encontrado"; exit 1
    fi
    ;;

  *)
    echo "Ambiente inv√°lido. Use: development, staging ou production"; exit 1;;
esac

echo "Ambiente $ENV configurado com sucesso!"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/scripts/start_services.sh ---
#!/bin/bash
# Inicia todos os servi√ßos do Exitus

echo "Iniciando servi√ßos Exitus..."

podman start exitus-db || true
echo "PostgreSQL iniciado"
sleep 5

podman start exitus-backend || true
echo "Backend iniciado"

podman start exitus-frontend || true
echo "Frontend iniciado"

echo ""
echo "=== Servi√ßos iniciados! ==="
echo "Backend: http://localhost:5000"
echo "Frontend: http://localhost:8080"
echo ""
podman ps

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/scripts/stop_services.sh ---
#!/bin/bash
# Para todos os servi√ßos do Exitus

echo "Parando servi√ßos Exitus..."

podman stop exitus-frontend exitus-backend exitus-db 2>/dev/null || true

echo "=== Servi√ßos parados! ==="

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/tests/mod1_validacao_final_fase1.sh ---
# No HOST Ubuntu
echo "=== Valida√ß√£o Fase 1 ==="
echo "1. Containers:"
#podman ps --format "{{.Names}}" | grep exitus
podman ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo ""
echo "2. Estrutura:"
ls -la backend/app/models/ backend/app/seeds/ backend/alembic/
echo ""
echo "3. Conex√£o DB:"
podman exec exitus-backend python3 -c "from app import create_app; app=create_app(); print('‚úì App inicializada')"

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/tests/mod1_validacao_final_fase2.sh ---
#!/bin/bash
# Script de valida√ß√£o da Fase 2 - Models Core

echo "======================================"
echo "  VALIDA√á√ÉO FASE 2 - MODELS CORE"
echo "======================================"
echo ""

# Cores para output
GREEN='\033[0;32m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Contador de erros
ERRORS=0

echo "1. Verificando arquivos de models..."
MODELS=("usuario.py" "corretora.py" "ativo.py" "posicao.py" "transacao.py")
for model in "${MODELS[@]}"; do
    if [ -f "backend/app/models/$model" ]; then
        echo -e "${GREEN}‚úì${NC} backend/app/models/$model"
    else
        echo -e "${RED}‚úó${NC} backend/app/models/$model FALTANDO"
        ((ERRORS++))
    fi
done
echo ""

echo "2. Testando imports dos models..."
podman exec exitus-backend python3 -c "
from app.models import Usuario, UserRole, Corretora, TipoCorretora, Ativo, TipoAtivo, ClasseAtivo, Posicao, Transacao, TipoOperacao
print('‚úì Todos os imports OK')
" 2>&1
if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Imports bem-sucedidos"
else
    echo -e "${RED}‚úó${NC} Erro nos imports"
    ((ERRORS++))
fi
echo ""

echo "3. Testando cria√ß√£o de inst√¢ncias..."
podman exec exitus-backend python3 << 'EOF'
from app.models import *
from decimal import Decimal

errors = 0

# Testar Usuario
try:
    u = Usuario(username='test', email='test@test.com')
    u.set_password('123')
    print('‚úì Usuario OK')
except Exception as e:
    print(f'‚úó Usuario ERRO: {e}')
    errors += 1

# Testar Corretora
try:
    c = Corretora(usuario_id=u.id, nome='Test', pais='BR', moeda_padrao='BRL')
    print('‚úì Corretora OK')
except Exception as e:
    print(f'‚úó Corretora ERRO: {e}')
    errors += 1

# Testar Ativo
try:
    a = Ativo(ticker='TEST4', nome='Test SA', tipo=TipoAtivo.ACAO, classe=ClasseAtivo.RENDA_VARIAVEL, mercado='BR', moeda='BRL')
    print('‚úì Ativo OK')
except Exception as e:
    print(f'‚úó Ativo ERRO: {e}')
    errors += 1

# Testar Posicao
try:
    p = Posicao(usuario_id=u.id, corretora_id=c.id, ativo_id=a.id)
    p.adicionar_compra(Decimal('10'), Decimal('50'))
    print('‚úì Posicao OK')
except Exception as e:
    print(f'‚úó Posicao ERRO: {e}')
    errors += 1

# Testar Transacao
try:
    from datetime import date
    t = Transacao(
        usuario_id=u.id,
        corretora_id=c.id,
        ativo_id=a.id,
        tipo_operacao=TipoOperacao.COMPRA,
        quantidade=Decimal('10'),
        preco_unitario=Decimal('50'),
        data_operacao=date.today()
    )
    print('‚úì Transacao OK')
except Exception as e:
    print(f'‚úó Transacao ERRO: {e}')
    errors += 1

exit(errors)
EOF

if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Todas as inst√¢ncias criadas com sucesso"
else
    echo -e "${RED}‚úó${NC} Erros na cria√ß√£o de inst√¢ncias"
    ((ERRORS++))
fi
echo ""

echo "4. Verificando enums..."
podman exec exitus-backend python3 -c "
from app.models import UserRole, TipoCorretora, TipoAtivo, ClasseAtivo, TipoOperacao
print(f'‚úì UserRole: {[r.value for r in UserRole]}')
print(f'‚úì TipoCorretora: {[t.value for t in TipoCorretora]}')
print(f'‚úì TipoAtivo: {[t.value for t in TipoAtivo]}')
print(f'‚úì ClasseAtivo: {[c.value for c in ClasseAtivo]}')
print(f'‚úì TipoOperacao: {[t.value for t in TipoOperacao]}')
"
if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Todos os enums funcionando"
else
    echo -e "${RED}‚úó${NC} Erro nos enums"
    ((ERRORS++))
fi
echo ""

echo "======================================"
if [ $ERRORS -eq 0 ]; then
    echo -e "${GREEN}‚úì FASE 2 VALIDADA COM SUCESSO!${NC}"
    echo "======================================"
    exit 0
else
    echo -e "${RED}‚úó FASE 2 COM $ERRORS ERRO(S)${NC}"
    echo "======================================"
    exit 1
fi

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/tests/mod1_validacao_final_fase3.sh ---
#!/bin/bash
# Script de valida√ß√£o da Fase 3 - Models Complementares

echo "======================================"
echo "  VALIDA√á√ÉO FASE 3 - MODELS COMPLEMENTARES"
echo "======================================"
echo ""

# Cores para output
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Contador de erros
ERRORS=0

echo "1. Verificando arquivos de models..."
MODELS=("provento.py" "movimentacao_caixa.py" "evento_corporativo.py" "fonte_dados.py" "regra_fiscal.py" "feriado_mercado.py" "log_auditoria.py")
for model in "${MODELS[@]}"; do
    if [ -f "backend/app/models/$model" ]; then
        echo -e "${GREEN}‚úì${NC} backend/app/models/$model"
    else
        echo -e "${RED}‚úó${NC} backend/app/models/$model FALTANDO"
        ((ERRORS++))
    fi
done
echo ""

echo "2. Testando imports dos models..."
podman exec exitus-backend python3 -c "
from app.models import (
    Provento, TipoProvento,
    MovimentacaoCaixa, TipoMovimentacao,
    EventoCorporativo, TipoEventoCorporativo,
    FonteDados, TipoFonteDados,
    RegraFiscal, IncidenciaImposto,
    FeriadoMercado, TipoFeriado,
    LogAuditoria
)
print('‚úì Todos os imports OK')
" 2>&1
if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Imports bem-sucedidos"
else
    echo -e "${RED}‚úó${NC} Erro nos imports"
    ((ERRORS++))
fi
echo ""

echo "3. Testando cria√ß√£o de inst√¢ncias..."
podman exec exitus-backend python3 << 'EOF'
from app.models import *
from decimal import Decimal
from datetime import date, time

errors = 0

# Testar Provento
try:
    ativo = Ativo(ticker='TEST4', nome='Test', tipo=TipoAtivo.ACAO, classe=ClasseAtivo.RENDA_VARIAVEL, mercado='BR', moeda='BRL')
    p = Provento(
        ativo_id=ativo.id,
        tipo_provento=TipoProvento.DIVIDENDO,
        valor_por_acao=Decimal('1.50'),
        quantidade_ativos=Decimal('100'),
        imposto_retido=Decimal('0'),
        data_com=date(2025, 11, 20),
        data_pagamento=date(2025, 12, 5)
    )
    print('‚úì Provento OK')
except Exception as e:
    print(f'‚úó Provento ERRO: {e}')
    errors += 1

# Testar MovimentacaoCaixa
try:
    user = Usuario(username='test', email='test@test.com')
    corr = Corretora(usuario_id=user.id, nome='Test', pais='BR', moeda_padrao='BRL')
    m = MovimentacaoCaixa(
        usuario_id=user.id,
        corretora_id=corr.id,
        tipo_movimentacao=TipoMovimentacao.DEPOSITO,
        valor=Decimal('1000'),
        moeda='BRL',
        data_movimentacao=date.today()
    )
    print('‚úì MovimentacaoCaixa OK')
except Exception as e:
    print(f'‚úó MovimentacaoCaixa ERRO: {e}')
    errors += 1

# Testar EventoCorporativo
try:
    e = EventoCorporativo(
        ativo_id=ativo.id,
        tipo_evento=TipoEventoCorporativo.SPLIT,
        data_evento=date(2025, 12, 1),
        proporcao='2:1',
        descricao='Split 2 para 1'
    )
    print('‚úì EventoCorporativo OK')
except Exception as e:
    print(f'‚úó EventoCorporativo ERRO: {e}')
    errors += 1

# Testar FonteDados
try:
    f = FonteDados(
        nome='yfinance',
        tipo_fonte=TipoFonteDados.API,
        url_base='https://finance.yahoo.com',
        ativa=True,
        prioridade=1
    )
    print('‚úì FonteDados OK')
except Exception as e:
    print(f'‚úó FonteDados ERRO: {e}')
    errors += 1

# Testar RegraFiscal
try:
    r = RegraFiscal(
        pais='BR',
        tipo_ativo='ACAO',
        aliquota_ir=Decimal('15.0'),
        incide_sobre=IncidenciaImposto.LUCRO,
        descricao='IR sobre ganhos de capital',
        vigencia_inicio=date(2023, 1, 1),
        ativa=True
    )
    print('‚úì RegraFiscal OK')
except Exception as e:
    print(f'‚úó RegraFiscal ERRO: {e}')
    errors += 1

# Testar FeriadoMercado
try:
    fer = FeriadoMercado(
        pais='BR',
        mercado='B3',
        data_feriado=date(2025, 12, 25),
        tipo_feriado=TipoFeriado.NACIONAL,
        nome='Natal',
        recorrente=True
    )
    print('‚úì FeriadoMercado OK')
except Exception as e:
    print(f'‚úó FeriadoMercado ERRO: {e}')
    errors += 1

# Testar LogAuditoria
try:
    log = LogAuditoria(
        usuario_id=user.id,
        acao='LOGIN',
        ip_address='127.0.0.1',
        sucesso=True
    )
    print('‚úì LogAuditoria OK')
except Exception as e:
    print(f'‚úó LogAuditoria ERRO: {e}')
    errors += 1

exit(errors)
EOF

if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Todas as inst√¢ncias criadas com sucesso"
else
    echo -e "${RED}‚úó${NC} Erros na cria√ß√£o de inst√¢ncias"
    ((ERRORS++))
fi
echo ""

echo "4. Verificando enums..."
podman exec exitus-backend python3 -c "
from app.models import (
    TipoProvento, TipoMovimentacao, TipoEventoCorporativo,
    TipoFonteDados, IncidenciaImposto, TipoFeriado
)
print(f'‚úì TipoProvento: {[t.value for t in TipoProvento]}')
print(f'‚úì TipoMovimentacao: {[t.value for t in TipoMovimentacao]}')
print(f'‚úì TipoEventoCorporativo: {[t.value for t in TipoEventoCorporativo]}')
print(f'‚úì TipoFonteDados: {[t.value for t in TipoFonteDados]}')
print(f'‚úì IncidenciaImposto: {[i.value for i in IncidenciaImposto]}')
print(f'‚úì TipoFeriado: {[t.value for t in TipoFeriado]}')
"
if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Todos os enums funcionando"
else
    echo -e "${RED}‚úó${NC} Erro nos enums"
    ((ERRORS++))
fi
echo ""

echo "5. Testando m√©todos espec√≠ficos..."
podman exec exitus-backend python3 << 'EOF'
from app.models import *
from decimal import Decimal
from datetime import date

errors = 0

# Testar c√°lculos de Provento
try:
    ativo = Ativo(ticker='TEST', nome='Test', tipo=TipoAtivo.ACAO, classe=ClasseAtivo.RENDA_VARIAVEL, mercado='BR', moeda='BRL', preco_atual=Decimal('40'))
    prov = Provento(
        ativo_id=ativo.id,
        tipo_provento=TipoProvento.DIVIDENDO,
        valor_por_acao=Decimal('2.00'),
        quantidade_ativos=Decimal('100'),
        imposto_retido=Decimal('0'),
        data_com=date(2025, 11, 20),
        data_pagamento=date(2025, 12, 5)
    )
    dy = prov.dividend_yield_efetivo(ativo.preco_atual)
    assert dy == 5.0, f"DY deveria ser 5.0, foi {dy}"
    print('‚úì Provento.dividend_yield_efetivo() OK')
except Exception as e:
    print(f'‚úó Provento m√©todos ERRO: {e}')
    errors += 1

# Testar c√°lculos de EventoCorporativo
try:
    evento = EventoCorporativo(
        ativo_id=ativo.id,
        tipo_evento=TipoEventoCorporativo.SPLIT,
        data_evento=date(2025, 12, 1),
        proporcao='2:1',
        descricao='Split'
    )
    fator = evento.calcular_fator_ajuste()
    assert fator == 2.0, f"Fator deveria ser 2.0, foi {fator}"
    print('‚úì EventoCorporativo.calcular_fator_ajuste() OK')
except Exception as e:
    print(f'‚úó EventoCorporativo m√©todos ERRO: {e}')
    errors += 1

# Testar estat√≠sticas de FonteDados
try:
    fonte = FonteDados(nome='test', tipo_fonte=TipoFonteDados.API, ativa=True, prioridade=1)
    fonte.registrar_consulta_sucesso()
    fonte.registrar_consulta_sucesso()
    fonte.registrar_erro()
    taxa = fonte.taxa_sucesso()
    assert 66.0 <= taxa <= 67.0, f"Taxa sucesso deveria ser ~66.67%, foi {taxa}"
    print('‚úì FonteDados.taxa_sucesso() OK')
except Exception as e:
    print(f'‚úó FonteDados m√©todos ERRO: {e}')
    errors += 1

# Testar c√°lculo de imposto RegraFiscal
try:
    regra = RegraFiscal(
        pais='BR',
        aliquota_ir=Decimal('15.0'),
        valor_isencao=Decimal('20000'),
        incide_sobre=IncidenciaImposto.LUCRO,
        descricao='Test',
        vigencia_inicio=date(2023, 1, 1),
        ativa=True
    )
    imposto = regra.calcular_imposto(Decimal('30000'))
    assert imposto == 1500, f"Imposto deveria ser 1500, foi {imposto}"
    print('‚úì RegraFiscal.calcular_imposto() OK')
except Exception as e:
    print(f'‚úó RegraFiscal m√©todos ERRO: {e}')
    errors += 1

# Testar altera√ß√µes LogAuditoria
try:
    log = LogAuditoria(
        acao='UPDATE',
        dados_antes={'nome': 'Jo√£o', 'idade': 30},
        dados_depois={'nome': 'Jo√£o Silva', 'idade': 30},
        sucesso=True
    )
    alteracoes = log.get_alteracoes()
    assert 'nome' in alteracoes, "Deveria detectar altera√ß√£o em 'nome'"
    assert 'idade' not in alteracoes, "N√£o deveria detectar altera√ß√£o em 'idade'"
    print('‚úì LogAuditoria.get_alteracoes() OK')
except Exception as e:
    print(f'‚úó LogAuditoria m√©todos ERRO: {e}')
    errors += 1

exit(errors)
EOF

if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Todos os m√©todos espec√≠ficos funcionando"
else
    echo -e "${RED}‚úó${NC} Erros nos m√©todos espec√≠ficos"
    ((ERRORS++))
fi
echo ""

echo "6. Resumo de models criados..."
echo -e "${YELLOW}Fase 2 (Core):${NC}"
echo "  1. Usuario"
echo "  2. Corretora"
echo "  3. Ativo"
echo "  4. Posicao"
echo "  5. Transacao"
echo ""
echo -e "${YELLOW}Fase 3 (Complementares):${NC}"
echo "  6. Provento"
echo "  7. MovimentacaoCaixa"
echo "  8. EventoCorporativo"
echo "  9. FonteDados"
echo "  10. RegraFiscal"
echo "  11. FeriadoMercado"
echo "  12. LogAuditoria"
echo ""

echo "======================================"
if [ $ERRORS -eq 0 ]; then
    echo -e "${GREEN}‚úì FASE 3 VALIDADA COM SUCESSO!${NC}"
    echo "======================================"
    echo ""
    echo "üìä Total: 12 models criados"
    echo "‚úÖ Pr√≥ximo: Fase 4 - Migrations e Schema"
    echo ""
    exit 0
else
    echo -e "${RED}‚úó FASE 3 COM $ERRORS ERRO(S)${NC}"
    echo "======================================"
    exit 1
fi

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/tests/mod1_validacao_final_fase4.sh ---
#!/bin/bash
# Script de valida√ß√£o da Fase 4 - Migrations e Schema

echo "======================================"
echo "  VALIDA√á√ÉO FASE 4 - MIGRATIONS E SCHEMA"
echo "======================================"
echo ""

# Cores para output
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# Contador de erros
ERRORS=0

echo "1. Verificando migration gerada..."
MIGRATION_FILE=$(ls backend/alembic/versions/*_initial_schema_12_models.py 2>/dev/null | head -1)
if [ -f "$MIGRATION_FILE" ]; then
    LINES=$(wc -l < "$MIGRATION_FILE")
    if [ "$LINES" -gt 400 ]; then
        echo -e "${GREEN}‚úì${NC} Migration gerada: $MIGRATION_FILE ($LINES linhas)"
    else
        echo -e "${RED}‚úó${NC} Migration muito pequena: $LINES linhas"
        ((ERRORS++))
    fi
else
    echo -e "${RED}‚úó${NC} Migration n√£o encontrada"
    ((ERRORS++))
fi
echo ""

echo "2. Verificando tabelas no PostgreSQL..."
TABLES=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema='public' AND table_type='BASE TABLE';")
TABLES=$(echo $TABLES | xargs) # trim whitespace
if [ "$TABLES" -eq 13 ]; then
    echo -e "${GREEN}‚úì${NC} 13 tabelas criadas (12 models + alembic_version)"
else
    echo -e "${RED}‚úó${NC} Esperado 13 tabelas, encontrado: $TABLES"
    ((ERRORS++))
fi

# Listar tabelas
echo -e "${YELLOW}Tabelas encontradas:${NC}"
podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT table_name FROM information_schema.tables WHERE table_schema='public' AND table_type='BASE TABLE' ORDER BY table_name;" | sed 's/^/ - /'
echo ""

echo "3. Verificando enums no PostgreSQL..."
ENUMS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM pg_type WHERE typtype='e';")
ENUMS=$(echo $ENUMS | xargs)
if [ "$ENUMS" -eq 11 ]; then
    echo -e "${GREEN}‚úì${NC} 11 enums criados"
else
    echo -e "${RED}‚úó${NC} Esperado 11 enums, encontrado: $ENUMS"
    ((ERRORS++))
fi

# Listar enums
echo -e "${YELLOW}Enums encontrados:${NC}"
podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT typname FROM pg_type WHERE typtype='e' ORDER BY typname;" | sed 's/^/ - /'
echo ""

echo "4. Verificando foreign keys..."
FKS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM information_schema.table_constraints WHERE constraint_type='FOREIGN KEY';")
FKS=$(echo $FKS | xargs)
if [ "$FKS" -ge 10 ]; then
    echo -e "${GREEN}‚úì${NC} $FKS foreign keys criadas"
else
    echo -e "${YELLOW}‚ö†${NC} Apenas $FKS foreign keys encontradas (esperado >=10)"
fi
echo ""

echo "5. Verificando √≠ndices..."
INDEXES=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM pg_indexes WHERE schemaname='public';")
INDEXES=$(echo $INDEXES | xargs)
if [ "$INDEXES" -ge 50 ]; then
    echo -e "${GREEN}‚úì${NC} $INDEXES √≠ndices criados"
else
    echo -e "${YELLOW}‚ö†${NC} Apenas $INDEXES √≠ndices encontrados"
fi
echo ""

echo "6. Testando insert em tabela usuario..."
podman exec exitus-db psql -U exitus -d exitusdb -c "
INSERT INTO usuario (id, username, email, password_hash, ativo, role, created_at, updated_at)
VALUES (
    gen_random_uuid(),
    'test_validation',
    'test@validation.com',
    'hash123',
    true,
    'USER'::userrole,
    NOW(),
    NOW()
) ON CONFLICT DO NOTHING;
" > /dev/null 2>&1

if [ $? -eq 0 ]; then
    echo -e "${GREEN}‚úì${NC} Insert de teste bem-sucedido"
    # Limpar
    podman exec exitus-db psql -U exitus -d exitusdb -c "DELETE FROM usuario WHERE username='test_validation';" > /dev/null 2>&1
else
    echo -e "${RED}‚úó${NC} Erro no insert de teste"
    ((ERRORS++))
fi
echo ""

echo "7. Verificando vers√£o do Alembic..."
ALEMBIC_VERSION=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT version_num FROM alembic_version;")
ALEMBIC_VERSION=$(echo $ALEMBIC_VERSION | xargs)
if [ ! -z "$ALEMBIC_VERSION" ]; then
    echo -e "${GREEN}‚úì${NC} Alembic version: $ALEMBIC_VERSION"
else
    echo -e "${RED}‚úó${NC} Vers√£o do Alembic n√£o encontrada"
    ((ERRORS++))
fi
echo ""

echo "======================================"
if [ $ERRORS -eq 0 ]; then
    echo -e "${GREEN}‚úì FASE 4 VALIDADA COM SUCESSO!${NC}"
    echo "======================================"
    echo ""
    echo "üìä Resumo:"
    echo "  - 13 tabelas criadas"
    echo "  - 11 enums criados"
    echo "  - $FKS foreign keys"
    echo "  - $INDEXES √≠ndices"
    echo ""
    echo "‚úÖ Pr√≥ximo: Fase 5 - Seeds de Dados"
    echo ""
    exit 0
else
    echo -e "${RED}‚úó FASE 4 COM $ERRORS ERRO(S)${NC}"
    echo "======================================"
    exit 1
fi

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/tests/mod1_validacao_final_fase5.sh ---
#!/bin/bash
# Script de valida√ß√£o da Fase 5 - Seeds de Dados

echo "======================================"
echo "  VALIDA√á√ÉO FASE 5 - SEEDS DE DADOS"
echo "======================================"
echo ""

# Cores para output
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

ERRORS=0

echo "1. Verificando usu√°rios..."
USERS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM usuario;")
USERS=$(echo $USERS | xargs)
if [ "$USERS" -eq 4 ]; then
    echo -e "${GREEN}‚úì${NC} 4 usu√°rios cadastrados"
else
    echo -e "${RED}‚úó${NC} Esperado 4 usu√°rios, encontrado: $USERS"
    ((ERRORS++))
fi
echo ""

echo "2. Verificando ativos brasileiros..."
ATIVOS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM ativo WHERE mercado='BR';")
ATIVOS=$(echo $ATIVOS | xargs)
if [ "$ATIVOS" -eq 25 ]; then
    echo -e "${GREEN}‚úì${NC} 25 ativos brasileiros cadastrados"
else
    echo -e "${RED}‚úó${NC} Esperado 25 ativos, encontrado: $ATIVOS"
    ((ERRORS++))
fi

#ACOES=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM ativo WHERE mercado='BR' AND tipo='acao';")
ACOES=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM ativo WHERE mercado='BR' AND tipo='ACAO';")
ACOES=$(echo $ACOES | xargs)
echo -e "  - A√ß√µes: $ACOES"

#FIIS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM ativo WHERE mercado='BR' AND tipo='fii';")
FIIS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM ativo WHERE mercado='BR' AND tipo='FII';")
FIIS=$(echo $FIIS | xargs)
echo -e "  - FIIs: $FIIS"
echo ""

echo "3. Verificando regras fiscais BR..."
REGRAS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM regra_fiscal WHERE pais='BR';")
REGRAS=$(echo $REGRAS | xargs)
if [ "$REGRAS" -eq 6 ]; then
    echo -e "${GREEN}‚úì${NC} 6 regras fiscais brasileiras cadastradas"
else
    echo -e "${RED}‚úó${NC} Esperado 6 regras, encontrado: $REGRAS"
    ((ERRORS++))
fi
echo ""

echo "4. Verificando feriados B3..."
FERIADOS=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM feriado_mercado WHERE pais='BR' AND mercado='B3';")
FERIADOS=$(echo $FERIADOS | xargs)
if [ "$FERIADOS" -eq 30 ]; then
    echo -e "${GREEN}‚úì${NC} 30 feriados B3 cadastrados"
else
    echo -e "${RED}‚úó${NC} Esperado 30 feriados, encontrado: $FERIADOS"
    ((ERRORS++))
fi
echo ""

echo "5. Verificando fontes de dados..."
FONTES=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT COUNT(*) FROM fonte_dados;")
FONTES=$(echo $FONTES | xargs)
if [ "$FONTES" -eq 7 ]; then
    echo -e "${GREEN}‚úì${NC} 7 fontes de dados cadastradas"
else
    echo -e "${RED}‚úó${NC} Esperado 7 fontes, encontrado: $FONTES"
    ((ERRORS++))
fi
echo ""

echo "6. Verificando dados espec√≠ficos..."

# Verificar usu√°rio admin
ADMIN=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT username FROM usuario WHERE role='ADMIN' LIMIT 1;")
ADMIN=$(echo $ADMIN | xargs)
if [ "$ADMIN" = "admin" ]; then
    echo -e "${GREEN}‚úì${NC} Usu√°rio admin encontrado"
else
    echo -e "${RED}‚úó${NC} Usu√°rio admin n√£o encontrado"
    ((ERRORS++))
fi

# Verificar PETR4
PETR4=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT ticker FROM ativo WHERE ticker='PETR4';")
PETR4=$(echo $PETR4 | xargs)
if [ "$PETR4" = "PETR4" ]; then
    echo -e "${GREEN}‚úì${NC} Ativo PETR4 encontrado"
else
    echo -e "${RED}‚úó${NC} Ativo PETR4 n√£o encontrado"
    ((ERRORS++))
fi

# Verificar yfinance
YFINANCE=$(podman exec exitus-db psql -U exitus -d exitusdb -t -c "SELECT nome FROM fonte_dados WHERE nome='yfinance';")
YFINANCE=$(echo $YFINANCE | xargs)
if [ "$YFINANCE" = "yfinance" ]; then
    echo -e "${GREEN}‚úì${NC} Fonte yfinance encontrada"
else
    echo -e "${RED}‚úó${NC} Fonte yfinance n√£o encontrada"
    ((ERRORS++))
fi
echo ""

echo "======================================"
if [ $ERRORS -eq 0 ]; then
    echo -e "${GREEN}‚úì FASE 5 VALIDADA COM SUCESSO!${NC}"
    echo "======================================"
    echo ""
    echo "üìä Resumo dos Dados:"
    echo "  - $USERS usu√°rios"
    echo "  - $ATIVOS ativos ($ACOES a√ß√µes + $FIIS FIIs)"
    echo "  - $REGRAS regras fiscais"
    echo "  - $FERIADOS feriados"
    echo "  - $FONTES fontes de dados"
    echo ""
    echo "‚úÖ Banco de dados populado e pronto!"
    echo ""
    exit 0
else
    echo -e "${RED}‚úó FASE 5 COM $ERRORS ERRO(S)${NC}"
    echo "======================================"
    exit 1
fi

====================================================

--- ARQUIVO: /home/p016525/elielson/exitus/tests/test_module0.sh ---
#!/bin/bash
echo "======================================"
echo "  EXITUS - TESTES DO M√ìDULO 0"
echo "======================================"
echo ""

echo "1. Backend Health Check (host):"
curl -s http://localhost:5000/health | python3 -m json.tool
echo ""

echo "2. Frontend Health Check (host):"
curl -s http://localhost:8080/health | python3 -m json.tool
echo ""

echo "3. Frontend ‚Üí Backend (interno):"
podman exec exitus-frontend python -c "import requests; r = requests.get('http://exitus-backend:5000/health'); print(r.json())"
echo ""

echo "4. Backend ‚Üí Database (conex√£o):"
podman exec exitus-backend python -c "import socket; socket.create_connection(('exitus-db', 5432), timeout=5); print('‚úì Conex√£o OK')"
echo ""

echo "5. PostgreSQL Query:"
podman exec exitus-db psql -U exitus -d exitusdb -c "SELECT version();" | head -3
echo ""

echo "6. Containers rodando:"
podman ps --format "table {{.Names}}\t{{.Status}}\t{{.Ports}}"
echo ""

echo "======================================"
echo "  TODOS OS TESTES CONCLU√çDOS!"
echo "======================================"

====================================================

